<?xml version="1.0" encoding="utf-8"?> <?xml-stylesheet type="text/xml" href="/blog/feed.xslt.xml"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="fr"> <generator uri="http://jekyllrb.com" version="3.4.2">Jekyll</generator><link href="http://www.monkeypatch.io/blog/feed.xml" rel="self" type="application/atom+xml"/><link href="http://www.monkeypatch.io/" rel="alternate" type="text/html" hreflang="fr"/> <updated>2017-03-11T14:56:30+01:00</updated> <id>http://www.monkeypatch.io/</id><title>MonkeyPatch - Expertise Informatique</title> <subtitle>SociÃ©tÃ© de conseil et d'expertise en informatique spÃ©cialisÃ©e dans les nouvelles technologies.</subtitle> <entry xml:lang="fr"><title>Ngviknigs</title><link href="http://www.monkeypatch.io/2017/03/07/ngViknigs.html" rel="alternate" type="text/html" title="Ngviknigs"/> <published>2017-03-07T00:00:00+01:00</published> <updated>2017-03-07T00:00:00+01:00</updated><id>http://www.monkeypatch.io/2017/03/07/ngViknigs</id> <content type="html" xml:base="http://www.monkeypatch.io/2017/03/07/ngViknigs.html">&lt;h2 id="introduction"&gt;Introduction&lt;/h2&gt;&lt;p&gt;Ã€ peine remis du &lt;a href="https://www.meetup.com/fr-FR/Monkey-Tech-Days/events/232103376/"&gt;MonkeyTechDay #3: Reactive Streams&lt;/a&gt; coachÃ© par &lt;a href="https://twitter.com/sdeleuze"&gt;@sdeleuze&lt;/a&gt;, je prends lâ€™avion direction Copenhague pour assister Ã  la premiÃ¨re Ã©dition de &lt;a href="https://ngvikings.org/"&gt;ngVikings&lt;/a&gt;.&lt;/p&gt; &lt;blockquote&gt; &lt;p&gt;Pour un retour sur le MKTD, voir le retour de &lt;a href="https://medium.com/@Maxime_/monkey-tech-days-3-reactive-streams-c94f74e710d#.xzvbilpsi"&gt;Maxime&lt;/a&gt;&lt;/p&gt; &lt;/blockquote&gt;&lt;p&gt;#Stereotype, Au Danemark il fait plus froid quâ€™Ã  Toulouse, il y a des Lego, des Carlseberg, et une sirÃ¨ne.&lt;/p&gt;&lt;p&gt;Jâ€™ai plutÃ´t lâ€™habitude de participer Ã  des confÃ©rences assez gÃ©nÃ©ralistes, mais lÃ , je vais faire deux jours intÃ©gralement sur du Angular (comprendre Angular 2+ pour ceux qui ne font pas encore la diffÃ©rence entre AngularJs et â€˜Just Angularâ€™).&lt;/p&gt;&lt;p&gt;Câ€™est pour moi lâ€™occasion dâ€™approfondir le sujet, de voir lâ€™Ã©cosystÃ¨me, et de rencontrer des dÃ©veloppeurs passionnÃ©s par ce sujet.&lt;/p&gt;&lt;p&gt;Je constate que certains â€˜grands comptesâ€™ Toulousains font un premier pas vers Angular sur leurs nouveaux projets, câ€™est donc le moment idÃ©al pour moi dâ€™aller plus loin sur le sujet. &lt;!--more--&gt;&lt;/p&gt;&lt;h2 id="jour-1---conference-day"&gt;Jour 1 - Conference day&lt;/h2&gt;&lt;p&gt;La confÃ©rence se dÃ©roule Ã  &lt;a href="https://en.itu.dk/"&gt;lâ€™universitÃ© IT de Copenhague&lt;/a&gt;, les prÃ©sentations durent 30 minutes, le rythme est soutenu : pas le temps de sâ€™endormir. Les pauses de 5 minutes entre les confÃ©rences sont un peu trop courtes pour vraiment souffler, mais le hall de lâ€™universitÃ© est suffisament grand pour Ã©viter les embouteillages.&lt;/p&gt;&lt;p&gt;Ã€ noter que lâ€™aprÃ¨s-midi, une salle spÃ©ciale est rÃ©servÃ©e pour discuter avec tous les speakers en parallÃ¨le des deux salles avec des prÃ©sentations, câ€™est particuliÃ¨rement intÃ©ressant, car le format nâ€™autorise pas vraiment la possibilitÃ© de poser des questions pendant les prÃ©sentations.&lt;/p&gt;&lt;p&gt;Le cadre est trÃ¨s bien, cette universitÃ© est classe. Quand on arrive on est accueilli par de la musique â€˜Vikingsâ€™ comme par exemple &lt;a href="https://www.youtube.com/watch?v=7fPoRacRhKE&amp;amp;feature=youtu.be"&gt;Wardruna - Bjarkan&lt;/a&gt;. (ne mâ€™en demandez pas plus sur le sujet, jâ€™y connais rien).&lt;/p&gt;&lt;h3 id="intro--keynote"&gt;Intro &amp;amp; keynote&lt;/h3&gt;&lt;p&gt;Cette confÃ©rence est organisÃ©e par des communautÃ©s des pays scandinaves (au sens large): AngularJS Copenhagen, GDG Copenhagen, AngularJS Oslo, AngularJS Gothenburg, ngAarhus, ngStockholm, Angular Finland. Pendant lâ€™introduction, les organisateurs sont accompagnÃ©s de Vikings en costume, Ã§a met tout de suite dans lâ€™ambiance.&lt;/p&gt;&lt;p&gt;AprÃ¨s une rapide introduction, ils laissent la place Ã  &lt;a href="auchenberg"&gt;Kenneth Auchenberg&lt;/a&gt; de Microsoft pour la keynote. DerriÃ¨re le titre un peu provoquant: &lt;a href="https://speakerdeck.com/auchenberg/a-future-without-browsers-february-2017"&gt;A Future without Browsers&lt;/a&gt; il nous expose une vision possible du futur du web que je trouve assez plausible.&lt;/p&gt;&lt;p&gt;Il a commencÃ© par nous faire un rappel du dÃ©but des navigateurs internet, pour nous montrer le changement avec ce quâ€™ils sont devenus aujourdâ€™hui : des moteurs dâ€™applications. Aujoudâ€™hui, on constate que beaucoup dâ€™utilisateurs ne savent mÃªme plus que lorsquâ€™ils sont sur des rÃ©seaux sociaux, ils utilisent internet !&lt;/p&gt;&lt;p&gt;Les usages ont aussi beaucoup changÃ© avec lâ€™arrivÃ©e des smartphones qui ont mis quelques annÃ©es pour devenir la plateforme majoritaire sur internet. Il faut aussi remarquer que la compÃ©tition entre ces navigateurs a tirÃ© tout ce monde vers le haut. Demain, les PWA (Progressive Web App) pourraient bien remplacer les applications natives. Enfin de plus en plus dâ€™applications desktop se basent sur des navigateurs comme par exemple celles qui sont basÃ©es sur &lt;a href="http://electron.atom.io/"&gt;Electron&lt;/a&gt;. Qui aurait cru il y a quelques annÃ©es que le monde des IDE allait Ãªtre concurencÃ© par des applications qui tournent dans un navigateur ?&lt;/p&gt;&lt;p&gt;Les applications natives embarquent aussi frÃ©quemment un navigateur. Les nouvelles interfaces de recherche (Siri, Cortana), et les nouveaux assistants domestiques (Google Home, Echo, Alexa, â€¦) sont nos nouveaux moteurs de recherche, et de nouveaux Ã©cosystÃ¨mes pour les applications.&lt;/p&gt;&lt;p&gt;&lt;img src="/public/images/ngVikings17/keynote-webflux.png" alt="Web Flux" /&gt;&lt;/p&gt;&lt;p&gt;Pour rÃ©sumer, le monde des browsers tel que lâ€™on a connu est rÃ©volu, aujourdâ€™hui le navigateur au coeur des changements numÃ©riques. Ceci promet un bel avenir aux dÃ©veloppeurs Web (du coup, la notion de Front-End nâ€™est pas tout Ã  fait exacte).&lt;/p&gt;&lt;h3 id="angular-outside-the-browser-angular-for-the-headless-web"&gt;Angular outside the Browser (Angular for the Headless web)&lt;/h3&gt;&lt;p&gt;Ensuite, je regarde la prÃ©sentation de &lt;a href="https://twitter.com/manekinekko"&gt;Wassim Chegham&lt;/a&gt; un GDE franÃ§ais qui nous parle dâ€™&lt;a href="https://github.com/angular/universal"&gt;angular universal&lt;/a&gt;. Voici ses slides : &lt;a href="http://slides.com/wassimchegham/angular2-universal#/"&gt;http://slides.com/wassimchegham/angular2-universal#/&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;Lâ€™objectif est le rendu cotÃ© serveur des applications angular. En effet, certains cas dâ€™utilisation vont nÃ©cessiter ce rendu en dehors du navigateur : IoT, SEO (Search Engine Optimisation), Preview (social link), accÃ©lÃ©ration du rendu de la premiÃ¨re page. Angular sâ€™inspire des autres frameworks qui ont dÃ©jÃ  rÃ©pondus Ã  ce besoin.&lt;/p&gt;&lt;p&gt;Le systÃ¨me de rendu dâ€™Angular peut donc faire avec le navigateur, avec les webworkers dans le navigateur ou bien dans un serveur comme NodeJS ou avec du .Net, et bientÃ´t dâ€™autres langages (on lâ€™espÃ¨re).&lt;/p&gt;&lt;p&gt;Dans le cas dâ€™un rendu serveur pour accÃ©lÃ©rer le premier chargement, ensuite le navigateur reprend la main pour contiuner normalement. Cependant le problÃ¨me quâ€™il faut rÃ©soudre, câ€™est que lâ€™Ã©tat conservÃ© sur le serveur devra Ãªtre transfÃ©rÃ© dans le navigateur. Pour cela, il y a &lt;a href="https://github.com/angular/preboot"&gt;preboot&lt;/a&gt; qui va enregistrer les Ã©vÃ©nements pour les rejouer ensuite. Attention, il faut utiliser le moteur de rendu dâ€™Angular et pas le DOM, sinon on va perdre la capacitÃ© offerte par Angular Universal.&lt;/p&gt;&lt;p&gt;Bonne nouvelle Angular Universal rejoint Angular Core, Ã§a nous promet de la qualitÃ© et une trÃ¨s bonne intÃ©gration.&lt;/p&gt;&lt;p&gt;ConcrÃ¨tement, un bon point de dÃ©part est &lt;a href="https://medium.com/google-developer-experts/angular-universal-for-the-rest-of-us-922ca8bac84#.db8v2ofj2"&gt;Angular Universal For The Rest Of Us&lt;/a&gt;. Le seul point faible de la prÃ©sentation, câ€™est que jâ€™aurais aimÃ© voir un exemple en live.&lt;/p&gt;&lt;h3 id="angular-continuous-integration"&gt;Angular Continuous integration&lt;/h3&gt;&lt;p&gt;Je continue par la prÃ©sentation de &lt;a href="https://twitter.com/elecash"&gt;RaÃºl JimÃ©nez&lt;/a&gt;. Voici ses slides &lt;a href="http://slides.com/elecash/angular-continuous-integration#/"&gt;http://slides.com/elecash/angular-continuous-integration#/&lt;/a&gt;&lt;/p&gt;&lt;p&gt;Il introduit le syndrome iwoml: â€˜it works on my latopâ€™. Pour Ã©viter de succomber Ã  ce syndrome, il nous propose de faire de lâ€™intÃ©gration continue. Notez que le mÃ©canisme de dÃ©claration des dÃ©pendances sous npm rends ceci plus important que dans un environnement ou les versions des libraries sont plus strictement contrÃ´lÃ©s.&lt;/p&gt;&lt;p&gt;1- create a github repo&lt;/p&gt;&lt;p&gt;2- log in to Travis with your Github user&lt;/p&gt;&lt;p&gt;3- enable a repo on your Travis profile&lt;/p&gt;&lt;p&gt;4- install the Travis CLI and run â€œtravis initâ€&lt;/p&gt;&lt;p&gt;5- modify the .travis.yml file&lt;/p&gt;&lt;div class="language-yaml highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="s"&gt;sudo&lt;/span&gt;&lt;span class="pi"&gt;:&lt;/span&gt; &lt;span class="s"&gt;false&lt;/span&gt; &lt;span class="s"&gt;language&lt;/span&gt;&lt;span class="pi"&gt;:&lt;/span&gt; &lt;span class="s"&gt;node_js&lt;/span&gt; &lt;span class="s"&gt;cache&lt;/span&gt;&lt;span class="pi"&gt;:&lt;/span&gt; &lt;span class="s"&gt;directories&lt;/span&gt;&lt;span class="pi"&gt;:&lt;/span&gt; &lt;span class="pi"&gt;-&lt;/span&gt; &lt;span class="s"&gt;node_modules&lt;/span&gt; &lt;span class="s"&gt;notifications&lt;/span&gt;&lt;span class="pi"&gt;:&lt;/span&gt; &lt;span class="s"&gt;email&lt;/span&gt;&lt;span class="pi"&gt;:&lt;/span&gt; &lt;span class="s"&gt;false&lt;/span&gt; &lt;span class="s"&gt;node_js&lt;/span&gt;&lt;span class="pi"&gt;:&lt;/span&gt; &lt;span class="pi"&gt;-&lt;/span&gt; &lt;span class="s1"&gt;'&lt;/span&gt;&lt;span class="s"&gt;4'&lt;/span&gt; &lt;span class="s"&gt;before_install&lt;/span&gt;&lt;span class="pi"&gt;:&lt;/span&gt; &lt;span class="pi"&gt;-&lt;/span&gt; &lt;span class="s"&gt;export CHROME_BIN=chromium-browser&lt;/span&gt; &lt;span class="pi"&gt;-&lt;/span&gt; &lt;span class="s"&gt;export DISPLAY=:99.0&lt;/span&gt; &lt;span class="pi"&gt;-&lt;/span&gt; &lt;span class="s"&gt;sh -e /etc/init.d/xvfb start&lt;/span&gt; &lt;span class="pi"&gt;-&lt;/span&gt; &lt;span class="s"&gt;npm i -g npm@^3.0.0&lt;/span&gt; &lt;span class="s"&gt;before_script&lt;/span&gt;&lt;span class="pi"&gt;:&lt;/span&gt; &lt;span class="pi"&gt;-&lt;/span&gt; &lt;span class="s"&gt;npm prune&lt;/span&gt; &lt;span class="s"&gt;script&lt;/span&gt;&lt;span class="pi"&gt;:&lt;/span&gt; &lt;span class="pi"&gt;-&lt;/span&gt; &lt;span class="s"&gt;npm run build&lt;/span&gt; &lt;span class="s"&gt;branches&lt;/span&gt;&lt;span class="pi"&gt;:&lt;/span&gt; &lt;span class="s"&gt;except&lt;/span&gt;&lt;span class="pi"&gt;:&lt;/span&gt; &lt;span class="pi"&gt;-&lt;/span&gt; &lt;span class="s"&gt;/^v\d+\.\d+\.\d+$/&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;6- add your scripts on package.json&lt;/p&gt;&lt;div class="language-json highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="s2"&gt;"prebuild"&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;"npm test -- --single-run"&lt;/span&gt;&lt;span class="err"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;"build"&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;"ng build --prod --aot"&lt;/span&gt;&lt;span class="err"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;7- modify the karma.conf.js&lt;/p&gt;&lt;div class="language-javascript highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;process&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;env&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;TRAVIS&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nx"&gt;configuration&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;browsers&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;'Chrome_travis_ci'&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="nx"&gt;config&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;set&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;configuration&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;8- create a branch and send a pull request&lt;/p&gt;&lt;p&gt;Et il nous fait du live-coding sur une version amÃ©liorÃ© en rajoutant &lt;a href="https://greenkeeper.io/"&gt;GreenKeeper&lt;/a&gt; et du versionnage sÃ©mantique. GreenKeeper permet de dÃ©clancher automatiquement des Pull Request sur le frontend lorsque le backend change.&lt;/p&gt;&lt;p&gt;Voir les dÃ©pÃ´ts git pour le &lt;a href="https://github.com/elecash/ng2-ci-app"&gt;frontend&lt;/a&gt; et le &lt;a href="https://github.com/elecash/ng2-ci-api"&gt;backend&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;La dÃ©mo est vraiment convaincante, il faut de toute urgence que jâ€™adapte ces scripts aux environnements que jâ€™utilise traditionnellement (Jenkins, backend Java).&lt;/p&gt;&lt;p&gt;En gros voici les scripts npm de la partie client (basÃ© sur angular-cli):&lt;/p&gt;&lt;div class="language-json highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="s2"&gt;"scripts"&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;"precommit"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;"npm test -- --single-run"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;"commit"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;"git-cz"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;"ng"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;"ng"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;"serve:build"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;"http-server ./dist -s -p 4200"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;"start"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;"ng serve"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;"start:aot"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;"ng serve --prod --aot"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;"prebuild"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;"npm test -- --single-run"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;"build"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;"ng build --prod --aot --bh /ng2-ci-app/"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;"build:travis"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;"ng build --prod --aot"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;"lint"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;"tslint \"src/**/*.ts\""&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;"test"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;"ng test"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;"pree2e"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;"webdriver-manager update --standalone false --gecko false"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;"e2e"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;"concurrently \"npm run serve:build\" \"protractor\" --kill-others --success first"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;"stop"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;"kill $(cat .pid)"&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="err"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;et sur la partie backend (NodeJS):&lt;/p&gt;&lt;div class="language-json highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="s2"&gt;"scripts"&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;"build"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;"rimraf dist &amp;amp;&amp;amp; node build.js"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;"commit"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;"git-cz"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;"semantic-release"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;"semantic-release pre &amp;amp;&amp;amp; npm publish &amp;amp;&amp;amp; semantic-release post"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;"postpublish"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;"greenkeeper-postpublish"&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="err"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;Pour voir les complÃ©ments voir directement dans les dÃ©pÃ´ts Github. Jâ€™ai eu lâ€™occasion par la suite de discuter avec RaÃ¹l, jâ€™espÃ¨re quâ€™on aura la chance de le voir passer par Toulouse dans le cadre du Devfest (ou du GDG Toulouse).&lt;/p&gt;&lt;h3 id="angular-forms"&gt;Angular Forms&lt;/h3&gt;&lt;p&gt;Ensuite, je vais voir la prÃ©sentation dâ€™&lt;a href="https://twitter.com/lakatos88"&gt;Alex Lakatos&lt;/a&gt; sur les formulaires. Il fait le tour des solutions pour faire des formulaires dans Angular:&lt;/p&gt;&lt;ul&gt; &lt;li&gt;basÃ©s sur des templates HTML (old fashion) en gros ce quâ€™on faisait en AngularJS&lt;/li&gt; &lt;li&gt;les rÃ©actives forms qui sont plus dynamique et avec moins de code HTML (mais du TypeScript). Le suivi des changements est facilitÃ©s si on utilise les Ã©vÃ¨nements gÃ©nÃ©rÃ©s sous forme dâ€™&lt;code class="highlighter-rouge"&gt;Observable&lt;/code&gt;, et lâ€™ajout de validateur (Ã©ventuellement custom et asynchrone) est plus facile.&lt;/li&gt; &lt;/ul&gt;&lt;p&gt;Les deux types ont leurs avantages et leurs dÃ©fauts, il faut choisir en fonction de la situation. Disons que sur un formulaire simple, on peut se contenter de la version template, mais quâ€™assez rapidement, on arrive Ã  des situations ou les formulaire dynamiques apportent plus.&lt;/p&gt;&lt;h3 id="angular-material"&gt;Angular Material&lt;/h3&gt;&lt;p&gt;DerniÃ¨re prÃ©sentation avant la pause repas, Ã§a devient dur de tenir. Mais &lt;a href="https://twitter.com/ladyleet"&gt;Tracy Lee&lt;/a&gt; nous fait une prÃ©sentation sur &lt;a href="https://material.angular.io/"&gt;Angular Material&lt;/a&gt; qui est surtout du live-coding. Encore une GDE.&lt;/p&gt;&lt;p&gt;Pas Ã©vident de transcrire du live-coding, beaucoup de composants y passent: toolbar, sidenav, icon, grid list, chips, tooltip, dialog, button, card, list, tabs, snackbar. Le plus simple, câ€™est de suivre les slides: &lt;a href="http://www.slideshare.net/ladyleet/angular-material-2-ngvikingsconf"&gt;http://www.slideshare.net/ladyleet/angular-material-2-ngvikingsconf&lt;/a&gt;, et les sources: &lt;a href="https://github.com/ladyleet/ng-vikings-one"&gt;https://github.com/ladyleet/ng-vikings-one&lt;/a&gt;, enfin, un lien partique pour le thÃ¨me matÃ©rial: &lt;a href="https://www.materialpalette.com/"&gt;https://www.materialpalette.com/&lt;/a&gt;&lt;/p&gt;&lt;h3 id="lunch"&gt;Lunch&lt;/h3&gt;&lt;p&gt;Comme tout bon franÃ§ais, je porte une attention toute particuliÃ¨re sur la qualitÃ© des repas (surtout quand je suis Ã  lâ€™Ã©tranger), le buffet froid servi Ã©tait correct et variÃ©. Les pÃ¢tisseries danoises ne sont pas mauvaises, mais pas terrible en terme de diÃ©tÃ©tique. La pose repas câ€™est aussi lâ€™occasion de faire une photo de groupe et de participer au quiz. Les questions Ã©taient tellement simples, que le premier lot a Ã©tÃ© gagnÃ© par le premier venu :P&lt;/p&gt;&lt;p&gt;&lt;a href="/public/images/ngVikings17/lucky.png"&gt;Lucky Guy&lt;/a&gt;&lt;/p&gt;&lt;h3 id="authentication"&gt;Authentication&lt;/h3&gt;&lt;p&gt;Pour commencer doucement lâ€™aprÃ¨s-midi, jâ€™assiste Ã  une prÃ©sentation de &lt;a href="https://twitter.com/simona_cotin"&gt;Simona Cotin&lt;/a&gt; parlant des aspects authentification: une comparaison entre les mÃ©canismes Ã  base de Cookie et JWT. Je connaissais dÃ©jÃ  le sujet, mais sur ce genre de thÃ©matique, une bonne rÃ©vision ne fait jamais de mal.&lt;/p&gt;&lt;p&gt;Les authentifications classiques sont basÃ©es sur un identifiant de session qui est construit cotÃ© serveur, il faut donc conserver cette session en vie (en mÃ©moire, ou dans une base de donnÃ©es), on fonctionne donc en mode â€˜statefullâ€™. Cet Ã©tat est donc gÃ©rÃ© cotÃ© serveur, et cela se complexifie vite si on est sur un architecture distribuÃ©e. CotÃ© client, on stocke gÃ©nÃ©ralement cet identifiant dans un Cookie.&lt;/p&gt;&lt;p&gt;&lt;a href="https://jwt.io/"&gt;JWT (JSON Web Token)&lt;/a&gt; fournit une alternative intÃ©ressante Ã  cette architecture car on va pouvoir Ãªtre â€˜statelessâ€™. Au lieu de renvoyer un identifiant de session, on envoie un token qui contient une partie en JSON (appelÃ© claims ou payload). En plus de ces donnÃ©es le token contient un checksum et les informations nÃ©cessaires pour vÃ©rifier ce checksum. Pour garantir la confiance en ce token il faut aussi associer une clÃ© secrÃ¨te qui est utilisÃ©e pour faire une vÃ©rification avec le checksum. Certains algorithmes utilisÃ©s pour calculer ce checksum utilisent un mÃ©canisme de clÃ© privÃ©e/publique qui permet Ã  tous de vÃ©rifier le token, mais de garantir que câ€™est bien le serveur qui a la responsabliltÃ© dâ€™authentifier lâ€™utilisateur qui gÃ©nÃ¨re le jeton.&lt;/p&gt;&lt;p&gt;Dans une route dâ€™Angular on peut associer un â€˜guardâ€™ qui permet de bloquer des routes si lâ€™utilisateur nâ€™est pas authentifiÃ©.&lt;/p&gt;&lt;p&gt;Il y avait aussi quelques assertions un peu rapides concernant les aspects sÃ©curitÃ©s comme CRSF et XSS que je ne prÃ©fÃ¨re pas rapporter, car je ne suis pas expert dans le domaine et je ne suis pas convaincu quelles soient exactes. Câ€™Ã©tait une bonne prÃ©sentation pour commencer lâ€™aprÃ¨s-midi.&lt;/p&gt;&lt;h3 id="lazy-loading"&gt;Lazy loading&lt;/h3&gt;&lt;p&gt;Ensuite, je suis allÃ© voir &lt;a href="https://twitter.com/manfredsteyer"&gt;Manfred Steyer&lt;/a&gt; qui nous parle du lazy loading des modules dâ€™Angular.&lt;/p&gt;&lt;p&gt;Sa prÃ©sentation Ã©tait super, jâ€™ai apprÃ©ciÃ© lâ€™alternance entre la thÃ©orie et les dÃ©monstrations. Je vous dÃ©tailerai le sujet plus bas. Vous trouverez ses slides ici: &lt;a href="https://speakerdeck.com/manfredsteyer/angular-lazy-loading-ngvikings-in-copenhagen-feb-2017"&gt;https://speakerdeck.com/manfredsteyer/angular-lazy-loading-ngvikings-in-copenhagen-feb-2017&lt;/a&gt;.&lt;/p&gt;&lt;h3 id="sri---sub-resource-integrity"&gt;SRI - Sub Resource integrity&lt;/h3&gt;&lt;p&gt;Jâ€™avais dÃ©jÃ  vu une prÃ©sentation de &lt;a href="https://twitter.com/PhilippeDeRyck"&gt;Philippe De Ryck&lt;/a&gt; Ã  DevoxxBE, câ€™est un expert dans la sÃ©curitÃ© des applications web.&lt;/p&gt;&lt;p&gt;Dans sa prÃ©sentation il se concentre sur la sÃ©curisation du code externe, câ€™est-Ã -dire du code qui peut venir des CDN, des scripts externes (type publicitÃ©, google analytics, â€¦), ou des utilisateurs de notre application. Voir les slides ici: &lt;a href="https://www.websec.be/blog/ngvikings2017/"&gt;https://www.websec.be/blog/ngvikings2017/&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;Pour valider le code venant dâ€™un CDN on peut ajouter un checksum avec lâ€™attribut &lt;code class="highlighter-rouge"&gt;integrity&lt;/code&gt; dans la balise &lt;code class="highlighter-rouge"&gt;&amp;lt;script&amp;gt;&lt;/code&gt;. Le navigateur se chargera de vÃ©rifier ce checksum, et si la vÃ©rification Ã©choue, il interdit lâ€™exÃ©cution du script. Ce mÃ©canisme sâ€™appelle le SRI (Sub Resource Integrity).&lt;/p&gt;&lt;div class="language-html highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="nt"&gt;&amp;lt;script &lt;/span&gt;&lt;span class="na"&gt;src=&lt;/span&gt;&lt;span class="s"&gt;â€œ.../angular.jsâ€&lt;/span&gt; &lt;span class="na"&gt;integrity=&lt;/span&gt;&lt;span class="s"&gt;â€œsha384-Li9v...DqAJâ€&lt;/span&gt; &lt;span class="na"&gt;crossorigin=&lt;/span&gt;&lt;span class="s"&gt;â€œanonymousâ€&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;Attention toutefois, on peut utiliser ce mÃ©canisme pour dÃ©tecter la prÃ©sence dâ€™un fichier. Il faut aussi bien configurer les CORS pour Ã©viter des fuites. Les CDN font des efforts pour simplifier le process, mais on peut aussi le gÃ©nÃ©rer nous-mÃªme, par exemple avec le plugin webpack suivant : &lt;a href="https://github.com/waysact/webpack-subresource-integrity"&gt;webpack-subresource-integrity&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;Le support dans les navigateurs nâ€™est pas &lt;a href="http://caniuse.com/#feat=subresource-integrity"&gt;parfait&lt;/a&gt;, mais Ã§a arrive.&lt;/p&gt;&lt;p&gt;Bien sÃ»r, cela ne suffit pas, car le script peut faire mal les choses et ouvrir des portes supplÃ©mentaires. Voici un rÃ©sumÃ© du talk quâ€™il a donnÃ© sur le sujet &lt;a href="https://www.youtube.com/watch?v=l89acmnGMSc"&gt;Boosting the security of your Angular 2 application - NG-BE 2016&lt;/a&gt;:&lt;/p&gt;&lt;ul&gt; &lt;li&gt;Angular nous protÃ¨ge dÃ©jÃ  du XSS en retirant tout ce qui peut Ãªtre dangereux, câ€™est actif par dÃ©faut.&lt;/li&gt; &lt;li&gt;Attention ne pas laisser les utilisateurs contrÃ´ler les templates, si on fait de lâ€™AOT câ€™est de toute faÃ§on pas possible.&lt;/li&gt; &lt;li&gt;le CSP (Content Security Policy) peut Ã©viter lâ€™exÃ©cution de scripts injectÃ©s.&lt;/li&gt; &lt;/ul&gt;&lt;p&gt;Pour ce qui est de la personnalisation venant des utilisateurs : par exemple si lâ€™application rend possible lâ€™affichage de contenu HTML crÃ©Ã© par un utilisateur, la solution Ã  base dâ€™iframe sandboxÃ©e permet de contrÃ´ler ce qui est possible dans cette iframe.&lt;/p&gt;&lt;div class="language-html highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="nt"&gt;&amp;lt;iframe&lt;/span&gt; &lt;span class="na"&gt;src=&lt;/span&gt;&lt;span class="s"&gt;â€œ...â€&lt;/span&gt; &lt;span class="na"&gt;sandbox&lt;/span&gt; &lt;span class="nt"&gt;&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;/iframe&amp;gt;&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;Dans lâ€™attribut &lt;code class="highlighter-rouge"&gt;sandbox&lt;/code&gt; on peut prÃ©ciser ce qui est possible de faire pour le contenu de lâ€™iframe, par exemple &lt;code class="highlighter-rouge"&gt;allow-scripts&lt;/code&gt; ou &lt;code class="highlighter-rouge"&gt;allow-same-origin&lt;/code&gt;. ATTENTION nâ€™utilisez pas les &lt;code class="highlighter-rouge"&gt;allow-scripts&lt;/code&gt; et &lt;code class="highlighter-rouge"&gt;allow-same-origin&lt;/code&gt; en mÃªme temps. Notez que lâ€™on peut passer directement le code HTML dans lâ€™attribut &lt;code class="highlighter-rouge"&gt;srcdoc&lt;/code&gt; dâ€™une iframe. Pour communiquer avec lâ€™iframe il faut passer par un envoi de message, et cotÃ© iframe il faut penser Ã  contrÃ´ler lâ€™origine des messages.&lt;/p&gt;&lt;div class="language-javascript highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;let&lt;/span&gt; &lt;span class="nx"&gt;iframe&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nx"&gt;HTMLIFrameElement&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getElememtById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'myIFrame'&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="nx"&gt;iframe&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;contentWindow&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;postMessage&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'The message'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'*'&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;div class="language-javascript highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;that&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;addEventListener&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'message'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;event&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;event&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;origin&lt;/span&gt; &lt;span class="o"&gt;===&lt;/span&gt; &lt;span class="s1"&gt;'http://localhost:4200'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nx"&gt;that&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;event&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="p"&gt;});&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;Aujourdâ€™hui, tous les navigateurs supportent les iframes sandboxÃ©es.&lt;/p&gt;&lt;p&gt;Pour information, il sera Ã  DevoxxFR en Avril cette annÃ©e, ne manquez pas sa confÃ©rence â€˜Building Secure Angular Applicatonsâ€™.&lt;/p&gt;&lt;h3 id="coffee-break"&gt;Coffee Break&lt;/h3&gt;&lt;p&gt;Une petite pause dâ€™1h pour faire le plein dâ€™Ã©nergie, et entamer la rÃ©daction de ce post.&lt;/p&gt;&lt;h3 id="patterns"&gt;Patterns&lt;/h3&gt;&lt;p&gt;Je reprends avec la prÃ©sentation de &lt;a href="https://twitter.com/valorkin"&gt;Dmitriy Shekhovtsov&lt;/a&gt; qui nous parle des patterns dans Angular, en particulier sur lâ€™injection de dÃ©pendances. Les sujets abordÃ©s sont : lâ€™injection de dÃ©pendances, les injecteurs, les ServiceLocators, les modules, â€¦&lt;/p&gt;&lt;p&gt;DÃ©solÃ©, mais je nâ€™ai ni les slides, ni pris de photos pour vous faire une retranscription sans bÃªtises, donc je vais mâ€™abstenir.&lt;/p&gt;&lt;h3 id="rxjs-everything-is-a-stream"&gt;RxJS everything is a stream&lt;/h3&gt;&lt;p&gt;Lâ€™avant-derniÃ¨re prÃ©sentation de la journÃ©e concernent RxJS, en effet la programmation rÃ©active est de plus en plus prÃ©sente, et Angular sâ€™adapte parfaitement Ã  cette faÃ§on de dÃ©velopper.&lt;/p&gt;&lt;p&gt;En 1/2 heure &lt;a href="https://twitter.com/chris_noring"&gt;Christoffer Noring&lt;/a&gt; nous explique ce qui est intÃ©ressant avec RxJS par rapport aux callbacks, aux Promises, et aux api de Array. Ensuite, il parcours certains des opÃ©rateurs comme &lt;code class="highlighter-rouge"&gt;map&lt;/code&gt;, &lt;code class="highlighter-rouge"&gt;debounce&lt;/code&gt;, &lt;code class="highlighter-rouge"&gt;switchMap&lt;/code&gt;, &lt;code class="highlighter-rouge"&gt;flatMap&lt;/code&gt;, â€¦ Quelques exemples sur lâ€™autocomplÃ©tion ou le retry sont parfaits pour montrer la puissance du concept.&lt;/p&gt;&lt;p&gt;Vous retrouverez ses slides ici: &lt;a href="http://www.slideshare.net/ChristofferNoring/rxjs-ngvikings"&gt;http://www.slideshare.net/ChristofferNoring/rxjs-ngvikings&lt;/a&gt;. La prÃ©sentation allait super vite, heureusement que jâ€™Ã©tais dÃ©jÃ  assez Ã  lâ€™aise avec ces concepts. Christoffer est un trÃ©s bon speaker.&lt;/p&gt;&lt;h3 id="webpack"&gt;Webpack&lt;/h3&gt;&lt;p&gt;Je finis par la prÃ©sentation de &lt;a href="https://twitter.com/TheLarkInn"&gt;Sean Larkinn&lt;/a&gt;, le mainteneur principal de &lt;a href="www.monkeytechdays.com/"&gt;webpack&lt;/a&gt;. Dans cette prÃ©sentation, il nous parle nous prÃ©sente bien sur Webpack en parcourant les concepts principaux :&lt;/p&gt;&lt;ul&gt; &lt;li&gt;Entry: câ€™est le premier fichier JavaScript qui dÃ©marre lâ€™application (ce quâ€™il faut charger). Les &lt;code class="highlighter-rouge"&gt;import&lt;/code&gt; (ES6 ou TypeScript) ou les &lt;code class="highlighter-rouge"&gt;require&lt;/code&gt; permettent de dÃ©finir le graphe des dÃ©pendances.&lt;/li&gt; &lt;li&gt;Output: câ€™est le rÃ©sultat du bundeling (ou et comment), il est en relation avec lâ€™entrÃ©e.&lt;/li&gt; &lt;li&gt;Loaders: dÃ©crivent comment Webpack doit traiter les fichiers. Ã‡a correspond Ã  une fonction qui prend en entrÃ©e un fichier source et retourne un Ã©tat modifiÃ© (chargÃ©). Le cas typique des transpileurs (TypeScript, Babel). Pour ajouter un loader il faut configurer une expression rÃ©guliÃ¨re de test (ce qui doit passer dans le loader), son nom (&lt;code class="highlighter-rouge"&gt;ts-loader&lt;/code&gt; -&amp;gt; le nom est â€˜tsâ€™) ou une liste de noms (enchainement de loader).&lt;/li&gt; &lt;li&gt;Plugins: tout ce que ne fait pas un loader. En gros on peut faire ce quâ€™on veut a une Ã©tape de compilation. On se branche sur les Ã©vÃ©nements du compilateur. En fait ~ 80% de Webpack est en fait des plugins.&lt;/li&gt; &lt;/ul&gt;&lt;p&gt;Pour faire simple, Entry = What, Output = Where, Loaders = How, Plugins = ğŸ¦„.&lt;/p&gt;&lt;p&gt;Aujourdâ€™hui webpack est devenu indispensable dans les outils de build web, y compris pour autre chose que les applications Angular (angular-cli est basÃ© sur webpack). Il en profite pour faire un appel Ã  la communautÃ© pour que lâ€™avenir de webpack soit radieux.&lt;/p&gt;&lt;p&gt;De mon cÃ´tÃ© il y a quelques annÃ©es, jâ€™avais accueilli avec septisisme lâ€™arrivÃ© de webpack dans lâ€™Ã©cosystÃ¨me des outils de build. En fait il ne fallait pas le voir comme Ã©tant un outil dâ€™exÃ©cution de tÃ¢ches comme le sont par exemple grunt ou gulp, il faut le voir comme Ã©tant un bundler (qui peut dâ€™ailleurs Ãªtre lancÃ© par gulp).&lt;/p&gt;&lt;p&gt;Aujourdâ€™hui, je vois beaucoup mieux son intÃ©rÃªt, en particuliers pour rÃ©soudre les fonctionnalitÃ©s comme lâ€™AOT. Webpack 2 est actuellement la meilleure solution pour le packaging des applications, et je vais devoir mâ€™y mettre sÃ©rieusement, cette prÃ©sentation arrive Ã  point nommÃ© pour moi.&lt;/p&gt;&lt;p&gt;Sean est un super speaker, la pÃªche quâ€™il a est communicative, et câ€™est agrÃ©able pour une audience et des micros qui fatiguent aprÃ¨s une longue journÃ©e. Sa prÃ©sentation montre que Webpack est basÃ© sur des concepts simples.&lt;/p&gt;&lt;h3 id="outro--soirÃ©e"&gt;Outro &amp;amp; soirÃ©e&lt;/h3&gt;&lt;p&gt;Une petite conclusion est faite par les organisateurs, câ€™est le moment de nous expliquer comment se continue la soirÃ©e: dans les goodies, nous avons deux piÃ¨ces qui nous permettent de prendre une boisson au bar de lâ€™universitÃ©, un DJ est lÃ  pour mettre lâ€™ambiance, et bien sÃ»r, un buffet permet de se restaurer.&lt;/p&gt;&lt;p&gt;Câ€™est aussi lâ€™occasion dâ€™Ã©changer avec des participants ou des speakers, vous savez dÃ©jÃ  que je pense que rien que pour ces Ã©changes Ã§a vaut le coup dâ€™aller dans des confÃ©rences. On en profite aussi pour faire les photos avec les costumes de Vikings (sÃ©rieux sâ€™abstenir), mais je prÃ©fÃ¨re ne pas trop tarder, car la confÃ©rence nâ€™est pas terminÃ©e pour moi.&lt;/p&gt;&lt;p&gt;&lt;a href="/public/images/ngVikings17/coin.png"&gt;Coin&lt;/a&gt;&lt;/p&gt;&lt;h2 id="jour-2---workshop-day"&gt;Jour 2 - Workshop day&lt;/h2&gt;&lt;p&gt;Le second jour est dÃ©diÃ© aux workshops, il fallait faire un choix en avance, jâ€™ai optÃ© pour â€˜Advanced Angularâ€™ mais il y avait six autres sujets. Câ€™est &lt;a href="https://twitter.com/manfredsteyer"&gt;Manfred Steyer&lt;/a&gt; qui anime cette session. La premiÃ¨re partie correspond Ã  des slides sur la thÃ©orie et du live-coding pour mettre en application, la seconde partie correspond au lab: câ€™est nous qui faisons.&lt;/p&gt;&lt;p&gt;Je pense quâ€™il nâ€™y a pas de meilleure faÃ§on dâ€™apprendre que de pratiquer (câ€™est ce qui est dâ€™ailleurs Ã  lâ€™origine des &lt;a href="www.monkeytechdays.com/"&gt;MonkeyTechDay&lt;/a&gt;).&lt;/p&gt;&lt;p&gt;On travaille sur une application qui est basÃ©e sur &lt;a href="https://github.com/AngularClass/angular2-webpack-starter"&gt;angular seed&lt;/a&gt;, mais Ã§a peut aussi Ãªtre appliquÃ© sur les applications initialisÃ©es par angular-cli. Vous trouverez une mise en pratique des concepts que lâ€™on va voir dans le dÃ©pÃ´t suivant : &lt;a href="https://github.com/manfredsteyer/AdvAngular.git"&gt;https://github.com/manfredsteyer/AdvAngular.git&lt;/a&gt;.&lt;/p&gt;&lt;h3 id="part-i---lazy-loading"&gt;Part I - lazy loading&lt;/h3&gt;&lt;p&gt;La premiÃ¨re partie correspond en gros Ã  la prÃ©sentation que Manfred avait fait la veille.&lt;/p&gt;&lt;p&gt;Avant de se lancer dans lâ€™aspect lazy loading, on fait un rapide point sur la capacitÃ© dâ€™avoir des routes auxiliaires. Rien de trÃ¨s compliquÃ© : on peut nommer les outlets, et brancher des composants dedans. Câ€™est pratique pour des popups, des modals, des zones autonomes dans les applications, ou bien encore si on fait une application du style â€˜Notorn Commanderâ€™.&lt;/p&gt;&lt;p&gt;Une application classique en Angular va Ãªtre constituÃ©e dâ€™un module principal AppModule, de features modules et dâ€™un SharedModule.&lt;/p&gt;&lt;p&gt;Il va Ãªtre intÃ©ressant de charger les modules de features les moins utilisÃ©s de faÃ§on paresseuse. Pour cela il faut que lâ€™outillage supporte ce mÃ©canisme, ce qui est le cas des projets gÃ©nÃ©rÃ©s par la cli ou angular-seed. En gros câ€™est le plugin &lt;code class="highlighter-rouge"&gt;angular2-router-loader&lt;/code&gt; qui fait le boulot.&lt;/p&gt;&lt;p&gt;Avant dâ€™aller plus loin, une petite astuce tout simple pour dÃ©bugger les routes sous Angular, dans notre module de route, on peut activer les logs comme ceci :&lt;/p&gt;&lt;div class="language-typescript highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="err"&gt;@&lt;/span&gt;&lt;span class="nx"&gt;NgModule&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt; &lt;span class="na"&gt;imports&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;RouterModule&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;forRoot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;routes&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="na"&gt;enableTracing&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;})],&lt;/span&gt; &lt;span class="na"&gt;exports&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;RouterModule&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="na"&gt;providers&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt; &lt;span class="p"&gt;})&lt;/span&gt; &lt;span class="k"&gt;export&lt;/span&gt; &lt;span class="kr"&gt;class&lt;/span&gt; &lt;span class="nx"&gt;AppRoutingModule&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;Ceci va nous permettre dâ€™avoir les informations suivantes :&lt;/p&gt;&lt;p&gt;&lt;img src="/public/images/ngVikings17/route-log.png" alt="Route Logging" /&gt;&lt;/p&gt;&lt;p&gt;Comment active-t-on le lazy loading ? Câ€™est au niveau des routes que lâ€™on va le plus travailler, mais avant cela, la premiÃ¨re Ã©tape câ€™est de retirer notre module des imports de AppModule, â€¦ Ensuite, on va associer notre module Ã  une route particuliÃ¨re et dÃ©finir le chemin du module correspondant.&lt;/p&gt;&lt;div class="language-javascript highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nl"&gt;path&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'lazy'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;loadChildren&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'./modules/lazy/lazy.module.ts#LazyModule'&lt;/span&gt; &lt;span class="c1"&gt;// trigger lazy-loading&lt;/span&gt; &lt;span class="p"&gt;},&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;Puis les sous routes de notre composant seront automatiquement prÃ©fixÃ©e par le chemin de notre module.&lt;/p&gt;&lt;p&gt;Pour vÃ©rifier que lâ€™on a bien un chargement paresseux, il suffit de voir les Ã©lÃ©ments gÃ©nÃ©rÃ©s par webpack, et regarder leur chargement dans le navigateur.&lt;/p&gt;&lt;p&gt;&lt;img src="/public/images/ngVikings17/lazy-module.png" alt="Lazy Module" /&gt; &lt;img src="/public/images/ngVikings17/lazy-network.png" alt="Lazy Loading" /&gt;&lt;/p&gt;&lt;p&gt;Autre point Ã©tudiÃ© dans cette partie : le prÃ©-chargement. En effet, câ€™est bien dâ€™accÃ©lÃ©rer le rendu de la premiÃ¨re page, mais ensuite si on peut charger le reste des modules avant que lâ€™utilisateur en ait besoin, câ€™est mieux. Pour cela, on peut utiliser le â€˜preloadingStrategyâ€™ :&lt;/p&gt;&lt;div class="language-typescript highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7 8 9&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="err"&gt;@&lt;/span&gt;&lt;span class="nx"&gt;NgModule&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt; &lt;span class="na"&gt;imports&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;RouterModule&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;forRoot&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;routes&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="na"&gt;preloadingStrategy&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;PreloadAllModules&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="na"&gt;enableTracing&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt; &lt;span class="p"&gt;})],&lt;/span&gt; &lt;span class="na"&gt;exports&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;RouterModule&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="na"&gt;providers&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt; &lt;span class="p"&gt;})&lt;/span&gt; &lt;span class="k"&gt;export&lt;/span&gt; &lt;span class="kr"&gt;class&lt;/span&gt; &lt;span class="nx"&gt;AppRoutingModule&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;Ici le &lt;code class="highlighter-rouge"&gt;PreloadAllModules&lt;/code&gt; vient de &lt;code class="highlighter-rouge"&gt;@angular/router&lt;/code&gt;, il va automatiquement charger les lazy-modules aprÃ¨s le dÃ©marrage de lâ€™application. On peut bien sÃ»r Ã©crire notre propre preloader, par exemple:&lt;/p&gt;&lt;div class="language-typescript highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7 8 9 10 11 12&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="k"&gt;import&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nx"&gt;PreloadingStrategy&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;Route&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;from&lt;/span&gt; &lt;span class="s2"&gt;"@angular/router"&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;import&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nx"&gt;Observable&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;from&lt;/span&gt; &lt;span class="s2"&gt;"rxjs/Observable"&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="k"&gt;export&lt;/span&gt; &lt;span class="kr"&gt;class&lt;/span&gt; &lt;span class="nx"&gt;CustomPreloadingStrategy&lt;/span&gt; &lt;span class="k"&gt;implements&lt;/span&gt; &lt;span class="nx"&gt;PreloadingStrategy&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nx"&gt;preload&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;route&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;Route&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;fn&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt; &lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="nx"&gt;Observable&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="kr"&gt;any&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;Observable&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="kr"&gt;any&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;route&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;data&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nx"&gt;route&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;'preload'&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="c1"&gt;// si le module a un data: {preload:true}&lt;/span&gt; &lt;span class="kd"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;_1s&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1000&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;Observable&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;of&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;delay&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;_1s&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;flatMap&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;_&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="nx"&gt;fn&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt; &lt;span class="c1"&gt;// on le charge avec un delai de 1s&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;Observable&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;of&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;Attention, on peut avoir de mauvaises surprises quand on active le lazy-loading des modules. En effet, les services dÃ©finis dans le SharedModule seront Ã  nouveau crÃ©Ã©s pour le module lazy au moment du chargement. Pour cela, on peut utiliser le pattern de &lt;a href="https://angular.io/docs/ts/latest/guide/ngmodule.html#!#core-module"&gt;CoreModule&lt;/a&gt;, ou bien plus simplement exposer le SharedModule soit avec les services, soit sans les services.&lt;/p&gt;&lt;div class="language-typescript highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7 8 9 10 11 12&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="err"&gt;@&lt;/span&gt;&lt;span class="nx"&gt;NgModule&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt; &lt;span class="c1"&gt;// ...&lt;/span&gt; &lt;span class="na"&gt;providers&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt; &lt;span class="p"&gt;})&lt;/span&gt; &lt;span class="k"&gt;export&lt;/span&gt; &lt;span class="kr"&gt;class&lt;/span&gt; &lt;span class="nx"&gt;SharedModule&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="k"&gt;static&lt;/span&gt; &lt;span class="nx"&gt;forRoot&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;ModuleWithProviders&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="na"&gt;ngModule&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;SharedModule&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="na"&gt;providers&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;XService&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;YService&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;...]&lt;/span&gt; &lt;span class="p"&gt;};&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;Ces fonctionnalitÃ©s sont trÃ¨s puissantes, par contre on peut vite tomber dans le piÃ¨ge, et il y a beaucoup de boilerplate autour des modules je trouve. Heureusement quâ€™angular-cli est lÃ . Si vous avez encore du mal avec les modules vous pouvez regarder ceci: &lt;a href="http://blog.angular-university.io/angular2-ngmodule/"&gt;http://blog.angular-university.io/angular2-ngmodule/&lt;/a&gt;&lt;/p&gt;&lt;h3 id="part-ii---performance-aot-onpush"&gt;Part II - Performance: AOT, OnPush&lt;/h3&gt;&lt;p&gt;On fait le point sur la compilation AOT, bonne nouvelle câ€™est activÃ© par dÃ©faut dans le &lt;code class="highlighter-rouge"&gt;ng build -prod&lt;/code&gt; avec angular-cli on angular-seed (NgcWebpackPlugin). Pour rappel le principe est de compiler les templates angular en JavaScript, ce qui permet de gagner du temps dans le navigateur, et aussi de retirer la partie compilateur de Angular lors de la construction des packages. Autre point qui est encore jeune : le tree-shaking, ou la capaciter de retirer les branches non utilisÃ©s dans le code pour alÃ©ger les packages. On peut attendre beaucoup dâ€™amÃ©liorations de ce cÃ´tÃ© dans le futur.&lt;/p&gt;&lt;p&gt;Attention, il est important dâ€™avoir du code dÃ©fini avec des modules ES6. Câ€™est important pour les bibliothÃ¨ques que lâ€™on va charger. Quelques remarques supplÃ©mentaires :&lt;/p&gt;&lt;ul&gt; &lt;li&gt;la compilation AOT est plus stricte, on peut avoir des erreurs de compilation remontÃ©es Ã  cette Ã©tape.&lt;/li&gt; &lt;li&gt;le dÃ©marrage de lâ€™application est grandement amÃ©liorÃ©&lt;/li&gt; &lt;li&gt;les tailles ne sont pas toujours plus petites (on ajoute du JavaScript correspondant aux templates)&lt;/li&gt; &lt;li&gt;Ã  utiliser uniquement en production&lt;/li&gt; &lt;/ul&gt;&lt;p&gt;Autre point abordÃ© la stratÃ©gie de mise Ã  jour &lt;code class="highlighter-rouge"&gt;onPush&lt;/code&gt;. Dans le mode par dÃ©faut angular tranverse lâ€™arbre des composants pour mettre Ã  jour lâ€™application. Avec la stratÃ©gie &lt;code class="highlighter-rouge"&gt;onPush&lt;/code&gt;, une comparaison par rÃ©fÃ©rence des &lt;code class="highlighter-rouge"&gt;@input&lt;/code&gt; des composants va Ãªtre faite pour savoir si on traite le composant. Donc dans le cas dâ€™une modification dâ€™un seul Ã©lÃ©ment de tableau on peut optimiser le rafraichissement.&lt;/p&gt;&lt;p&gt;Pour activer ce comportement :&lt;/p&gt;&lt;div class="language-typescript highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7 8 9&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="err"&gt;@&lt;/span&gt;&lt;span class="nx"&gt;Component&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt; &lt;span class="na"&gt;selector&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'my-cmp'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="na"&gt;templateUrl&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'./cmp.component.html'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="na"&gt;changeDetection&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;ChangeDetectionStrategy&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;OnPush&lt;/span&gt; &lt;span class="c1"&gt;// StatÃ©gie OnPush&lt;/span&gt; &lt;span class="p"&gt;})&lt;/span&gt; &lt;span class="k"&gt;export&lt;/span&gt; &lt;span class="kr"&gt;class&lt;/span&gt; &lt;span class="nx"&gt;CmpComponent&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="err"&gt;@&lt;/span&gt;&lt;span class="nx"&gt;Input&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="c1"&gt;// ...&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;Pour notifier dâ€™un changement, il faut donc un nouveau â€˜dataâ€™ en entrÃ©e. On peut utiliser une librairie comme &lt;a href="https://facebook.github.io/immutable-js/"&gt;immutable.js&lt;/a&gt; ou bien faire cela tout simplement en TypeScript.&lt;/p&gt;&lt;p&gt;Note: les opÃ©rations de dÃ©constructions sont trÃ¨s utiles ici : &lt;code class="highlighter-rouge"&gt;const newData = {...oldData, newValue: 'plop'}&lt;/code&gt;.&lt;/p&gt;&lt;p&gt;Dans le cas des &lt;code class="highlighter-rouge"&gt;Observable&lt;/code&gt; utilisÃ©s avec le pipe &lt;code class="highlighter-rouge"&gt;async&lt;/code&gt;, il faudra donc passer par des &lt;code class="highlighter-rouge"&gt;Subject&amp;lt;T&amp;gt;&lt;/code&gt; et faire des &lt;code class="highlighter-rouge"&gt;next(t)&lt;/code&gt; pour dÃ©clancher les mises Ã  jour.&lt;/p&gt;&lt;h3 id="part-iii---i18n"&gt;Part III - i18n&lt;/h3&gt;&lt;p&gt;Dans cette partie, on Ã©tudie les aspects internationalisation, deux solutions sont Ã©tudiÃ©es. La premiÃ¨re est basÃ©e sur le compilateur qui offre de bonnes performances, mais les fichiers de traductions sont compliquÃ©s Ã  maintenir, et cela oblige de gÃ©nÃ©rer une application pour chaque langage supportÃ©.&lt;/p&gt;&lt;p&gt;Lâ€™autre solution que je vais dÃ©tailler utilise &lt;a href="https://github.com/ocombe/ng2-translate"&gt;ng2-translate&lt;/a&gt;, le portage du module qui Ã©tait plÃ©bicitÃ© pour traiter ce sujet en AngularJS.&lt;/p&gt;&lt;p&gt;AprÃ¨s avoir ajoutÃ© la dÃ©pendance npm &lt;code class="highlighter-rouge"&gt;ng2-translate&lt;/code&gt;, il faut importer un module que lâ€™on va construire avec un &lt;code class="highlighter-rouge"&gt;TranslateLoader&lt;/code&gt; :&lt;/p&gt;&lt;div class="language-typescript highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="c1"&gt;// Module to import&lt;/span&gt; &lt;span class="nx"&gt;TranslateModule&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;forRoot&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt; &lt;span class="na"&gt;provide&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;TranslateLoader&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="na"&gt;useFactory&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;http&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;TranslateStaticLoader&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;http&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'./i18n'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'.json'&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="na"&gt;deps&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;Http&lt;/span&gt;&lt;span class="p"&gt;]}&lt;/span&gt; &lt;span class="p"&gt;)&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;Ensuite on configure le &lt;code class="highlighter-rouge"&gt;TranslateService&lt;/code&gt; :&lt;/p&gt;&lt;div class="language-typescript highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="k"&gt;private&lt;/span&gt; &lt;span class="nx"&gt;initNgTranslate&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;translate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;addLangs&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="s1"&gt;'en'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'fr'&lt;/span&gt;&lt;span class="p"&gt;]);&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;translate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;setDefaultLang&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'navigator.language || navigator.userLanguage'&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="c1"&gt;// Pour avoir la langue par dÃ©faut du navigateur&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;translate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;use&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'fr'&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;On va ensuite crÃ©er les fichiers JSON contenant les traductions dans &lt;code class="highlighter-rouge"&gt;i18n/fr.json&lt;/code&gt; et &lt;code class="highlighter-rouge"&gt;i18n/en.json&lt;/code&gt;. Puis il suffit dâ€™utiliser &lt;code class="highlighter-rouge"&gt;ma.clef | translate&lt;/code&gt; pour avoir la version internationalisÃ©e.&lt;/p&gt;&lt;p&gt;Enfin pour changer de langue, on pourra faire :&lt;/p&gt;&lt;div class="language-html highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt; &lt;span class="nt"&gt;&amp;lt;button&lt;/span&gt; &lt;span class="na"&gt;class=&lt;/span&gt;&lt;span class="s"&gt;"btn btn-default"&lt;/span&gt; &lt;span class="err"&gt;(&lt;/span&gt;&lt;span class="na"&gt;click&lt;/span&gt;&lt;span class="err"&gt;)="&lt;/span&gt;&lt;span class="na"&gt;setLang&lt;/span&gt;&lt;span class="err"&gt;('&lt;/span&gt;&lt;span class="na"&gt;en&lt;/span&gt;&lt;span class="err"&gt;')"&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;ğŸ‡¬ğŸ‡§&lt;span class="nt"&gt;&amp;lt;/button&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;button&lt;/span&gt; &lt;span class="na"&gt;class=&lt;/span&gt;&lt;span class="s"&gt;"btn btn-default"&lt;/span&gt; &lt;span class="err"&gt;(&lt;/span&gt;&lt;span class="na"&gt;click&lt;/span&gt;&lt;span class="err"&gt;)="&lt;/span&gt;&lt;span class="na"&gt;setLang&lt;/span&gt;&lt;span class="err"&gt;('&lt;/span&gt;&lt;span class="na"&gt;fr&lt;/span&gt;&lt;span class="err"&gt;')"&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;ğŸ‡«ğŸ‡·&lt;span class="nt"&gt;&amp;lt;/button&amp;gt;&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;div class="language-typescript highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt; &lt;span class="k"&gt;public&lt;/span&gt; &lt;span class="nx"&gt;setLang&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;lang&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt; &lt;span class="kr"&gt;string&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;translateService&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;use&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;lang&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;h3 id="part-iv---authentification"&gt;Part IV - authentification&lt;/h3&gt;&lt;p&gt;La derniÃ¨re partie correspond aux aspects authentification, on parle de JWT de OAuth de &lt;a href="http://openid.net/connect/"&gt;OIDC (OpenId Connect)&lt;/a&gt;. En gros, on voit comment on peut utiliser &lt;a href="https://github.com/manfredsteyer/angular-oauth2-oidc"&gt;angular-oauth2-oidc&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;Le sujet de lâ€™authentification est vaste, et trÃ¨s liÃ© au SI de mes clients, je ne me suis donc pas trop concentrÃ© sur cette partie.&lt;/p&gt;&lt;h2 id="conclusion"&gt;Conclusion&lt;/h2&gt;&lt;p&gt;Mes attentes ont Ã©tÃ© comblÃ©es lors de ce WE danois. AprÃ¨s cette confÃ©rence, je vois bien que la plateforme est aujourdâ€™hui mature, et que lâ€™Ã©cosystÃ¨me est aujourdâ€™hui suffisamment stable pour que lâ€™on dÃ©marre des projets Angular y compris dans des sociÃ©tÃ©s qui sont plus conservatrices dans leurs choix techniques.&lt;/p&gt;&lt;p&gt;Jâ€™aime beaucoup lâ€™idÃ©e dâ€™un jour spÃ©cifique pour faire un workshop, cela mâ€™a vraiment permis de prendre du recul sur Angular, et de me sentir plus Ã  lâ€™aise avec des concepts avancÃ©s. Câ€™est avec beaucoup de confiance que je vais aborder mes prochains projets en Angular.&lt;/p&gt;&lt;p&gt;Bravo pour les organisateurs, les sponsors, les speakers, et tous les gens qui rendent ce genre dâ€™Ã©vÃ¨nement possible. Il faut bien sÃ»r que je rajoute Ã  cette liste &lt;a href="https://twitter.com/angulartoulouse"&gt;@angularToulouse&lt;/a&gt; et &lt;a href="http://www.monkeypatch.io/"&gt;MonkeyPatch&lt;/a&gt; sans qui je nâ€™y serais pas allÃ©, et aux relecteurs/correcteurs de ce post.&lt;/p&gt;&lt;p&gt;Enfin jâ€™ai eu lâ€™occasion de discuter avec plein de dÃ©veloppeurs (speaker) passionnÃ©s, il y avait une super ambiance, la communautÃ© Angular est vraiment gÃ©niale. Vivement lâ€™an prochain !&lt;/p&gt;&lt;p&gt;Vous retrouverez les vidÃ©os ici: &lt;a href="https://ngvikings.org/schedule/day1"&gt;https://ngvikings.org/schedule/day1&lt;/a&gt;, et dâ€™autres retours :&lt;/p&gt;&lt;p&gt;&lt;a href="http://jsdiaries.com/2017/02/20/angular-ngvikings-2017/"&gt;http://jsdiaries.com/2017/02/20/angular-ngvikings-2017/&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href="https://home.lundogbendsen.dk/ngvikings-angular-conference-2017/"&gt;https://home.lundogbendsen.dk/ngvikings-angular-conference-2017/&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href="https://blog.jayway.com/2017/02/16/conference-report-ngvikings-2017/"&gt;https://blog.jayway.com/2017/02/16/conference-report-ngvikings-2017/&lt;/a&gt;&lt;/p&gt;&lt;p&gt;Note: vous avez les liens vers les slides qui manquent, ou tout simplement des remarques, utilisez les commentaires pour complÃ©ter ce postâ€¦&lt;/p&gt;&lt;h2 id="quelques-photos-pour-finir"&gt;Quelques photos pour finir&lt;/h2&gt;&lt;p&gt;Lâ€™universitÃ© IT de Copenhague :&lt;/p&gt;&lt;p&gt;&lt;img src="/public/images/ngVikings17/venue.png" alt="Venue" /&gt;&lt;/p&gt;&lt;p&gt;Apprenti vikings (peu convaincant) :&lt;/p&gt;&lt;p&gt;&lt;img src="/public/images/ngVikings17/Yarrrgh.jpg" alt="Yarrrgh" /&gt;&lt;/p&gt;&lt;p&gt;Salle pour discuter avec les speakers :&lt;/p&gt;&lt;p&gt;&lt;img src="/public/images/ngVikings17/speakers-room.png" alt="Speaker room" /&gt;&lt;/p&gt;&lt;p&gt;On peut manger des tapas Ã  Copenhague :&lt;/p&gt;&lt;p&gt;&lt;img src="/public/images/ngVikings17/tapas.png" alt="Tapas" /&gt;&lt;/p&gt;&lt;p&gt;Beaucoup de sÃ©rieux dans lâ€™organisation :&lt;/p&gt;&lt;p&gt;&lt;img src="/public/images/ngVikings17/organisateurs.png" alt="Organisateurs" /&gt;&lt;/p&gt;&lt;p&gt;Il fait un peu plus froid quâ€™a Toulouse :&lt;/p&gt;&lt;p&gt;&lt;img src="/public/images/ngVikings17/climat.png" alt="Climat" /&gt;&lt;/p&gt;</content> <author> <name>Igor Laborie</name> <email>igor@monkeypatch.io</email> </author> <category term="ngVikings"/> <category term="Angular"/> <category term="WebSecurity"/> <category term="RxJS"/> <summary>IntroductionÃ€ peine remis du MonkeyTechDay #3: Reactive Streams coachÃ© par @sdeleuze, je prends lâ€™avion direction Copenhague pour assister Ã  la premiÃ¨re Ã©dition de ngVikings.Pour un retour sur le MKTD, voir le retour de Maxime#Stereotype, Au Danemark il fait plus froid quâ€™Ã  Toulouse, il y a des Lego, des Carlseberg, et une sirÃ¨ne.Jâ€™ai plutÃ´t lâ€™habitude de participer Ã  des confÃ©rences assez gÃ©nÃ©ralistes, mais lÃ , je vais faire deux jours intÃ©gralement sur du Angular (comprendre Angular 2+ pour ceux qui ne font pas encore la diffÃ©rence entre AngularJs et â€˜Just Angularâ€™).Câ€™est pour moi lâ€™occasion dâ€™approfondir le sujet, de voir lâ€™Ã©cosystÃ¨me, et de rencontrer des dÃ©veloppeurs passionnÃ©s par ce sujet.Je constate que certains â€˜grands comptesâ€™ Toulousains font un premier pas vers Angular sur leurs nouveaux projets, câ€™est donc le moment idÃ©al pour moi dâ€™aller plus loin sur le sujet.</summary> <media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://ngvikings.org/images/backgrounds/2017.jpg"/> </entry> <entry xml:lang="fr"><title>Devoxx Belgium</title><link href="http://www.monkeypatch.io/2016/11/27/Devoxx-Belgium.html" rel="alternate" type="text/html" title="Devoxx Belgium"/> <published>2016-11-27T00:00:00+01:00</published> <updated>2016-11-27T00:00:00+01:00</updated><id>http://www.monkeypatch.io/2016/11/27/Devoxx-Belgium</id> <content type="html" xml:base="http://www.monkeypatch.io/2016/11/27/Devoxx-Belgium.html">&lt;h2 id="welcome-to-antwerp-anvers"&gt;Welcome to Antwerp (Anvers)&lt;/h2&gt;&lt;p&gt;A peine remis du &lt;a href="https://devfesttoulouse.fr/"&gt;DevFest Toulouse&lt;/a&gt;, je pars une semaine en Belgique pour aller Ã  &lt;a href="https://devoxx.be/"&gt;Devoxx&lt;/a&gt;. Pour ceux qui ne connaissent pas encore Devoxx, câ€™est une confÃ©rence indÃ©pendante : elle nâ€™est organisÃ©e ni par Google ni par Oracle. Cela dit ils Ã©taient prÃ©sent en temps que sponsors et speakers. Câ€™est la plus grosse confÃ©rence auquel jâ€™ai assistÃ© (3500 dÃ©veloppeurs), câ€™est pas tous les jours quâ€™on a lâ€™occasion de croiser des &lt;a href="http://cfp.devoxx.be/2016/speaker/brian_goetz"&gt;Brian Goetz&lt;/a&gt;, &lt;a href="http://cfp.devoxx.be/2016/speaker/venkat_subramaniam"&gt;Venkat Subramaniam&lt;/a&gt;, â€¦ en Europe. &lt;!--more--&gt;&lt;/p&gt;&lt;p&gt;Devoxx Belgique câ€™est aussi un peu la mÃ¨re de toutes les confÃ©rences Devoxx et Voxxed qui se sont crÃ©Ã©es ces derniÃ¨res annÃ©es (France, Maroc, US, Pologne, â€¦). Câ€™est aussi la bataille des buzzwords, a votre avis qui est le perdant parmis: Docker, MicroServices, JEE, Programation Reactive ?&lt;/p&gt;&lt;p&gt;La confÃ©rence a lieu dans un complexe cinÃ©ma, on a donc des grandes salles, les Ã©crans qui vont avec, et des fauteuils super confortables. CotÃ© boissons les soda, jus dâ€™orange, â€¦ sont open-bar; du coup il y a la queue aux toilettes. Les repas ne sont pas terribles (sandwich bof), câ€™est sur quâ€™en France les confÃ©rences sont particuliÃ¨rement attentive aux repas; a notÃ© tout de mÃªme la soirÃ©e biÃ¨res-frites, un moment parfais pour dâ€™Ã©changÃ© sur des thÃ¨mes divers (Merci Pivotal pour les biÃ¨res). On aura aussi le droit Ã  une sÃ©ance de cinÃ© pour aller voir â€œSnowdenâ€, sÃ©ance que jâ€™ai esquivÃ© pour aller manger en ville avec quelques Toulousaing.&lt;/p&gt;&lt;p&gt;Chose gÃ©nial, les vidÃ©os sont uploadÃ©s sur Youtube dÃ¨s le lendemain, vous pouvez donc les trouvÃ©es sur &lt;a href="https://www.youtube.com/playlist?list=PLRsbF2sD7JVq_TvmCyJC3-oT9nBGdwq6s"&gt;Youtube&lt;/a&gt;. Par exemple vous avez une playlist avec les &lt;a href="https://www.youtube.com/playlist?list=PLRsbF2sD7JVrP_MJaOWvaK9-OTNX2oFwB"&gt;prÃ©sentations les mieux notÃ©es&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;Ici câ€™est impossible de vous faire un compte rendu dÃ©taillÃ© de toutes les confÃ©rences auxquelles jâ€™ai assistÃ©, donc je vais juste dÃ©tailler quelques thÃ©matiques que jâ€™ai particuliÃ¨rement suivies.&lt;/p&gt;&lt;h2 id="java-maintenant"&gt;Java maintenant&lt;/h2&gt;&lt;p&gt;Lors de plusieurs confÃ©rences il y a eu des sondages Ã  main lever pour savoir quelle version du JDK Ã©tait utilisÃ©e, presque tout le monde est sur Java 8, ceux qui sont en dessous sont souvent liÃ© Ã  Android, cela dit on peu combler une partie du dÃ©ficit avec &lt;a href="https://github.com/orfjackal/retrolambda"&gt;RetroLambda&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;La version 8 du langage apporte une touche de programmation fonctionnelle dans Java, ce qui ouvrent de nouvelles portes. Jâ€™encourage fortement les Ã©quipes de dÃ©veloppeurs Ã  se poser la question : â€˜Comment ferait-on Ã§a proprement Ã  la mode Java 8 ?â€™ pendant leurs phases de conceptions, refactoring et dans les revues de codes.&lt;/p&gt;&lt;p&gt;Aujourdâ€™hui les designs patterns classiques (GoF par ex.) sont gÃ©nÃ©ralement obsolÃ¨tes avec lâ€™arrivÃ© de cette nouvelle faÃ§on de dÃ©velopper, on y gagne tellement en terme de lisibilitÃ©, compacitÃ©, maintenabilitÃ©, testabilitÃ©. Attention toutefois Ã  faire au maximum des fonctions pures (sans effet de bords).&lt;/p&gt;&lt;p&gt;Cela dit il y a encore une lourdeurs ou certains manques dans les API (e.g. il manque les tuples, &lt;code class="highlighter-rouge"&gt;flatMap&lt;/code&gt; et &lt;code class="highlighter-rouge"&gt;Optional&lt;/code&gt;), et on peut espÃ©rer que ces points soit amÃ©liorÃ©s dans le futures (voir plus bas).&lt;/p&gt;&lt;p&gt;Voici quelques prÃ©sentations intÃ©ressantes:&lt;/p&gt;&lt;ul&gt; &lt;li&gt;&lt;a href="https://www.youtube.com/watch?v=Rmer37g9AZM"&gt;gâˆ˜f patterns (Mario Fusco)&lt;/a&gt; : une revisite des patterns du GoF Ã  lâ€™aune des lambas et des &lt;code class="highlighter-rouge"&gt;@FunctionalInterface&lt;/code&gt;.&lt;/li&gt; &lt;li&gt;&lt;a href="https://www.youtube.com/watch?v=Ej0sss6cq14"&gt;Optional - The Mother of All Bikesheds (Stuart Marks)&lt;/a&gt;: un point sur cette classe controversÃ© du JDK. La bonne nouvelle on va pouvoir faire du &lt;code class="highlighter-rouge"&gt;flatMap&lt;/code&gt; plus facilement avec les &lt;code class="highlighter-rouge"&gt;Optional&lt;/code&gt; dans le JDK 9.&lt;/li&gt; &lt;li&gt;&lt;a href="https://www.youtube.com/watch?v=b8YX45ymAeE"&gt;Java Collections: The Force Awakens (Raoul-Gabriel Urma and Richard Warburton)&lt;/a&gt; : un point sur les collections en Java. Câ€™est une excellente rÃ©vision sur cette API indispensable Ã  maitriser.&lt;/li&gt; &lt;li&gt;&lt;a href="https://www.youtube.com/watch?v=NcetKbGayZY&amp;amp;index=7&amp;amp;list=PLRsbF2sD7JVrP_MJaOWvaK9-OTNX2oFwB"&gt;Refactoring to Java 8 (Trisha Gee)&lt;/a&gt;: beaucoup dâ€™exemple de refactoring, avec les impacts sur les performances.&lt;/li&gt; &lt;/ul&gt;&lt;p&gt;Vous trouverez bien sÃ»r dâ€™autres prÃ©sentations sur le sujet, par exemple il y a eu deux talks parlant de &lt;a href="http://www.javaslang.io/"&gt;JavaSlang&lt;/a&gt; qui porte beaucoup dâ€™Ã©lÃ©ments de &lt;a href="http://www.scala-lang.org/"&gt;Scala&lt;/a&gt; dans Java comme par exemple le PatternMatching.&lt;/p&gt;&lt;p&gt;Dâ€™autres prÃ©sentations sont plus dans lâ€™esprit â€˜BrainFuckingâ€™, je trouve Ã§a amusant quand Ã§a reste Ã  petite dose:&lt;/p&gt;&lt;ul&gt; &lt;li&gt;&lt;a href="https://www.youtube.com/watch?v=bhSBpNXwa60"&gt;Itâ€™s Java Jim, But Not As We Know It (Simon Ritter)&lt;/a&gt;&lt;/li&gt; &lt;li&gt;&lt;a href="https://www.youtube.com/watch?v=tSbK3A9QMmI"&gt;Lambda Puzzlers by Peter Lawrey&lt;/a&gt;&lt;/li&gt; &lt;/ul&gt;&lt;h2 id="java-demain"&gt;Java demain&lt;/h2&gt;&lt;p&gt;Je me suis aussi beaucoup tournez vers les prÃ©sentations qui parlaient de Java 9, et des Ã©ventuelles nouveautÃ©s que lâ€™on verra (peut-Ãªtre) dans les versions postÃ©rieurs du langage. Les architectes du langage qui avaient fait le dÃ©placement cette annÃ©e, câ€™est toujours marrant de les voir se serrÃ©s sur une petite table au resto, alors quâ€™on avait profitÃ© de la grande (premier arriver, premier servie).&lt;/p&gt;&lt;p&gt;On a dâ€™abort eu le droit dâ€™une prÃ©sentation de Java 9, ainsi que du projet &lt;a href="http://openjdk.java.net/projects/valhalla/"&gt;Valhalla&lt;/a&gt; et du projet &lt;a href="http://openjdk.java.net/projects/panama/"&gt;Panama&lt;/a&gt; lors de la Keynote dâ€™Oracle, câ€™est un excellent rÃ©sumÃ© concernant le future de Java: &lt;a href="https://www.youtube.com/watch?v=e9eSPtpiGkA"&gt;Keynote Session (Mark Reinhold and Brian Goetz)&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;En gros il y a beaucoup de â€˜petitesâ€™ modifications internes dans Java 9, mais il y a surtout &lt;a href="http://openjdk.java.net/projects/jigsaw/"&gt;Jigsaw&lt;/a&gt; qui apporte la modularitÃ©. Jâ€™ai Ã©vitÃ© ce sujet que jâ€™avais dÃ©jÃ  pas mal suivit auparavant. Je pense que la modularitÃ© va apporter quelque chose dâ€™indispensable en Java pour ne pas Ãªtre trop vite distancÃ© par les nouveaux langages systÃ¨mes comme &lt;a href="http://swift.org/"&gt;Swift&lt;/a&gt; ou &lt;a href="https://www.rust-lang.org/fr/"&gt;Rust&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;Jâ€™ai quand mÃªme un peu peur que ce JDK prennent plus de temps que Java 8 Ã  Ãªtre adopter; lâ€™avenir nous le dira. Maven est plutÃ´t bon dans la compatibilitÃ© avec Java 9, câ€™est plutÃ´t rassurant.&lt;/p&gt;&lt;p&gt;Autre nouveautÃ© dans Java 9, lâ€™arrivÃ©e dâ€™un REPL: JShell. Câ€™est assez intÃ©ressant, mais jâ€™ai tellement pris lâ€™habitude de mâ€™en passer, quâ€™il va me falloir du temps pour trouver les usages au quotidien.&lt;/p&gt;&lt;p&gt;Je suis aussi aller voir la prÃ©sentation sur le nouveau client HTTP/2 (JEP 110), lÃ  jâ€™ai Ã©tÃ© un peu dÃ©Ã§u car il est possible que ce soit considÃ©rÃ© en â€˜incubationâ€™ pour Java 9. Jâ€™espÃ¨re que nous aurons une bonne surprise. lâ€™usage du &lt;code class="highlighter-rouge"&gt;CompletableFuture&lt;/code&gt; est bienvenue pour les aspects asynchrone.&lt;/p&gt;&lt;p&gt;Et aprÃ¨s Java 9, que va tâ€™il se passer ? Les speakers dâ€™Oracle sont trÃ¨s prudents sur les nouveautÃ©s qui sont prÃ©sentÃ©es, il est tout Ã  fait possible quâ€™elles soient diffÃ©rentes voir abandonnÃ©es par la suite. Voici une liste de ceux qui pourraient arrivÃ© (on parle pour Java &amp;gt; 9):&lt;/p&gt;&lt;ul&gt; &lt;li&gt;Meilleur infÃ©rence de type, on pourrait voir des chose comme Ã§a: &lt;code class="highlighter-rouge"&gt;var url = new URL("...");&lt;/code&gt;&lt;/li&gt; &lt;li&gt;Data Classes pour faire des trucs comme &lt;code class="highlighter-rouge"&gt;class Point(int x, int y){}&lt;/code&gt;&lt;/li&gt; &lt;li&gt;Un meilleur switch qui se rapprochera a du Pattern Matching, on pourrait voir les choses arrivÃ©es progressivement, dâ€™autant plus avec les Data Classes.&lt;/li&gt; &lt;li&gt;&lt;a href="http://openjdk.java.net/projects/valhalla/"&gt;Valhalla&lt;/a&gt; Ã©tudie la possibilitÃ© dâ€™une nouvelle organisation de la mÃ©moire pour des donnÃ©es. Disons plus simplement Ã§a correspondrait Ã  la notion de Value Class. Ces objets serait passÃ©s par valeur (pas par rÃ©fÃ©rence) ce qui donnerait â€œCodes like a class, works like an intâ€. En gros Ã§a permettrait aussi de faire des &lt;code class="highlighter-rouge"&gt;List&amp;lt;int&amp;gt;&lt;/code&gt;. Ce serait une Ã©norme Ã©volution dans le langage, jâ€™ai beaucoup dâ€™espoir sur cet Ã©volution. Maintenant il ne faudrait pas que Ã§a arrive trop tard par rapport aux nouveaux langages.&lt;/li&gt; &lt;li&gt;&lt;a href="http://openjdk.java.net/projects/panama/"&gt;Panama&lt;/a&gt; est un reboot pour faire des appels Ã  du code native. Lâ€™idÃ©e câ€™est de faire plus simple, plus sure, et plus rapide, la dÃ©mo est fun.&lt;/li&gt; &lt;/ul&gt;&lt;p&gt;On retrouve beaucoup de choses qui sont sont dÃ©jÃ  prÃ©sentes dans des langages, jâ€™y vois personnellement une excuse pour Ã©tudier ces langages, et pouvoir Ãªtre Ã  lâ€™aise lorsquâ€™on aura ces features dans Java.&lt;/p&gt;&lt;p&gt;Voici une sÃ©lection de prÃ©sentations, pour celles qui concernent Jigsaw et la modularitÃ© je vous laisse chercher.&lt;/p&gt;&lt;ul&gt; &lt;li&gt;&lt;a href="https://www.youtube.com/watch?v=e9eSPtpiGkA"&gt;Keynote Session (Mark Reinhold and Brian Goetz)&lt;/a&gt;&lt;/li&gt; &lt;li&gt;&lt;a href="https://www.youtube.com/watch?v=8XmYT89fBKg&amp;amp;list=PLRsbF2sD7JVq_TvmCyJC3-oT9nBGdwq6s&amp;amp;index=43"&gt;Exploring Java 9 (Venkat Subramaniam)&lt;/a&gt;&lt;/li&gt; &lt;li&gt;&lt;a href="https://www.youtube.com/watch?v=oGll155-vuQ&amp;amp;list=PLRsbF2sD7JVrP_MJaOWvaK9-OTNX2oFwB&amp;amp;index=9"&gt;Java Language and Platform Futures: A Sneak Peek (Brian Goetz)&lt;/a&gt;&lt;/li&gt; &lt;li&gt;&lt;a href="https://www.youtube.com/watch?v=53RcDiKb6Ls"&gt;Java9 and the impact on Maven Projects (Robert Scholte)&lt;/a&gt;&lt;/li&gt; &lt;li&gt;&lt;a href="https://www.youtube.com/watch?v=96vce1qd0QY&amp;amp;list=PLRsbF2sD7JVrP_MJaOWvaK9-OTNX2oFwB&amp;amp;index=38"&gt;Anticipating Java 9 - Functionality and Tooling (Trisha Gee)&lt;/a&gt;&lt;/li&gt; &lt;/ul&gt;&lt;h2 id="programation-rÃ©active"&gt;Programation rÃ©active&lt;/h2&gt;&lt;p&gt;DerniÃ¨re grand thÃ©matique que jâ€™ai suivi: la programmation rÃ©active. Câ€™est un sujet chaud, il y avait pas mal de prÃ©sentations concernant de prÃ¨s ou de loin ce sujet. Tout dâ€™abort il faut noter quâ€™ avec Java 8, les API sont beaucoup plus agrÃ©able Ã  utiliser, ensuite les &lt;a href="http://www.reactive-streams.org/"&gt;Reactive Streams&lt;/a&gt; arrive dans Java 9 avec la classe &lt;a href="http://download.java.net/java/jdk9/docs/api/java/util/concurrent/Flow.html"&gt;&lt;code class="highlighter-rouge"&gt;Flow&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;Aujourâ€™hui, &lt;a href="http://akka.io/"&gt;Akka Stream 2&lt;/a&gt;, &lt;a href="https://projectreactor.io/"&gt;Reactor Core 3&lt;/a&gt; et &lt;a href="https://github.com/ReactiveX/RxJava"&gt;RxJava 2&lt;/a&gt; implÃ©mÃ©nent les Reactives Streams sur la JVM.&lt;/p&gt;&lt;p&gt;Pour une excellent introduction sur le sujet je vous recommande lâ€™universitÃ© &lt;a href="https://www.youtube.com/watch?v=weWSYIUdX6c&amp;amp;list=PLRsbF2sD7JVrP_MJaOWvaK9-OTNX2oFwB&amp;amp;index=4"&gt;Reactive Programming (Venkat Subramaniam)&lt;/a&gt; qui prends le temps pour prÃ©senter le concept de la programmation rÃ©active, puis montre beaucoup de code avec RxJava pour montrer: les observables, lâ€™asynchronisme, la gestion des erreurs, les opÃ©rateurs sur les Observables, la notion dâ€™observable chaud ou froid, le principe de backpressure. Le backpressure câ€™est quand votre Ã©metteur va plus vite que le consommateur, câ€™est quelque chose qui a mis du temps Ã  Ãªtre simple et proprement implÃ©mentÃ© dans les API.&lt;/p&gt;&lt;p&gt;Jâ€™ai aussi beaucoup apprÃ©ciÃ© lâ€™universitÃ© &lt;a href="https://www.youtube.com/watch?v=Cj4foJzPF80&amp;amp;list=PLRsbF2sD7JVrP_MJaOWvaK9-OTNX2oFwB&amp;amp;index=37&amp;amp;t=3s"&gt;Developing Reactive applications with Reactive Streams and Java 8 (Brian Clozel, SÃ©bastien Deleuze)&lt;/a&gt; qui prÃ©sente &lt;a href="https://github.com/reactor/reactor-core"&gt;Reactore Core 3&lt;/a&gt; dans la premiÃ¨re partie au travers de test unitaires. Je suis trÃ¨s agrÃ©ablement surpris par la testabilitÃ© quâ€™apporte le &lt;code class="highlighter-rouge"&gt;StepVerifier&lt;/code&gt;. Dans la seconde partie, une dÃ©monstration de Spring Boot 2, avec Spring Framework 5 montre comment on peut passer en rÃ©active cotÃ© backend. TrÃ¨s intÃ©ressant, jâ€™attends avec impatiance la version â€˜production-readyâ€™ de ces projets.&lt;/p&gt;&lt;p&gt;Je nâ€™ai pas encore eu le temps de regarder &lt;a href="https://www.youtube.com/watch?v=rdgJ8fOxJhc&amp;amp;list=PLRsbF2sD7JVrP_MJaOWvaK9-OTNX2oFwB&amp;amp;index=29"&gt;Reactive Web Applications with Spring 5 (Rossen Stoyanchev)&lt;/a&gt;, mais jâ€™ai eu de bon retour.&lt;/p&gt;&lt;p&gt;Sinon il y avait aussi des prÃ©sentations concernant &lt;a href="http://vertx.io/"&gt;Vert.x&lt;/a&gt;, Akka Streams, â€¦&lt;/p&gt;&lt;p&gt;Ceux qui me connaissent savent que je suis trÃ¨s intÃ©ressÃ© par ce sujet, on prÃ©voit un &lt;a href="https://www.meetup.com/fr-FR/Monkey-Tech-Days/events/232103376/"&gt;MonkeyTechDay&lt;/a&gt; en dÃ©but dâ€™annÃ©e sur le sujet.&lt;/p&gt;&lt;h2 id="autres-sujets"&gt;Autres sujets&lt;/h2&gt;&lt;p&gt;Bien sur le Machine Learning, et les sujet Devops Ã©taient trÃ¨s bien reprÃ©sentÃ© dans les confÃ©rences. Je rattraperais Ã§a avec les vidÃ©os. Je suis aussi aller voir dâ€™autres sujets, je vous fait une petite listes de ce que jâ€™ai trouvÃ© sympa.&lt;/p&gt;&lt;ul&gt; &lt;li&gt;&lt;a href="https://www.youtube.com/watch?v=3eOFCn5COvc&amp;amp;list=PLRsbF2sD7JVrP_MJaOWvaK9-OTNX2oFwB&amp;amp;index=16"&gt;Zen &amp;amp; The Art of Angular 2 (Igor Minar)&lt;/a&gt;: jâ€™aime bien Angular2, je nâ€™ai pas beaucoup appris, mais câ€™est sympa dâ€™avoir un des crÃ©ateurs sur scÃ¨ne.&lt;/li&gt; &lt;li&gt;&lt;a href="https://www.youtube.com/watch?v=1oKlYgsnyfw&amp;amp;list=PLRsbF2sD7JVrP_MJaOWvaK9-OTNX2oFwB&amp;amp;index=3"&gt;Make CSS Fun Again with Flexbox! (Hubert SablonniÃ¨re)&lt;/a&gt;: un des meilleurs speaker franÃ§ais.&lt;/li&gt; &lt;li&gt;&lt;a href="https://www.youtube.com/watch?v=UHN_HcjZa7o&amp;amp;index=21&amp;amp;list=PLRsbF2sD7JVrP_MJaOWvaK9-OTNX2oFwB"&gt;Deep Dive into JUnit 5 (Sam Brannen)&lt;/a&gt;&lt;/li&gt; &lt;li&gt;&lt;a href="https://www.youtube.com/watch?v=jSY3n_h7JV0"&gt;Swift: the mobile language thatâ€™s coming to the cloud (Ian Partridge)&lt;/a&gt; : la prÃ©sentation nâ€™est pas exceptionnelle, mais je suis assez intÃ©resser par le langage cotÃ© Backend.&lt;/li&gt; &lt;li&gt;&lt;a href="https://www.youtube.com/watch?v=03GsLxVdVzU&amp;amp;index=33&amp;amp;list=PLRsbF2sD7JVrP_MJaOWvaK9-OTNX2oFwB"&gt;Designing for Performance by Martin Thompson&lt;/a&gt;&lt;/li&gt; &lt;/ul&gt;&lt;h2 id="conclusion"&gt;Conclusion&lt;/h2&gt;&lt;p&gt;Encore une super semaine, jâ€™ai encore appris plein de choses, eu de super Ã©changes, plein dâ€™envie. Il faut toutefois un peu de temps pour digÃ©rer et laisser dÃ©canter tout cela (et faire mon compte rendu). Donc merci encore Ã  tous les organisateurs, bÃ©nÃ©voles, speaker, et tous les gens sympa avec qui jâ€™ai eu lâ€™occasion dâ€™Ã©changer ou de partager une biÃ¨re.&lt;/p&gt;&lt;h2 id="pour-finir-quelques-photos"&gt;Pour finir quelques photos&lt;/h2&gt;&lt;p&gt;Fier dâ€™Ãªtre speaker :&lt;/p&gt;&lt;p&gt;&lt;img src="/public/images/DevoxxBE16/Speaker.jpg" alt="Speaker" /&gt;&lt;/p&gt;&lt;p&gt;Igor Minar nous parle dâ€™Angular2 :&lt;/p&gt;&lt;p&gt;&lt;img src="/public/images/DevoxxBE16/ng2.jpg" alt="Angular2" /&gt;&lt;/p&gt;&lt;p&gt;Venkat et ces citations :&lt;/p&gt;&lt;p&gt;&lt;img src="/public/images/DevoxxBE16/VenkatQuote.jpg" alt="Venkat" /&gt;&lt;/p&gt;&lt;p&gt;Brian Goetz nous parle de Java &amp;gt; 9 avec un slide de JavaOne 2005&lt;/p&gt;&lt;p&gt;&lt;img src="/public/images/DevoxxBE16/BrianGoetz.jpg" alt="BrianGoetz" /&gt;&lt;/p&gt;&lt;p&gt;CSS is Awesome ! :&lt;/p&gt;&lt;p&gt;&lt;img src="/public/images/DevoxxBE16/css.jpg" alt="CSS" /&gt;&lt;/p&gt;&lt;p&gt;Bonne ambiance lors du Speaker Diner :&lt;/p&gt;&lt;p&gt;&lt;img src="/public/images/DevoxxBE16/SpeakerDiner.jpg" alt="Speaker Diner" /&gt;&lt;/p&gt;&lt;p&gt;Interview trÃ¨s sÃ©rieuse avec Ray Tsang :&lt;/p&gt;&lt;p&gt;&lt;img src="/public/images/DevoxxBE16/RayTsang.jpg" alt="RayTsang" /&gt;&lt;/p&gt;&lt;p&gt;Une pythie pour un mauvais Oracle :&lt;/p&gt;&lt;p&gt;&lt;img src="/public/images/DevoxxBE16/Antonio.jpg" alt="Antonio" /&gt;&lt;/p&gt;&lt;p&gt;Swift cotÃ© backend :&lt;/p&gt;&lt;p&gt;&lt;img src="/public/images/DevoxxBE16/SwiftBackend.jpg" alt="Swift" /&gt;&lt;/p&gt;&lt;p&gt;Enfin lorsquâ€™il quâ€™il fait froid, et quâ€™il pleut, il y a toujours une solution en Belgique pour se rÃ©confornter:&lt;/p&gt;&lt;p&gt;&lt;img src="/public/images/DevoxxBE16/be.jpg" alt="Reconford" /&gt;&lt;/p&gt;</content> <author> <name>Igor Laborie</name> <email>igor@monkeypatch.io</email> </author> <category term="Devoxx"/> <category term="Java"/> <category term="Reactive"/> <category term="functional"/> <summary>Welcome to Antwerp (Anvers)A peine remis du DevFest Toulouse, je pars une semaine en Belgique pour aller Ã  Devoxx. Pour ceux qui ne connaissent pas encore Devoxx, câ€™est une confÃ©rence indÃ©pendante : elle nâ€™est organisÃ©e ni par Google ni par Oracle. Cela dit ils Ã©taient prÃ©sent en temps que sponsors et speakers. Câ€™est la plus grosse confÃ©rence auquel jâ€™ai assistÃ© (3500 dÃ©veloppeurs), câ€™est pas tous les jours quâ€™on a lâ€™occasion de croiser des Brian Goetz, Venkat Subramaniam, â€¦ en Europe.</summary> <media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://devoxx.be/wp-content/uploads/2016/04/devoxx_logo.gif"/> </entry> <entry xml:lang="fr"><title>Devfest Toulouse</title><link href="http://www.monkeypatch.io/2016/11/06/DevFest-Toulouse.html" rel="alternate" type="text/html" title="Devfest Toulouse"/> <published>2016-11-06T00:00:00+01:00</published> <updated>2016-11-06T00:00:00+01:00</updated><id>http://www.monkeypatch.io/2016/11/06/DevFest-Toulouse</id> <content type="html" xml:base="http://www.monkeypatch.io/2016/11/06/DevFest-Toulouse.html">&lt;h2 id="retours-sur-le-devfest-toulouse"&gt;Retours sur le DevFest Toulouse&lt;/h2&gt;&lt;p&gt;Jeudi 03 novembre 2016 a eu lieu le premier DevFest Toulouse (techniquement câ€™Ã©tait Ã  lâ€™IUT Blagnac), une journÃ©e de confÃ©rence Ã  prix trÃ¨s abordable (30â‚¬ seulement), le panel de speakers Ã©tait assez variÃ©: des Toulousaing, des FranÃ§ais, et quelques internationaux. Toutes les personnes avec qui jâ€™ai eu lâ€™occasion de discuter ont trouvÃ© le niveau des confÃ©rences trÃ¨s bon. Câ€™est aussi mon point de vue.&lt;!--more--&gt;&lt;/p&gt;&lt;p&gt;Pour moi le DevFest a commencÃ© par un super repas mercredi soir avec les speakers et organisateurs. La journÃ©e de confÃ©rences a dÃ©butÃ© le jeudi par un cafÃ©+chocolatine.&lt;/p&gt;&lt;h3 id="le-matin"&gt;Le matin&lt;/h3&gt;&lt;h4 id="keynote"&gt;Keynote&lt;/h4&gt; &lt;p&gt;Nous avions tous rendez dans le grand amphi pour une keynote dâ€™&lt;a href="https://twitter.com/danvy?lang=fr"&gt;Alex Danvy&lt;/a&gt; (Microsoft, France). Alex est un trÃ¨s bon orateur, il nous a parlÃ© de lâ€™Ã©volution de notre mÃ©tier de dÃ©veloppeur. Câ€™est souvent dans ce genre dâ€™occasion que lâ€™on peut prendre du recul sur notre travail. Aujourdâ€™hui le dÃ©veloppeur est un devenu trÃ¨s social, comme le dÃ©montre la richesse des communautÃ©s sur Toulouse. Câ€™est assez Ã©loignÃ© du stÃ©rÃ©otype que lâ€™on voit dans les mÃ©dias, ceci nuit Ã  la mixitÃ© de la profession: un des grands enjeux de demain. Voici les &lt;a href="http://www.slideshare.net/danvy/a-developer-story"&gt;slides&lt;/a&gt;.&lt;/p&gt;&lt;h4 id="clean-code"&gt;Clean Code&lt;/h4&gt; &lt;p&gt;Ensuite jâ€™ai enchainÃ© par la prÃ©sentation dâ€™&lt;a href="https://twitter.com/avernois?lang=fr"&gt;Antoine Vernois&lt;/a&gt; sur le &lt;a href="http://avernois.github.io/prez-clean_code/#/"&gt;â€˜Clean Codeâ€™&lt;/a&gt;. Jâ€™aime beaucoup sa vision, jâ€™y retrouve beaucoup de chose que je souhaite voir appliquer au quotidien. Parmi les choses sympa que jâ€™ai envie de retenir: â€œsi tu ne comprends pas la magie noire derriÃ¨re un Framework, tu ne lâ€™utilises pasâ€. Combien de projets jâ€™ai vu Ã©chouer Ã  cause du manque de comprÃ©hension dâ€™un Frameworkâ€¦&lt;/p&gt;&lt;h4 id="sharing-code-between-web-and-native-apps"&gt;Sharing Code Between Web and Native Apps&lt;/h4&gt; &lt;p&gt;Puis jâ€™ai assistÃ© au dÃ©but de la confÃ©rence de &lt;a href="https://twitter.com/sebawita"&gt;Sebastian Witalec&lt;/a&gt; sur le &lt;a href="https://www.nativescript.org/"&gt;NativeScript&lt;/a&gt;. Jâ€™avais dÃ©jÃ  assistÃ© la veille Ã  sa prÃ©sentation dans le cadre dâ€™Angular Toulouse. NativeScript est une solution pour dÃ©velopper en JavaScript, mais en particulier avec Angular2, et produire du code natif qui sâ€™exÃ©cute sur les plateformes Android ou iOS. Le concept est sÃ©duisant, et cette prÃ©sentation mâ€™a donnÃ©e envie de creuser plus en profondeur le sujet. Câ€™est aussi lâ€™occasion de souligner quâ€™Angular2 est vraiment bien pensÃ© pour Ãªtre un framework qui ne sâ€™exÃ©cute pas uniquement dans le navigateur.&lt;/p&gt;&lt;p&gt;Je ne suis pas restÃ© jusquâ€™au bout puisque jâ€™enchainais avec ma prÃ©sentation sur Feign et jâ€™avais besoin dâ€™un cafÃ© avant de faire mon live-coding.&lt;/p&gt;&lt;h4 id="client-rest-en-java-trop-facile-avec-feign-"&gt;Client REST en Java: trop facile avec Feign !&lt;/h4&gt; &lt;p&gt;Jâ€™ai profitÃ© de cette prÃ©sentation pour aller beaucoup plus loin que dans mes prÃ©cÃ©dentes dÃ©mos: jâ€™ai montrÃ© comment on passait en asynchrone et le mÃ©canisme de Circuit Breaker avec Hystrix, et puis jâ€™ai montrÃ© comment on pouvait faire une implÃ©mentation dâ€™un &lt;code class="highlighter-rouge"&gt;feign.Client&lt;/code&gt; avec la nouvelle API HTTP de Java 9. Voici mes &lt;a href="https://ilaborie.github.io/devfest-toulouse-16-slides/"&gt;slides&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;AprÃ¨s les questions et les nombreux Ã©changes autour de ma prÃ©sentation, un repas Ã©tait bien mÃ©ritÃ©. Câ€™est la premiÃ¨re confÃ©rence auquel jâ€™assiste ou il y avait du vin (bon en plus) pendant le repas de midi: +1.&lt;/p&gt;&lt;h4 id="laprÃ¨s-midi"&gt;Lâ€™aprÃ¨s midi&lt;/h4&gt;&lt;h4 id="les-acteurs-un-modÃ¨le-pour-dompter-le-parallÃ©lisme"&gt;Les Acteurs, un modÃ¨le pour dompter le parallÃ©lisme&lt;/h4&gt; &lt;p&gt;Ensuite je suis allÃ© voir &lt;a href="https://twitter.com/fcabestre?lang=fr"&gt;FrÃ©dÃ©ric Cabestre&lt;/a&gt; qui nous a parlÃ© du modÃ¨le des Acteurs comme solution pour le parallÃ©lisme. Il a amenÃ© la chose en partant de loin: les aspects hardwares, en parlant ensuite des solutions threaded-pool, et event-loop avant de nous prÃ©senter les aspects haut niveau sur les acteurs. Il manquait un peu de temps sur la fin, mais la prÃ©sentation Ã©tait super didactique.&lt;/p&gt;&lt;h4 id="break"&gt;Break&lt;/h4&gt; &lt;p&gt;Ensuite, jâ€™ai eu un coup de barre : fatigue accumulÃ©e pendant la semaine, et peut Ãªtre aussi le retour de bÃ¢ton du vin de midi. Jâ€™ai profitÃ© de cette pause pour Ã©changer avec Fabien, Mathias, FrÃ©dÃ©ric, Antoine, Didier, â€¦ Câ€™est un des points que je trouve le plus intÃ©ressant quand on va dans des confÃ©rences, il y a plein de gens intelligents, passionnÃ©s avec lesquels on peut confronter ou conforter nos points de vue.&lt;/p&gt;&lt;h4 id="android-et-programmation-rÃ©active---rxjava"&gt;Android et programmation rÃ©active - RxJava&lt;/h4&gt; &lt;p&gt;AprÃ¨s je suis aller voir &lt;a href="https://twitter.com/eli_bean"&gt;Elisabel GÃ©nÃ©reux&lt;/a&gt; qui nous a parlÃ© de lâ€™utilisation de &lt;a href="reactivex.io"&gt;Rx&lt;/a&gt; dans le contexte Android. Le sujet est particuliÃ¨rement Ã  la mode et sa prÃ©sentation mâ€™a confirmÃ© que Rx au sens large est vraiment un sujet quâ€™il faut Ã©tudier. Notez quâ€™il y a des dÃ©clinaisons pour pleins de langages, et que lâ€™on peut en retrouver cotÃ© backend (par exemple RxNetty), ou cotÃ© frontend (RxAndroid, RxSwift, RxJS). On sentait quâ€™Elisabel Ã©tait novice dans lâ€™exercice des prÃ©sentations, jâ€™en profite pour lui envoyer des encouragements, jâ€™ai mis plusieurs annÃ©es avant de me sentir Ã  lâ€™aise, et de trouver mon style.&lt;/p&gt;&lt;h4 id="de-java-Ã -swift-en-deux-temps-trois-mouvements"&gt;De Java Ã  Swift en deux temps trois mouvements&lt;/h4&gt; &lt;p&gt;Jâ€™ai fini en beautÃ© avec la prÃ©sentation de &lt;a href="https://twitter.com/dplaindoux"&gt;Didier Plaindoux&lt;/a&gt; qui nous a parlÃ© de &lt;a href="https://swift.org/"&gt;Swift&lt;/a&gt; pour les dÃ©veloppeurs Java (pas dâ€™iOS). Didier est un dÃ©veloppeur passionnÃ© par les langages informatiques, et Ã§a se sent dans sa prÃ©sentation. En plus il a fait un effort pour rendre la prÃ©sentation accessible aux plus grands nombres. Bilan, Swift me plait beaucoup, je retrouve des choses que jâ€™aime dans Scala ou TypeScript. Jâ€™ai hÃ¢te de trouver une occasion pour tester ce langage. Voici les &lt;a href="http://www.slideshare.net/dplaindoux/de-java-a-swift-en-2-temps-trois-mouvements"&gt;slides&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;La journÃ©e sâ€™est achevÃ© par un AfterWork en ville, super tapas, de nombreuses discussions intÃ©ressantes, y compris sur des sujets hors informatique.&lt;/p&gt;&lt;h2 id="conclusion"&gt;Conclusion&lt;/h2&gt;&lt;p&gt;Quelques petits points qui me semblent amÃ©liorables pour les Ã©vÃ©nements futures :&lt;/p&gt;&lt;ul&gt; &lt;li&gt;jâ€™ai trouvÃ© que lâ€™espace entre les amphis Ã©tait un peu petit, il Ã©tait difficile de circuler,&lt;/li&gt; &lt;li&gt;le temps entre les prÃ©sentations Ã©tait trop court, impossible dâ€™Ã©changer dans ces moments, Ã§a a Ã©tÃ© un peu la course,&lt;/li&gt; &lt;li&gt;dâ€™ailleurs je nâ€™ai pas eu assez de temps pour aller discuter avec les sponsors.&lt;/li&gt; &lt;/ul&gt;&lt;p&gt;Mais globalement, jâ€™ai vraiment Ã©tÃ© bluffÃ© par le professionnalisme de cette confÃ©rence, câ€™est particuliÃ¨rement notable pour une premiÃ¨re. Jâ€™en profite pour remercier les organisateurs, les bÃ©nÃ©voles, les sponsors, les speakers, et toutes personnes qui ont Ã©tÃ© impliquÃ©es dans la tenue de cet Ã©vÃ©nement.&lt;/p&gt;&lt;p&gt;A lâ€™an prochain, en espÃ©rant quâ€™il y ait 2 jours dâ€™Ã©changes et confÃ©rences.&lt;/p&gt;</content> <author> <name>Igor Laborie</name> <email>igor@monkeypatch.io</email> </author> <category term="DevFest"/> <category term="Java"/> <category term="Android"/> <category term="Swift"/> <category term="Rx"/> <category term="Acteur"/> <category term="NativeScript"/> <category term="Angular2"/> <category term="Feign"/> <summary>Retours sur le DevFest ToulouseJeudi 03 novembre 2016 a eu lieu le premier DevFest Toulouse (techniquement câ€™Ã©tait Ã  lâ€™IUT Blagnac), une journÃ©e de confÃ©rence Ã  prix trÃ¨s abordable (30â‚¬ seulement), le panel de speakers Ã©tait assez variÃ©: des Toulousaing, des FranÃ§ais, et quelques internationaux. Toutes les personnes avec qui jâ€™ai eu lâ€™occasion de discuter ont trouvÃ© le niveau des confÃ©rences trÃ¨s bon. Câ€™est aussi mon point de vue.</summary> <media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://devfesttoulouse.fr/images/logo-white.svg"/> </entry> <entry xml:lang="fr"><title>Mktd#1 Feign Vs Retrofit : 2 Aller Plus Loin</title><link href="http://www.monkeypatch.io/2016/08/10/MKTD-1-feign-vs-retrofit-&-58;-2-aller-plus-loin.html" rel="alternate" type="text/html" title="Mktd#1 Feign Vs Retrofit &amp;#58; 2 Aller Plus Loin"/> <published>2016-08-10T00:00:00+02:00</published> <updated>2016-08-10T00:00:00+02:00</updated><id>http://www.monkeypatch.io/2016/08/10/MKTD#1-feign-vs-retrofit-&amp;#58;-2-aller-plus-loin</id> <content type="html" xml:base="http://www.monkeypatch.io/2016/08/10/MKTD-1-feign-vs-retrofit-&amp;-58;-2-aller-plus-loin.html">&lt;p&gt;Cet article est le deuxiÃ¨me dâ€™une sÃ©rie de trois articles sur les clients &lt;abbr title="REpresentational State Transfer"&gt;REST&lt;/abbr&gt; en java que sont Feign et Retrofit.&lt;/p&gt;&lt;p&gt;Article prÃ©cÃ©dent : &lt;a href="/2016/08/09/MKTD-1-feign-vs-retrofit-&amp;amp;-58;-1-prise-en-main.html"&gt;&lt;abbr title="MonkeyTechDays"&gt;MKTD&lt;/abbr&gt;#1 : Prise en main&lt;/a&gt;&lt;/p&gt;&lt;hr /&gt;&lt;h2 id="dÃ©fi-2-aller-plus-loin"&gt;DÃ©fi 2: Aller plus loinâ€¦&lt;/h2&gt;&lt;p&gt;Le deuxiÃ¨me dÃ©fi permet dâ€™adresser des problÃ¨mes plus avancÃ©s comme :&lt;/p&gt;&lt;ul&gt; &lt;li&gt;Lâ€™authentification&lt;/li&gt; &lt;li&gt;La gestion des erreurs via des &lt;code class="highlighter-rouge"&gt;Exception&lt;/code&gt; Java&lt;/li&gt; &lt;li&gt;Lâ€™&lt;em&gt;upload&lt;/em&gt; et le &lt;em&gt;download&lt;/em&gt; de fichiers&lt;/li&gt; &lt;/ul&gt;&lt;!--more--&gt;&lt;h3 id="authentification-avec-cookie"&gt;Authentification avec Cookie&lt;/h3&gt;&lt;p&gt;Afin de gÃ©rer le besoin dâ€™authentification, le serveur fournit un mÃ©canisme Ã  base de &lt;a href="https://jwt.io/"&gt;&lt;abbr title="Json WebToken"&gt;JWT&lt;/abbr&gt;&lt;/a&gt; et de &lt;a href="https://tools.ietf.org/html/rfc6265"&gt;Cookies&lt;/a&gt;. Voici lâ€™interface Java dÃ©crivant cette nouvelle opÃ©ration:&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;AuthenticationApi&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="nf"&gt;login&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;LoginPassword&lt;/span&gt; &lt;span class="n"&gt;loginPassword&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="kd"&gt;throws&lt;/span&gt; &lt;span class="n"&gt;SecurityException&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;Dans lâ€™en-tÃªte de la rÃ©ponse &lt;abbr title="HyperText Transfer Protocol"&gt;HTTP&lt;/abbr&gt; se trouve un &lt;code class="highlighter-rouge"&gt;Set-Cookie&lt;/code&gt; quâ€™il faut dÃ©coder. Ce &lt;em&gt;cookie&lt;/em&gt; doit ensuite Ãªtre envoyÃ© dans les requÃªtes faites aux autres services.&lt;/p&gt;&lt;blockquote&gt; &lt;p&gt;Les solutions Ã  base de &lt;em&gt;token&lt;/em&gt; sont un peu plus simples Ã  mettre en oeuvre avec Feign et Retrofit, mais ici, lâ€™objectif nâ€™est pas de faire les choses de la faÃ§on la plus simples. Pour plus dâ€™information sur ce sujet vous pouvez regarder &lt;a href="https://auth0.com/blog/angularjs-authentication-with-cookies-vs-token/"&gt;ce blog&lt;/a&gt;.&lt;/p&gt; &lt;/blockquote&gt;&lt;h3 id="gestion-des-erreurs"&gt;Gestion des erreurs&lt;/h3&gt;&lt;p&gt;Pour la gestion des erreurs, le but de lâ€™exercice est de renvoyer une erreur spÃ©cifique en fonction du code &lt;abbr title="HyperText Transfer Protocol"&gt;HTTP&lt;/abbr&gt; retournÃ© par le serveur. Le code qui dÃ©termine lâ€™exception Ã  retourner est le suivant :&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7 8 9 10 11 12 13&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kd"&gt;static&lt;/span&gt; &lt;span class="n"&gt;RuntimeException&lt;/span&gt; &lt;span class="nf"&gt;decodeError&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;message&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Supplier&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;RuntimeException&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;defaultCase&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;switch&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;case&lt;/span&gt; &lt;span class="mi"&gt;404&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="c1"&gt;// Not Found&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nf"&gt;NoSuchElementException&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;message&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="k"&gt;case&lt;/span&gt; &lt;span class="mi"&gt;400&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="c1"&gt;// Bad Request&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nf"&gt;IllegalArgumentException&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;message&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="k"&gt;case&lt;/span&gt; &lt;span class="mi"&gt;401&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="c1"&gt;// Unauthorized&lt;/span&gt; &lt;span class="k"&gt;case&lt;/span&gt; &lt;span class="mi"&gt;403&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="c1"&gt;// Forbidden&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nf"&gt;SecurityException&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;message&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="k"&gt;default&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;defaultCase&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;h2 id="feign"&gt;Feign&lt;/h2&gt;&lt;h3 id="astuce-log-des-requÃªtes-http"&gt;Astuce: log des requÃªtes &lt;abbr title="HyperText Transfer Protocol"&gt;HTTP&lt;/abbr&gt;&lt;/h3&gt;&lt;p&gt;Pour faciliter le dÃ©veloppement de ce dÃ©fi, il est trÃ¨s pratique de pouvoir afficher des &lt;em&gt;logs&lt;/em&gt; sur les requÃªtes ou les rÃ©ponses &lt;abbr title="HyperText Transfer Protocol"&gt;HTTP&lt;/abbr&gt;.&lt;/p&gt;&lt;h4 id="quick--dirty"&gt;Quick &amp;amp; Dirty&lt;/h4&gt;&lt;p&gt;La solution la plus directe consite Ã  utiliser un &lt;code class="highlighter-rouge"&gt;RequestInterceptor&lt;/code&gt; qui est appelÃ© par Feign avant que la requÃªte &lt;abbr title="HyperText Transfer Protocol"&gt;HTTP&lt;/abbr&gt; ne soit construite, et &lt;em&gt;logger&lt;/em&gt; via un &lt;code class="highlighter-rouge"&gt;System.out&lt;/code&gt;.&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="n"&gt;Feign&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;builder&lt;/span&gt;&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;interceptor&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;println&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;// Quick &amp;amp; Dirty debug&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;decoder&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;GsonDecoder&lt;/span&gt;&lt;span class="o"&gt;())&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;encoder&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;GsonEncoder&lt;/span&gt;&lt;span class="o"&gt;())&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;target&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MonkeyRaceApi&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;Evidement, Ã§a ne marche que pour la requÃªte &lt;abbr title="HyperText Transfer Protocol"&gt;HTTP&lt;/abbr&gt;, pour la rÃ©ponse il faudrait faire quelque chose dâ€™Ã©quivalent dans un dÃ©codeur.&lt;/p&gt;&lt;h4 id="solution-avec-un-logger-feign"&gt;Solution avec un logger Feign&lt;/h4&gt;&lt;p&gt;Pour Ã©viter dâ€™avoir des dÃ©pendances sur bibliothÃ¨ques tierces, Feign Ã  dÃ©finit son propre &lt;code class="highlighter-rouge"&gt;Logger&lt;/code&gt;. Câ€™est une classe abstraite avec une seule mÃ©thode Ã  implÃ©menter. Il faut ensuite dÃ©finir le niveau de &lt;em&gt;log&lt;/em&gt; souhaitÃ©: &lt;code class="highlighter-rouge"&gt;NONE&lt;/code&gt;, &lt;code class="highlighter-rouge"&gt;BASIC&lt;/code&gt;, &lt;code class="highlighter-rouge"&gt;HEADERS&lt;/code&gt;, &lt;code class="highlighter-rouge"&gt;FULL&lt;/code&gt;. Voici ce que Ã§a donne:&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7 8 9 10 11 12 13&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="n"&gt;Feign&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;builder&lt;/span&gt;&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;logLevel&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Logger&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Level&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;FULL&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;logger&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;Logger&lt;/span&gt;&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="c1"&gt;// implements Feign abstract Logger&lt;/span&gt; &lt;span class="nd"&gt;@Override&lt;/span&gt; &lt;span class="kd"&gt;protected&lt;/span&gt; &lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="nf"&gt;log&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;configKey&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="o"&gt;...&lt;/span&gt; &lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;printf&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"[%s] "&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;configKey&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;printf&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="o"&gt;})&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;decoder&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;GsonDecoder&lt;/span&gt;&lt;span class="o"&gt;())&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;encoder&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;GsonEncoder&lt;/span&gt;&lt;span class="o"&gt;())&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;target&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MonkeyRaceApi&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;Dans Feign, le &lt;code class="highlighter-rouge"&gt;feign.Logger.JavaLogger&lt;/code&gt; implÃ©mente le mÃ©canisme au travers du &lt;em&gt;loggeur&lt;/em&gt; du &lt;abbr title="Java Development Kit"&gt;JDK&lt;/abbr&gt; (&lt;code class="highlighter-rouge"&gt;java.util.logging.Logger&lt;/code&gt;), et il existe bien sÃ»r une extension pour utiliser &lt;a href="https://github.com/OpenFeign/feign/tree/master/slf4j"&gt;SLF4J&lt;/a&gt;.&lt;/p&gt;&lt;h3 id="authentification-avec-cookie-1"&gt;Authentification avec Cookie&lt;/h3&gt;&lt;p&gt;La premiÃ¨re Ã©tape consiste Ã  rÃ©cupÃ©rer le &lt;em&gt;cookie&lt;/em&gt; gÃ©nÃ©rÃ© par la requÃªte dâ€™authentification. Pour cela on utilise un dÃ©codeur spÃ©cifique qui va traiter les en-tÃªtes de la rÃ©ponse pour stocker les &lt;em&gt;cookies&lt;/em&gt;.&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;private&lt;/span&gt; &lt;span class="kd"&gt;static&lt;/span&gt; &lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="nf"&gt;getAuthToken&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;login&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;AuthenticationApi&lt;/span&gt; &lt;span class="n"&gt;authenticationApi&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;builder&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;encoder&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;GsonEncoder&lt;/span&gt;&lt;span class="o"&gt;())&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;decoder&lt;/span&gt;&lt;span class="o"&gt;((&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;handleCookies&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;headers&lt;/span&gt;&lt;span class="o"&gt;()))&lt;/span&gt; &lt;span class="c1"&gt;// decode cookies&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;target&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;AuthenticationApi&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;authenticationApi&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;login&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;LoginPassword&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;login&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="o"&gt;));&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;Le stockage du &lt;em&gt;cookie&lt;/em&gt; est assurÃ© par le &lt;a href="https://docs.oracle.com/javase/8/docs/api/index.html?overview-summary.html"&gt;CookieManager&lt;/a&gt; disponible depuis Java 6.&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;private&lt;/span&gt; &lt;span class="kd"&gt;static&lt;/span&gt; &lt;span class="kd"&gt;final&lt;/span&gt; &lt;span class="n"&gt;CookieManager&lt;/span&gt; &lt;span class="n"&gt;COOKIE_MANAGER&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;CookieManager&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;Lâ€™utilisation de ce &lt;code class="highlighter-rouge"&gt;CookieManager&lt;/code&gt; est traitÃ© dans la mÃ©thode &lt;code class="highlighter-rouge"&gt;handleCookies&lt;/code&gt; ci dessous:&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;private&lt;/span&gt; &lt;span class="kd"&gt;static&lt;/span&gt; &lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="nf"&gt;handleCookies&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Map&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Collection&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="c1"&gt;// From Map&amp;lt;String, Collection&amp;lt;String&amp;gt;&amp;gt; to Map&amp;lt;String, List&amp;lt;String&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;Map&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;h&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;entrySet&lt;/span&gt;&lt;span class="o"&gt;().&lt;/span&gt;&lt;span class="na"&gt;stream&lt;/span&gt;&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;collect&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt; &lt;span class="n"&gt;toMap&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt; &lt;span class="n"&gt;Map&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Entry&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;getKey&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;entry&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;entry&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getValue&lt;/span&gt;&lt;span class="o"&gt;().&lt;/span&gt;&lt;span class="na"&gt;stream&lt;/span&gt;&lt;span class="o"&gt;().&lt;/span&gt;&lt;span class="na"&gt;collect&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;toList&lt;/span&gt;&lt;span class="o"&gt;()))&lt;/span&gt; &lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="k"&gt;try&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;URI&lt;/span&gt; &lt;span class="n"&gt;uri&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;URI&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;create&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;BASE_URL&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;&lt;span class="n"&gt;image&lt;/span&gt; &lt;span class="n"&gt;COOKIE_MANAGER&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;COOKIE_MANAGER&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getCookieStore&lt;/span&gt;&lt;span class="o"&gt;().&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="o"&gt;).&lt;/span&gt;&lt;span class="na"&gt;stream&lt;/span&gt;&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="c1"&gt;// Stream&amp;lt;HttpCookie&amp;gt;&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;filter&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cookie&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="s"&gt;"token"&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;equals&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cookie&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getName&lt;/span&gt;&lt;span class="o"&gt;()))&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;findFirst&lt;/span&gt;&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="c1"&gt;// Optional&amp;lt;HttpCookie&amp;gt;&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;map&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nl"&gt;HttpCookie:&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;getValue&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;orElseThrow&lt;/span&gt;&lt;span class="o"&gt;(()&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;IllegalStateException&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"Authentication cookie not found"&lt;/span&gt;&lt;span class="o"&gt;));&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="k"&gt;catch&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;IOException&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;throw&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nf"&gt;RuntimeException&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;Une fois stockÃ©, ce &lt;em&gt;cookie&lt;/em&gt; sera envoyÃ© dans les futures requÃªtes. Pour cela on utilise une nouvelle fois le mÃ©canisme de &lt;code class="highlighter-rouge"&gt;RequestInterceptor&lt;/code&gt; qui permet de modifier le &lt;code class="highlighter-rouge"&gt;RequestTemplate&lt;/code&gt;, Feign utilise cet objet pour construire la requÃªte &lt;abbr title="HyperText Transfer Protocol"&gt;HTTP&lt;/abbr&gt;.&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7 8&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;static&lt;/span&gt; &lt;span class="n"&gt;MonkeyRaceApi&lt;/span&gt; &lt;span class="nf"&gt;buildRaceApi&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;login&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;getAuthToken&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;login&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;builder&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;requestInterceptor&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nl"&gt;ApiFactory:&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;addCookies&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;// Inject Cookies&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;decoder&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;GsonDecoder&lt;/span&gt;&lt;span class="o"&gt;())&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;encoder&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;GsonEncoder&lt;/span&gt;&lt;span class="o"&gt;())&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;target&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MonkeyRaceApi&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;Lâ€™intercepteur se comporte comme un consommateur de &lt;code class="highlighter-rouge"&gt;RequestTemplate&lt;/code&gt; :&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;private&lt;/span&gt; &lt;span class="kd"&gt;static&lt;/span&gt; &lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="nf"&gt;addCookies&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;RequestTemplate&lt;/span&gt; &lt;span class="n"&gt;template&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;URI&lt;/span&gt; &lt;span class="n"&gt;uri&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;URI&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;create&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;BASE_URL&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="n"&gt;COOKIE_MANAGER&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getCookieStore&lt;/span&gt;&lt;span class="o"&gt;().&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="o"&gt;).&lt;/span&gt;&lt;span class="na"&gt;stream&lt;/span&gt;&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;map&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nl"&gt;HttpCookie:&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;toString&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;forEach&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cookie&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;template&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;header&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"Cookie"&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;cookie&lt;/span&gt;&lt;span class="o"&gt;));&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;Dans Feign, le mÃ©canisme dâ€™authentification par &lt;em&gt;cookie&lt;/em&gt; est proche du mÃ©canisme dâ€™en-tÃªte &lt;code class="highlighter-rouge"&gt;Authorization&lt;/code&gt; souvent associÃ© au &lt;abbr title="Json WebToken"&gt;JWT&lt;/abbr&gt;. Il se base sur des en-tÃªtes &lt;abbr title="HyperText Transfer Protocol"&gt;HTTP&lt;/abbr&gt;. Pour implÃ©menter lâ€™authentification Ã  base de &lt;em&gt;token&lt;/em&gt;, on utiliserait donc la mÃªme technique du &lt;code class="highlighter-rouge"&gt;RequestInterceptor&lt;/code&gt;. On constate quand mÃªme que lâ€™utilisation des &lt;em&gt;cookies&lt;/em&gt; alourdi fortement le code.&lt;/p&gt;&lt;blockquote&gt; &lt;p&gt;On peut aussi utiliser une &lt;code class="highlighter-rouge"&gt;feign.Target&lt;/code&gt; pour traiter les aspects dâ€™authentification, voir la &lt;a href="https://github.com/OpenFeign/feign#setting-headers-per-target"&gt;documentation de Feign&lt;/a&gt;.&lt;/p&gt; &lt;/blockquote&gt;&lt;h3 id="gestion-des-erreurs-1"&gt;Gestion des erreurs&lt;/h3&gt;&lt;p&gt;Dans Feign, il existe un mÃ©canisme spÃ©cifique pour traiter les cas en erreurs, câ€™est Ã  dire si la rÃ©ponse &lt;abbr title="HyperText Transfer Protocol"&gt;HTTP&lt;/abbr&gt; Ã  un code â‰¥ 400. Ce mÃ©canisme utilise un &lt;code class="highlighter-rouge"&gt;ErrorDecoder&lt;/code&gt; :&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7 8 9&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;static&lt;/span&gt; &lt;span class="n"&gt;MonkeyRaceApi&lt;/span&gt; &lt;span class="nf"&gt;buildRaceApi&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;login&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;getAuthToken&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;login&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;builder&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;errorDecoder&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nl"&gt;ApiFactory:&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;decodeError&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;// Decode errors&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;requestInterceptor&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nl"&gt;ApiFactory:&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;addCookies&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;// Inject Cookies&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;decoder&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;GsonDecoder&lt;/span&gt;&lt;span class="o"&gt;())&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;encoder&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;GsonEncoder&lt;/span&gt;&lt;span class="o"&gt;())&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;target&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MonkeyRaceApi&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;private&lt;/span&gt; &lt;span class="kd"&gt;static&lt;/span&gt; &lt;span class="n"&gt;Exception&lt;/span&gt; &lt;span class="nf"&gt;decodeError&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;methodKey&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Response&lt;/span&gt; &lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nf"&gt;decodeError&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;status&lt;/span&gt;&lt;span class="o"&gt;(),&lt;/span&gt; &lt;span class="n"&gt;methodKey&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;FeignException&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;errorStatus&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;methodKey&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;));&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;blockquote&gt; &lt;p&gt;Parfois on souhaite traiter le cas particulier dâ€™une erreur &lt;code class="highlighter-rouge"&gt;404&lt;/code&gt; dans le &lt;code class="highlighter-rouge"&gt;Decoder&lt;/code&gt; utilisÃ© dans le cas nominal, pour celÃ  il suffit dâ€™utiliser la mÃ©thode &lt;code class="highlighter-rouge"&gt;feign.Feign.Builder#decode404&lt;/code&gt; sur le &lt;em&gt;builder&lt;/em&gt;.&lt;/p&gt; &lt;/blockquote&gt;&lt;h3 id="upload"&gt;Upload&lt;/h3&gt;&lt;p&gt;Concernant lâ€™&lt;em&gt;upload&lt;/em&gt; de fichier, le serveur &lt;abbr title="REpresentational State Transfer"&gt;REST&lt;/abbr&gt; propose deux solutions:&lt;/p&gt;&lt;ul&gt; &lt;li&gt;un &lt;em&gt;upload&lt;/em&gt; via un &lt;a href="https://www.ietf.org/rfc/rfc2388.txt"&gt;formulaire multipart&lt;/a&gt; avec lâ€™en-tÃªte &lt;code class="highlighter-rouge"&gt;Content-type&lt;/code&gt; Ã  &lt;code class="highlighter-rouge"&gt;multipart/form-data&lt;/code&gt;&lt;/li&gt; &lt;li&gt;un &lt;em&gt;upload&lt;/em&gt; direct avec les donnÃ©es du fichier directement dans le corps de la requÃªte, lâ€™en-tÃªte &lt;code class="highlighter-rouge"&gt;Content-type&lt;/code&gt; Ã  &lt;code class="highlighter-rouge"&gt;application/octet-stream&lt;/code&gt;.&lt;/li&gt; &lt;/ul&gt;&lt;p&gt;Les deux solutions sont implÃ©metables en utilisant le mÃªme principe: un &lt;code class="highlighter-rouge"&gt;Decoder&lt;/code&gt; spÃ©cifique. La seconde solution est beaucoup plus simple Ã  implÃ©menter car gÃ©rer le corps dâ€™une requÃªte &lt;em&gt;multipart&lt;/em&gt; nÃ©cessite lâ€™utilisation dâ€™une &lt;abbr title="Application Programming Interface"&gt;API&lt;/abbr&gt; externe (par exemple &lt;a href="https://commons.apache.org/proper/commons-fileupload/"&gt;Commons FileUpload dâ€™Apache&lt;/a&gt;). On peut regarder du cotÃ© de &lt;a href="https://github.com/xxlabaza/feign-form"&gt;https://github.com/xxlabaza/feign-form&lt;/a&gt; ou &lt;a href="https://github.com/pcan/feign-client-test"&gt;https://github.com/pcan/feign-client-test&lt;/a&gt; pour voir des solutions ou des idÃ©es pour ces aspects &lt;em&gt;multipart&lt;/em&gt;.&lt;/p&gt;&lt;p&gt;La seconde solution est donc beaucoup plus simple, le principe est de traiter le cas particulier des objets du type &lt;code class="highlighter-rouge"&gt;java.io.InputStream&lt;/code&gt; et de dÃ©lÃ©guer les autres cas Ã  un autre encodeur &lt;abbr title="JavaScript Object Notation"&gt;JSON&lt;/abbr&gt; classique. Pour dÃ©finir le corps de de la requÃªte &lt;abbr title="HyperText Transfer Protocol"&gt;HTTP&lt;/abbr&gt; il faut appeler la mÃ©thode &lt;code class="highlighter-rouge"&gt;feign.RequestTemplate#body(byte[], java.nio.charset.Charset)&lt;/code&gt;. Il est possible dâ€™Ã©crire le code dâ€™un encodeur dans une &lt;em&gt;lambda&lt;/em&gt; Java 8, mais ici il est prÃ©fÃ©rable dâ€™extraire le code de ce dÃ©codeur dans une nouvelle classe :&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;UploadEncoder&lt;/span&gt; &lt;span class="kd"&gt;implements&lt;/span&gt; &lt;span class="n"&gt;Encoder&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="kd"&gt;private&lt;/span&gt; &lt;span class="kd"&gt;final&lt;/span&gt; &lt;span class="n"&gt;Encoder&lt;/span&gt; &lt;span class="n"&gt;delegate&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="nf"&gt;UploadEncoder&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Encoder&lt;/span&gt; &lt;span class="n"&gt;encoder&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="kd"&gt;super&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt; &lt;span class="n"&gt;delegate&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;encoder&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt; &lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="nf"&gt;encode&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt; &lt;span class="n"&gt;object&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Type&lt;/span&gt; &lt;span class="n"&gt;bodyType&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;RequestTemplate&lt;/span&gt; &lt;span class="n"&gt;template&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="kd"&gt;throws&lt;/span&gt; &lt;span class="n"&gt;EncodeException&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;InputStream&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;equals&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;bodyType&lt;/span&gt;&lt;span class="o"&gt;))&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;template&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;header&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"Content-type"&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="s"&gt;"application/octet-stream"&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="n"&gt;InputStream&lt;/span&gt; &lt;span class="n"&gt;inputStream&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;InputStream&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;cast&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;object&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="c1"&gt;// InputStream to byte[]&lt;/span&gt; &lt;span class="k"&gt;try&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;BufferedInputStream&lt;/span&gt; &lt;span class="n"&gt;bin&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;BufferedInputStream&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;inputStream&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="n"&gt;ByteArrayOutputStream&lt;/span&gt; &lt;span class="n"&gt;bos&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;ByteArrayOutputStream&lt;/span&gt;&lt;span class="o"&gt;())&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="kt"&gt;byte&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt; &lt;span class="n"&gt;buffer&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="kt"&gt;byte&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1024&lt;/span&gt;&lt;span class="o"&gt;];&lt;/span&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;bytesRead&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="o"&gt;((&lt;/span&gt;&lt;span class="n"&gt;bytesRead&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;read&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;buffer&lt;/span&gt;&lt;span class="o"&gt;))&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;bos&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;write&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;buffer&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;bytesRead&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="n"&gt;bos&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;flush&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt; &lt;span class="n"&gt;template&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;body&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;bos&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;toByteArray&lt;/span&gt;&lt;span class="o"&gt;(),&lt;/span&gt; &lt;span class="n"&gt;StandardCharsets&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;UTF_8&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="k"&gt;catch&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;IOException&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;throw&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nf"&gt;EncodeException&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"Cannot upload file"&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;delegate&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;encode&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;object&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;bodyType&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;template&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;blockquote&gt; &lt;p&gt;On peut bien sÃ»r simplifier le code en utilisant une bibliothÃ¨que qui permet facilement de faire la conversion &lt;code class="highlighter-rouge"&gt;InputStream&lt;/code&gt; vers &lt;code class="highlighter-rouge"&gt;byte[]&lt;/code&gt;, mais Ã§a ne fait pas de mal dâ€™Ã©crire des &lt;code class="highlighter-rouge"&gt;try with resources&lt;/code&gt; de temps en temps.&lt;/p&gt; &lt;/blockquote&gt;&lt;blockquote&gt; &lt;p&gt;On peut lÃ©gitimement argumenter que ce code risque de poser des problÃ¨mes si le fichier est particuliÃ¨rement gros. Mais si on doit gÃ©rer ce genre de cas, il faut aussi se poser la question suivante: une &lt;abbr title="Application Programming Interface"&gt;API&lt;/abbr&gt; &lt;abbr title="REpresentational State Transfer"&gt;REST&lt;/abbr&gt; est elle la bonne solution pour faire des &lt;em&gt;upload&lt;/em&gt; de gros fichier ?&lt;/p&gt; &lt;/blockquote&gt;&lt;h3 id="download"&gt;Download&lt;/h3&gt;&lt;p&gt;On utilise un &lt;code class="highlighter-rouge"&gt;feign.Decoder&lt;/code&gt; pour le &lt;em&gt;download&lt;/em&gt;, le principe est similaire Ã  celui utiliser pour lâ€™&lt;em&gt;upload&lt;/em&gt;. Ce qui va donner:&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;DownloadDecoder&lt;/span&gt; &lt;span class="kd"&gt;implements&lt;/span&gt; &lt;span class="n"&gt;Decoder&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="kd"&gt;private&lt;/span&gt; &lt;span class="kd"&gt;final&lt;/span&gt; &lt;span class="n"&gt;Decoder&lt;/span&gt; &lt;span class="n"&gt;delegate&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;&lt;span class="n"&gt;DownloadDecoder&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Decoder&lt;/span&gt; &lt;span class="n"&gt;decoder&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="kd"&gt;super&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt; &lt;span class="n"&gt;delegate&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;decoder&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt; &lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="n"&gt;Object&lt;/span&gt; &lt;span class="nf"&gt;decode&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Response&lt;/span&gt; &lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Type&lt;/span&gt; &lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="kd"&gt;throws&lt;/span&gt; &lt;span class="n"&gt;IOException&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;DecodeException&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;FeignException&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;InputStream&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;equals&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="o"&gt;))&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;body&lt;/span&gt;&lt;span class="o"&gt;().&lt;/span&gt;&lt;span class="na"&gt;asInputStream&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;delegate&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;decode&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;Une nouvelle fois, Feign rend lâ€™opÃ©ration trÃ¨s simple dÃ¨s quâ€™on a compris le principe des encodeurs/dÃ©codeurs.&lt;/p&gt;&lt;h3 id="bilan"&gt;Bilan&lt;/h3&gt;&lt;p&gt;Feign rend la manipulation des en-tÃªtes &lt;abbr title="HyperText Transfer Protocol"&gt;HTTP&lt;/abbr&gt; trÃ¨s simple, cela permet dâ€™utiliser les divers mÃ©canismes dâ€™autentifications par &lt;em&gt;Cookie&lt;/em&gt; ou &lt;em&gt;Token&lt;/em&gt; facilement.&lt;/p&gt;&lt;p&gt;La gestion des erreurs dans Feign est aussi triviale, câ€™est un des points fort de Feign par rapport Ã  Retrofit.&lt;/p&gt;&lt;p&gt;Le mÃ©canisme dâ€™encodeur permet facilement de traiter le cas dâ€™&lt;em&gt;upload&lt;/em&gt; du fichier, et de faÃ§on plus gÃ©nÃ©rale de traiter tous les cas de &lt;em&gt;serialization&lt;/em&gt; des requÃªtes &lt;abbr title="HyperText Transfer Protocol"&gt;HTTP&lt;/abbr&gt;. Le mÃ©canisme de dÃ©codeur va permettre de rÃ©cupÃ©rer le contenu dâ€™un fichier que lâ€™on &lt;em&gt;download&lt;/em&gt;, ou plus gÃ©nÃ©ralement les divers mÃ©canismes de &lt;em&gt;deserialization&lt;/em&gt; des rÃ©ponses &lt;abbr title="HyperText Transfer Protocol"&gt;HTTP&lt;/abbr&gt;.&lt;/p&gt;&lt;p&gt;Feign offre une grande souplesse grace aux &lt;code class="highlighter-rouge"&gt;Encoder&lt;/code&gt;, &lt;code class="highlighter-rouge"&gt;Decoder&lt;/code&gt;, &lt;code class="highlighter-rouge"&gt;RequestInterceptor&lt;/code&gt;, â€¦ on arrive assez facilement Ã  rÃ©soudre les divers problÃ¨mes posÃ©s autours des &lt;abbr title="Application Programming Interface"&gt;API&lt;/abbr&gt; &lt;abbr title="REpresentational State Transfer"&gt;REST&lt;/abbr&gt;.&lt;/p&gt;&lt;h2 id="retrofit"&gt;Retrofit&lt;/h2&gt;&lt;h3 id="authentification-avec-cookie-2"&gt;Authentification avec Cookie&lt;/h3&gt;&lt;p&gt;La faÃ§on la plus simple de gÃ©rer lâ€™authentification avec Retrofit consiste Ã  utiliser les mÃ©canismes du client &lt;abbr title="HyperText Transfer Protocol"&gt;HTTP&lt;/abbr&gt; (&lt;code class="highlighter-rouge"&gt;okHttp3&lt;/code&gt;). Comme pour feign, on fait une premiÃ¨re requÃªte qui rÃ©cupÃ¨re le cookie et ensuite on utilise le mÃªme client pour les autres requÃªtes. Une autre solution consiste a utiliser un client par requÃªte mais une seule instance de &lt;code class="highlighter-rouge"&gt;cookieJar&lt;/code&gt;.&lt;/p&gt;&lt;p&gt;Voici une premiÃ¨re implÃ©mentation assez basique qui permet de comprendre le mÃ©canisme du &lt;code class="highlighter-rouge"&gt;cookieJar&lt;/code&gt;.&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="n"&gt;client&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;OkHttpClient&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Builder&lt;/span&gt;&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;cookieJar&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nf"&gt;CookieJar&lt;/span&gt;&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="kd"&gt;private&lt;/span&gt; &lt;span class="kd"&gt;final&lt;/span&gt; &lt;span class="n"&gt;HashMap&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Cookie&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;cookieStore&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;HashMap&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;();&lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt; &lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="nf"&gt;saveFromResponse&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;HttpUrl&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Cookie&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;cookies&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;cookieStore&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;uri&lt;/span&gt;&lt;span class="o"&gt;().&lt;/span&gt;&lt;span class="na"&gt;getAuthority&lt;/span&gt;&lt;span class="o"&gt;(),&lt;/span&gt; &lt;span class="n"&gt;cookies&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt; &lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Cookie&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="nf"&gt;loadForRequest&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;HttpUrl&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Cookie&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;cookies&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;cookieStore&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;uri&lt;/span&gt;&lt;span class="o"&gt;().&lt;/span&gt;&lt;span class="na"&gt;getAuthority&lt;/span&gt;&lt;span class="o"&gt;());&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;cookies&lt;/span&gt; &lt;span class="o"&gt;!=&lt;/span&gt; &lt;span class="kc"&gt;null&lt;/span&gt; &lt;span class="o"&gt;?&lt;/span&gt; &lt;span class="n"&gt;cookies&lt;/span&gt; &lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;ArrayList&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Cookie&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;();&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="o"&gt;});&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;Une implÃ©mentation plus Ã©lÃ©gante et plus simple consiste Ã  ajouter la dÃ©pendance &lt;code class="highlighter-rouge"&gt;okhttp-urlconnection&lt;/code&gt; de &lt;code class="highlighter-rouge"&gt;OkHttp&lt;/code&gt;.&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="n"&gt;CookieHandler&lt;/span&gt; &lt;span class="n"&gt;cookieHandler&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;CookieManager&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nf"&gt;PersistentCookieStore&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ctx&lt;/span&gt;&lt;span class="o"&gt;),&lt;/span&gt; &lt;span class="n"&gt;CookiePolicy&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;ACCEPT_ALL&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;&lt;span class="n"&gt;OkHttpClient&lt;/span&gt; &lt;span class="n"&gt;httpClient&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;OkHttpClient&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Builder&lt;/span&gt;&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;cookieJar&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;JavaNetCookieJar&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cookieHandler&lt;/span&gt;&lt;span class="o"&gt;));&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;h3 id="gestion-des-erreurs-2"&gt;Gestion des erreurs&lt;/h3&gt;&lt;p&gt;Il nâ€™existe pas, de mon point de vue de solution idÃ©ale dans Retrofit pour gÃ©rer les erreurs comment il en existe dans Feign. Pour cet exercice, nous utilisons donc la fonctionnalitÃ© dâ€™interceptor de &lt;code class="highlighter-rouge"&gt;OkHttp&lt;/code&gt;. Une limitation existe cependant; il faut que les exceptions Ã  retourner soient de type &lt;code class="highlighter-rouge"&gt;RuntimeException&lt;/code&gt;.&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="n"&gt;OkHttpClient&lt;/span&gt; &lt;span class="n"&gt;client&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;OkHttpClient&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Builder&lt;/span&gt;&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;addInterceptor&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;authInterceptor&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7 8 9 10 11 12&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;private&lt;/span&gt; &lt;span class="n"&gt;Response&lt;/span&gt; &lt;span class="nf"&gt;authInterceptor&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Interceptor&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Chain&lt;/span&gt; &lt;span class="n"&gt;chain&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="kd"&gt;throws&lt;/span&gt; &lt;span class="n"&gt;IOException&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;Request&lt;/span&gt; &lt;span class="n"&gt;request&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;chain&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;request&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt; &lt;span class="n"&gt;Response&lt;/span&gt; &lt;span class="n"&gt;response&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;chain&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;proceed&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;(!&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;isSuccessful&lt;/span&gt;&lt;span class="o"&gt;())&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;RuntimeException&lt;/span&gt; &lt;span class="n"&gt;ex&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;ApiFactory&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;decodeError&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;code&lt;/span&gt;&lt;span class="o"&gt;(),&lt;/span&gt; &lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;message&lt;/span&gt;&lt;span class="o"&gt;(),&lt;/span&gt; &lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ex&lt;/span&gt; &lt;span class="o"&gt;!=&lt;/span&gt; &lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;throw&lt;/span&gt; &lt;span class="n"&gt;ex&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;h3 id="upload-1"&gt;Upload&lt;/h3&gt;&lt;p&gt;Pour lâ€™&lt;em&gt;upload&lt;/em&gt; , nous avons choisi dâ€™utiliser la mÃ©thode du &lt;a href="https://www.ietf.org/rfc/rfc2388.txt"&gt;formulaire multipart&lt;/a&gt; avec lâ€™en-tÃªte &lt;code class="highlighter-rouge"&gt;Content-type&lt;/code&gt; Ã  &lt;code class="highlighter-rouge"&gt;multipart/form-data&lt;/code&gt;&lt;/p&gt;&lt;p&gt;Et voici comment faire :&lt;/p&gt;&lt;p&gt;On ajoute la mÃ©thode au service.&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;MonkeyService&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;&lt;span class="nd"&gt;@Multipart&lt;/span&gt; &lt;span class="nd"&gt;@POST&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"monkeys/{id}/photo"&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="n"&gt;Call&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Photo&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="nf"&gt;sendPhoto&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nd"&gt;@Path&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"id"&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nd"&gt;@Part&lt;/span&gt; &lt;span class="n"&gt;MultipartBody&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Part&lt;/span&gt; &lt;span class="n"&gt;file&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;On crÃ©e un fichier temporaire contenant la photo, puis on appelle la mÃ©thode &lt;code class="highlighter-rouge"&gt;sendPhoto&lt;/code&gt; en lui fournissant un &lt;code class="highlighter-rouge"&gt;RequestBody&lt;/code&gt; spÃ©cifique contenant ce fichier temporaire et ensuite nous crÃ©ons le &lt;code class="highlighter-rouge"&gt;MultipartBody&lt;/code&gt; qui est passÃ© au service.&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt; &lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="n"&gt;Photo&lt;/span&gt; &lt;span class="nf"&gt;savePhoto&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;InputStream&lt;/span&gt; &lt;span class="n"&gt;stream&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="kd"&gt;throws&lt;/span&gt; &lt;span class="n"&gt;SecurityException&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;IllegalArgumentException&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nf"&gt;executeCall&lt;/span&gt;&lt;span class="o"&gt;(()&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;try&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;Path&lt;/span&gt; &lt;span class="n"&gt;tmp&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Files&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;createTempFile&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"exo2"&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="s"&gt;"upload"&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="n"&gt;Files&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;copy&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;stream&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;tmp&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;REPLACE_EXISTING&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;&lt;span class="n"&gt;RequestBody&lt;/span&gt; &lt;span class="n"&gt;requestFile&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;RequestBody&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;create&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MediaType&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;parse&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"multipart/form-data"&lt;/span&gt;&lt;span class="o"&gt;),&lt;/span&gt; &lt;span class="n"&gt;tmp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;toFile&lt;/span&gt;&lt;span class="o"&gt;());&lt;/span&gt; &lt;span class="n"&gt;MultipartBody&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Part&lt;/span&gt; &lt;span class="n"&gt;body&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;MultipartBody&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Part&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;createFormData&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"photo"&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;tmp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;toFile&lt;/span&gt;&lt;span class="o"&gt;().&lt;/span&gt;&lt;span class="na"&gt;getName&lt;/span&gt;&lt;span class="o"&gt;(),&lt;/span&gt; &lt;span class="n"&gt;requestFile&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;monkeyService&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;sendPhoto&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;body&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="k"&gt;catch&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;IOException&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;printStackTrace&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="o"&gt;});&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;h3 id="download-1"&gt;Download&lt;/h3&gt;&lt;p&gt;Pour le &lt;em&gt;download&lt;/em&gt; il nous suffit de faire un appel Ã  notre service en rÃ©cupÃ©rant le corps de la rÃ©ponse. Pour cela Retrofit dispose dâ€™un type &lt;em&gt;gÃ©nÃ©rique&lt;/em&gt;: &lt;code class="highlighter-rouge"&gt;ResponseBody&lt;/code&gt; qui permet de rÃ©cupÃ©rer la rÃ©ponse &lt;code class="highlighter-rouge"&gt;brute&lt;/code&gt;.&lt;/p&gt;&lt;p&gt;On commence par ajouter la mÃ©thode Ã  notre service :&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;MonkeyService&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="nd"&gt;@GET&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"monkeys/{id}/photo"&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="n"&gt;Call&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;ResponseBody&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="nf"&gt;downloadPhoto&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nd"&gt;@Path&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"id"&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="kd"&gt;throws&lt;/span&gt; &lt;span class="n"&gt;SecurityException&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;IllegalArgumentException&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;puis voici le code qui permet de rÃ©cupÃ©rer notre photo :&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7 8 9&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt; &lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="n"&gt;InputStream&lt;/span&gt; &lt;span class="nf"&gt;downloadPhoto&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="kd"&gt;throws&lt;/span&gt; &lt;span class="n"&gt;SecurityException&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;IllegalArgumentException&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;try&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;Response&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;ResponseBody&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;response&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;monkeyService&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;downloadPhoto&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;).&lt;/span&gt;&lt;span class="na"&gt;execute&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;body&lt;/span&gt;&lt;span class="o"&gt;().&lt;/span&gt;&lt;span class="na"&gt;byteStream&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="k"&gt;catch&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;IOException&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;h3 id="bilan-1"&gt;Bilan&lt;/h3&gt;&lt;p&gt;Il est trÃ¨s simple dans Retrofit de gÃ©rer lâ€™authentification via &lt;em&gt;Cookie&lt;/em&gt;, &lt;em&gt;Token&lt;/em&gt;. Lâ€™&lt;em&gt;upload&lt;/em&gt; et le &lt;em&gt;download&lt;/em&gt; sont aussi assez simple Ã  gÃ©rer.&lt;/p&gt;&lt;p&gt;En revanche la gestion des erreurs est un peu moins intuitive. Peut Ãªtre existe tâ€™il une autre solution auquelle nous nâ€™avons pas pensÃ©.&lt;/p&gt;&lt;h2 id="bilan-global"&gt;Bilan Global&lt;/h2&gt;&lt;p&gt;Que ce soit avec Feign ou Retrofit, il est aisÃ© de gÃ©rer les &lt;em&gt;cookies&lt;/em&gt;, et les &lt;em&gt;upload&lt;/em&gt;/&lt;em&gt;download&lt;/em&gt; de fichiers.&lt;/p&gt;&lt;p&gt;Nous avons Ã©galement trouvÃ© que la gestion des erreurs en mode synchrone Ã©tait mieux gÃ©rÃ© avec Feign.&lt;/p&gt;&lt;p&gt;Les solutions utilisant &lt;a href="http://square.github.io/okhttp/"&gt;OkHttp&lt;/a&gt; sont communes Ã  Retrofit et Ã  Feign quand on utilise le client &lt;a href="https://github.com/OpenFeign/feign/tree/master/okhttp"&gt;okhttp-client&lt;/a&gt; dans Feign.&lt;/p&gt;</content> <author> <name>Emmanuel Vinas</name> <email>emmanuel@monkeypatch.io</email> </author> <author> <name>Igor Laborie</name> <email>igor@monkeypatch.io</email> </author> <category term="MKTD"/> <category term="Java"/> <category term="REST"/> <category term="Feign"/> <category term="Retrofit"/> <category term="Cookie"/> <summary>Cet article est le deuxiÃ¨me dâ€™une sÃ©rie de trois articles sur les clients REST en java que sont Feign et Retrofit.Article prÃ©cÃ©dent : MKTD#1 : Prise en mainDÃ©fi 2: Aller plus loinâ€¦Le deuxiÃ¨me dÃ©fi permet dâ€™adresser des problÃ¨mes plus avancÃ©s comme :Lâ€™authentification La gestion des erreurs via des Exception Java Lâ€™upload et le download de fichiers</summary> <media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://www.monkeypatch.io/public/images/logos/logo-FeignVsRetrofit.png"/> </entry> <entry xml:lang="en"><title>Mktd#1 Feign Vs Retrofit : 2 Going Further</title><link href="http://www.monkeypatch.io/2016/08/10/MKTD-1-feign-vs-retrofit-&-58;-2-going-further.html" rel="alternate" type="text/html" title="Mktd#1 Feign Vs Retrofit &amp;#58; 2 Going Further"/> <published>2016-08-10T00:00:00+02:00</published> <updated>2016-08-10T00:00:00+02:00</updated><id>http://www.monkeypatch.io/2016/08/10/MKTD#1-feign-vs-retrofit-&amp;#58;-2-going-further</id> <content type="html" xml:base="http://www.monkeypatch.io/2016/08/10/MKTD-1-feign-vs-retrofit-&amp;-58;-2-going-further.html">&lt;p&gt;This article is the second of the serie &lt;abbr title="REpresentational State Transfer"&gt;REST&lt;/abbr&gt; clients in Java.&lt;/p&gt;&lt;p&gt;Previous article: &lt;a href="/2016/08/09/MKTD-1-feign-vs-retrofit-&amp;amp;-58;-1-getting-started.html"&gt;&lt;abbr title="MonkeyTechDays"&gt;MKTD&lt;/abbr&gt;#1 : Getting started&lt;/a&gt;&lt;/p&gt;&lt;hr /&gt;&lt;h2 id="challenge-2-going-further"&gt;Challenge #2: Going furtherâ€¦&lt;/h2&gt;&lt;p&gt;The second challenge aims at solving advanced problems such as:&lt;/p&gt;&lt;ul&gt; &lt;li&gt;Authentication and session management&lt;/li&gt; &lt;li&gt;Errors management via Java &lt;code class="highlighter-rouge"&gt;Exception&lt;/code&gt;&lt;/li&gt; &lt;li&gt;Files &lt;em&gt;upload&lt;/em&gt; and &lt;em&gt;download&lt;/em&gt; &lt;!--more--&gt;&lt;/li&gt; &lt;/ul&gt;&lt;h3 id="session-management-using-cookies"&gt;Session management using Cookies&lt;/h3&gt;&lt;p&gt;Out of the box, the server provides authentication and session management mechanisms using &lt;a href="https://jwt.io/"&gt;&lt;abbr title="Json WebToken"&gt;JWT&lt;/abbr&gt;&lt;/a&gt; and &lt;a href="https://tools.ietf.org/html/rfc6265"&gt;Cookies&lt;/a&gt;. A new Java interface describes this operation:&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;AuthenticationApi&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="nf"&gt;login&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;LoginPassword&lt;/span&gt; &lt;span class="n"&gt;loginPassword&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="kd"&gt;throws&lt;/span&gt; &lt;span class="n"&gt;SecurityException&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;The response &lt;abbr title="HyperText Transfer Protocol"&gt;HTTP&lt;/abbr&gt; may return a &lt;code class="highlighter-rouge"&gt;Set-Cookie&lt;/code&gt; header to be decoded. This &lt;em&gt;cookie&lt;/em&gt; value will then be added to subsequent requests headers sent to other services.&lt;/p&gt;&lt;blockquote&gt; &lt;p&gt;&lt;em&gt;Token&lt;/em&gt; based solutions are simpler to put in place using Feign and Retrofit, but in our scenario we are not trying to follow the simplest approach. You can find more information on this topic on &lt;a href="https://auth0.com/blog/angularjs-authentication-with-cookies-vs-token/"&gt;this blog&lt;/a&gt;.&lt;/p&gt; &lt;/blockquote&gt;&lt;h3 id="errors-management"&gt;Errors management&lt;/h3&gt;&lt;p&gt;Regarding errors management, we need to return specific errors based on the &lt;abbr title="HyperText Transfer Protocol"&gt;HTTP&lt;/abbr&gt; code returned by the server. The following piece of code handles the &lt;abbr title="HyperText Transfer Protocol"&gt;HTTP&lt;/abbr&gt; error to Java exception mapping:&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7 8 9 10 11 12 13&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kd"&gt;static&lt;/span&gt; &lt;span class="n"&gt;RuntimeException&lt;/span&gt; &lt;span class="nf"&gt;decodeError&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;message&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Supplier&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;RuntimeException&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;defaultCase&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;switch&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;case&lt;/span&gt; &lt;span class="mi"&gt;404&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="c1"&gt;// Not Found&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nf"&gt;NoSuchElementException&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;message&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="k"&gt;case&lt;/span&gt; &lt;span class="mi"&gt;400&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="c1"&gt;// Bad Request&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nf"&gt;IllegalArgumentException&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;message&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="k"&gt;case&lt;/span&gt; &lt;span class="mi"&gt;401&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="c1"&gt;// Unauthorized&lt;/span&gt; &lt;span class="k"&gt;case&lt;/span&gt; &lt;span class="mi"&gt;403&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="c1"&gt;// Forbidden&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nf"&gt;SecurityException&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;message&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="k"&gt;default&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;defaultCase&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;h2 id="feign"&gt;Feign&lt;/h2&gt;&lt;h3 id="pro-tip-http-requests-logging"&gt;Pro tip: &lt;abbr title="HyperText Transfer Protocol"&gt;HTTP&lt;/abbr&gt; requests logging&lt;/h3&gt;&lt;p&gt;To ease this challenge implementation, it appears to be very handy to log the &lt;abbr title="HyperText Transfer Protocol"&gt;HTTP&lt;/abbr&gt; requests and responses.&lt;/p&gt;&lt;h4 id="quick--dirty-way"&gt;Quick &amp;amp; Dirty way&lt;/h4&gt;&lt;p&gt;The quickest way to achieve this is to use a &lt;code class="highlighter-rouge"&gt;RequestInterceptor&lt;/code&gt; called by Feign before an &lt;abbr title="HyperText Transfer Protocol"&gt;HTTP&lt;/abbr&gt; request gets built and log it via &lt;code class="highlighter-rouge"&gt;System.out&lt;/code&gt;.&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="n"&gt;Feign&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;builder&lt;/span&gt;&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;interceptor&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;println&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;// Quick &amp;amp; Dirty debug&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;decoder&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;GsonDecoder&lt;/span&gt;&lt;span class="o"&gt;())&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;encoder&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;GsonEncoder&lt;/span&gt;&lt;span class="o"&gt;())&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;target&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MonkeyRaceApi&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;This obviously works only for &lt;abbr title="HyperText Transfer Protocol"&gt;HTTP&lt;/abbr&gt; requests, to achieve the same for the responses, similar thing has to be added to the decoder.&lt;/p&gt;&lt;h4 id="using-feign-logger"&gt;Using Feign logger&lt;/h4&gt;&lt;p&gt;To avoid third-parties libraries dependencies, Feign defines its own &lt;code class="highlighter-rouge"&gt;Logger&lt;/code&gt;. It consists of an abstract class with a single method to implement. The log level needs to be defined to allow log filtering later on (&lt;code class="highlighter-rouge"&gt;NONE&lt;/code&gt;, &lt;code class="highlighter-rouge"&gt;BASIC&lt;/code&gt;, &lt;code class="highlighter-rouge"&gt;HEADERS&lt;/code&gt;, &lt;code class="highlighter-rouge"&gt;FULL&lt;/code&gt;). Here is an example:&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7 8 9 10 11 12 13&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="n"&gt;Feign&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;builder&lt;/span&gt;&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;logLevel&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Logger&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Level&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;FULL&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;logger&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;Logger&lt;/span&gt;&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="nd"&gt;@Override&lt;/span&gt; &lt;span class="kd"&gt;protected&lt;/span&gt; &lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="nf"&gt;log&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;configKey&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="o"&gt;...&lt;/span&gt; &lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;printf&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"[%s] "&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;configKey&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;printf&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="n"&gt;System&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;out&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;println&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="o"&gt;})&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;decoder&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;GsonDecoder&lt;/span&gt;&lt;span class="o"&gt;())&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;encoder&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;GsonEncoder&lt;/span&gt;&lt;span class="o"&gt;())&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;target&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MonkeyRaceApi&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;By default, Feign logger class &lt;code class="highlighter-rouge"&gt;feign.Logger.JavaLogger&lt;/code&gt; relies on the &lt;abbr title="Java Development Kit"&gt;JDK&lt;/abbr&gt; logger &lt;code class="highlighter-rouge"&gt;java.util.logging.Logger&lt;/code&gt; but an extension exists to use other loggers such as &lt;a href="https://github.com/OpenFeign/feign/tree/master/slf4j"&gt;SLF4J&lt;/a&gt;.&lt;/p&gt;&lt;h3 id="cookie-based-authentication"&gt;Cookie based Authentication&lt;/h3&gt;&lt;p&gt;The first step consists in retrieving the &lt;em&gt;cookie&lt;/em&gt; generated by the authentication request. To do so, a specific decoder to handle the response headers and store them as &lt;em&gt;cookes&lt;/em&gt; is used.&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;private&lt;/span&gt; &lt;span class="kd"&gt;static&lt;/span&gt; &lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="nf"&gt;getAuthToken&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;login&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;AuthenticationApi&lt;/span&gt; &lt;span class="n"&gt;authenticationApi&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;builder&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;encoder&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;GsonEncoder&lt;/span&gt;&lt;span class="o"&gt;())&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;decoder&lt;/span&gt;&lt;span class="o"&gt;((&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;handleCookies&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;headers&lt;/span&gt;&lt;span class="o"&gt;()))&lt;/span&gt; &lt;span class="c1"&gt;// decode cookies&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;target&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;AuthenticationApi&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;authenticationApi&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;login&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;LoginPassword&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;login&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="o"&gt;));&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;The &lt;em&gt;cookie&lt;/em&gt; storage is managed by the &lt;a href="https://docs.oracle.com/javase/8/docs/api/index.html?overview-summary.html"&gt;CookieManager&lt;/a&gt; available since Java6.&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;private&lt;/span&gt; &lt;span class="kd"&gt;static&lt;/span&gt; &lt;span class="kd"&gt;final&lt;/span&gt; &lt;span class="n"&gt;CookieManager&lt;/span&gt; &lt;span class="n"&gt;COOKIE_MANAGER&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;CookieManager&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;The usage of this &lt;code class="highlighter-rouge"&gt;CookieManager&lt;/code&gt; is handled from the method &lt;code class="highlighter-rouge"&gt;handleCookies&lt;/code&gt; as follows:&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;private&lt;/span&gt; &lt;span class="kd"&gt;static&lt;/span&gt; &lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="nf"&gt;handleCookies&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Map&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Collection&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="c1"&gt;// From Map&amp;lt;String, Collection&amp;lt;String&amp;gt;&amp;gt; to Map&amp;lt;String, List&amp;lt;String&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;Map&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;h&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;entrySet&lt;/span&gt;&lt;span class="o"&gt;().&lt;/span&gt;&lt;span class="na"&gt;stream&lt;/span&gt;&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;collect&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt; &lt;span class="n"&gt;toMap&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt; &lt;span class="n"&gt;Map&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Entry&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;getKey&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;entry&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;entry&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getValue&lt;/span&gt;&lt;span class="o"&gt;().&lt;/span&gt;&lt;span class="na"&gt;stream&lt;/span&gt;&lt;span class="o"&gt;().&lt;/span&gt;&lt;span class="na"&gt;collect&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;toList&lt;/span&gt;&lt;span class="o"&gt;()))&lt;/span&gt; &lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="k"&gt;try&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;URI&lt;/span&gt; &lt;span class="n"&gt;uri&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;URI&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;create&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;BASE_URL&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;&lt;span class="n"&gt;image&lt;/span&gt; &lt;span class="n"&gt;COOKIE_MANAGER&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;COOKIE_MANAGER&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getCookieStore&lt;/span&gt;&lt;span class="o"&gt;().&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="o"&gt;).&lt;/span&gt;&lt;span class="na"&gt;stream&lt;/span&gt;&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="c1"&gt;// Stream&amp;lt;HttpCookie&amp;gt;&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;filter&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cookie&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="s"&gt;"token"&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;equals&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cookie&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getName&lt;/span&gt;&lt;span class="o"&gt;()))&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;findFirst&lt;/span&gt;&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="c1"&gt;// Optional&amp;lt;HttpCookie&amp;gt;&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;map&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nl"&gt;HttpCookie:&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;getValue&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;orElseThrow&lt;/span&gt;&lt;span class="o"&gt;(()&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;IllegalStateException&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"Authentication cookie not found"&lt;/span&gt;&lt;span class="o"&gt;));&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="k"&gt;catch&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;IOException&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;throw&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nf"&gt;RuntimeException&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt; &lt;p&gt;After being stored, this &lt;em&gt;cookie&lt;/em&gt; is automatically sent back in subsequent requests. This is achieved by using the &lt;code class="highlighter-rouge"&gt;RequestInterceptor&lt;/code&gt; mechanism that modifies the &lt;code class="highlighter-rouge"&gt;RequestTemplate&lt;/code&gt;. Feign uses this object to construct the &lt;abbr title="HyperText Transfer Protocol"&gt;HTTP&lt;/abbr&gt; request.&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7 8&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;static&lt;/span&gt; &lt;span class="n"&gt;MonkeyRaceApi&lt;/span&gt; &lt;span class="nf"&gt;buildRaceApi&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;login&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;getAuthToken&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;login&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;builder&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;requestInterceptor&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nl"&gt;ApiFactory:&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;addCookies&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;// Inject Cookies&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;decoder&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;GsonDecoder&lt;/span&gt;&lt;span class="o"&gt;())&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;encoder&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;GsonEncoder&lt;/span&gt;&lt;span class="o"&gt;())&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;target&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MonkeyRaceApi&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;The interceptor behaves as a &lt;code class="highlighter-rouge"&gt;RequestTemplate&lt;/code&gt; consumer:&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;private&lt;/span&gt; &lt;span class="kd"&gt;static&lt;/span&gt; &lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="nf"&gt;addCookies&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;RequestTemplate&lt;/span&gt; &lt;span class="n"&gt;template&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;URI&lt;/span&gt; &lt;span class="n"&gt;uri&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;URI&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;create&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;BASE_URL&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="n"&gt;COOKIE_MANAGER&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getCookieStore&lt;/span&gt;&lt;span class="o"&gt;().&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="o"&gt;).&lt;/span&gt;&lt;span class="na"&gt;stream&lt;/span&gt;&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;map&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nl"&gt;HttpCookie:&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;toString&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;forEach&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cookie&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;template&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;header&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"Cookie"&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;cookie&lt;/span&gt;&lt;span class="o"&gt;));&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;With Feign, the &lt;em&gt;cookie&lt;/em&gt; based authentication is closed to the &lt;code class="highlighter-rouge"&gt;Authorization&lt;/code&gt; header mechanism often associated to &lt;abbr title="Json WebToken"&gt;JWT&lt;/abbr&gt;. As it is based on &lt;abbr title="HyperText Transfer Protocol"&gt;HTTP&lt;/abbr&gt; headers, the same implementation approach using a &lt;code class="highlighter-rouge"&gt;RequestInterceptor&lt;/code&gt; can be used to handle authentication via &lt;em&gt;token&lt;/em&gt;. On the other hand, using &lt;em&gt;cookies&lt;/em&gt; makes the code more complex and impacts its readability.&lt;/p&gt;&lt;blockquote&gt; &lt;p&gt;We cam also use &lt;code class="highlighter-rouge"&gt;feign.Target&lt;/code&gt; to manage the authentication, see &lt;a href="https://github.com/OpenFeign/feign#setting-headers-per-target"&gt;Feign documentation&lt;/a&gt;.&lt;/p&gt; &lt;/blockquote&gt;&lt;h3 id="errors-management-1"&gt;Errors management&lt;/h3&gt;&lt;p&gt;Feign proposes a specific errors management mechanism out of the box - if an &lt;abbr title="HyperText Transfer Protocol"&gt;HTTP&lt;/abbr&gt; reposnse code &amp;gt;= 400. This is done using the &lt;code class="highlighter-rouge"&gt;ErrorDecoder&lt;/code&gt;:&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7 8 9&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;static&lt;/span&gt; &lt;span class="n"&gt;MonkeyRaceApi&lt;/span&gt; &lt;span class="nf"&gt;buildRaceApi&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;login&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;getAuthToken&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;login&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;builder&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;errorDecoder&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nl"&gt;ApiFactory:&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;decodeError&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;// Decode errors&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;requestInterceptor&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nl"&gt;ApiFactory:&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;addCookies&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;// Inject Cookies&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;decoder&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;GsonDecoder&lt;/span&gt;&lt;span class="o"&gt;())&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;encoder&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;GsonEncoder&lt;/span&gt;&lt;span class="o"&gt;())&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;target&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MonkeyRaceApi&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;private&lt;/span&gt; &lt;span class="kd"&gt;static&lt;/span&gt; &lt;span class="n"&gt;Exception&lt;/span&gt; &lt;span class="nf"&gt;decodeError&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;methodKey&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Response&lt;/span&gt; &lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nf"&gt;decodeError&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;status&lt;/span&gt;&lt;span class="o"&gt;(),&lt;/span&gt; &lt;span class="n"&gt;methodKey&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;FeignException&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;errorStatus&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;methodKey&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;));&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;blockquote&gt; &lt;p&gt;Sometimes it can be useful to have a custom management of 404 errors. The &lt;code class="highlighter-rouge"&gt;Decoder&lt;/code&gt; method &lt;code class="highlighter-rouge"&gt;feign.Feign.Builder#decode404&lt;/code&gt; can be used to define the default baheviour.&lt;/p&gt; &lt;/blockquote&gt;&lt;h3 id="upload"&gt;Upload&lt;/h3&gt;&lt;p&gt;File &lt;em&gt;upload&lt;/em&gt; can be achieved in two different ways on the &lt;abbr title="REpresentational State Transfer"&gt;REST&lt;/abbr&gt; server:&lt;/p&gt;&lt;ul&gt; &lt;li&gt;Upload using a &lt;a href="https://www.ietf.org/rfc/rfc2388.txt"&gt;formulaire multipart&lt;/a&gt; and a request header &lt;code class="highlighter-rouge"&gt;Content-type&lt;/code&gt; set to &lt;code class="highlighter-rouge"&gt;multipart/form-data&lt;/code&gt;.&lt;/li&gt; &lt;li&gt;Direct upload with the file content inside the request body and the request header &lt;code class="highlighter-rouge"&gt;Content-type&lt;/code&gt; set to &lt;code class="highlighter-rouge"&gt;application/octet-stream&lt;/code&gt;.&lt;/li&gt; &lt;/ul&gt;&lt;p&gt;The two approaches can be implemented using the same principle: a specific &lt;code class="highlighter-rouge"&gt;Decoder&lt;/code&gt;. The second option is easier to set up as managing the &lt;em&gt;multipart&lt;/em&gt; request body requires the usage of an external &lt;abbr title="Application Programming Interface"&gt;API&lt;/abbr&gt; such as &lt;a href="https://commons.apache.org/proper/commons-fileupload/"&gt;Apache Commons FileUpload&lt;/a&gt; Other options are also available &lt;a href="https://github.com/xxlabaza/feign-form"&gt;https://github.com/xxlabaza/feign-form&lt;/a&gt; or &lt;a href="https://github.com/pcan/feign-client-test"&gt;https://github.com/pcan/feign-client-test&lt;/a&gt; to find implementation examples of the &lt;em&gt;multipart&lt;/em&gt; approach.&lt;/p&gt;&lt;p&gt;So the second solution is much simpler, the main idea is to handle the specific case of objects of type &lt;code class="highlighter-rouge"&gt;java.io.InputStream&lt;/code&gt; and to delegate other cases to a traditional &lt;abbr title="JavaScript Object Notation"&gt;JSON&lt;/abbr&gt; encoder. To define the &lt;abbr title="HyperText Transfer Protocol"&gt;HTTP&lt;/abbr&gt; request body, the method &lt;code class="highlighter-rouge"&gt;feign.RequestTemplate#body(byte[], java.nio.charset.Charset)&lt;/code&gt; needs to be called. It is possible to write the encoder body inside a &lt;em&gt;lambda&lt;/em&gt; with Java 8, but it would be preferable to extract this implementation in a new class:&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;UploadEncoder&lt;/span&gt; &lt;span class="kd"&gt;implements&lt;/span&gt; &lt;span class="n"&gt;Encoder&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="kd"&gt;private&lt;/span&gt; &lt;span class="kd"&gt;final&lt;/span&gt; &lt;span class="n"&gt;Encoder&lt;/span&gt; &lt;span class="n"&gt;delegate&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="nf"&gt;UploadEncoder&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Encoder&lt;/span&gt; &lt;span class="n"&gt;encoder&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="kd"&gt;super&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt; &lt;span class="n"&gt;delegate&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;encoder&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt; &lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="nf"&gt;encode&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt; &lt;span class="n"&gt;object&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Type&lt;/span&gt; &lt;span class="n"&gt;bodyType&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;RequestTemplate&lt;/span&gt; &lt;span class="n"&gt;template&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="kd"&gt;throws&lt;/span&gt; &lt;span class="n"&gt;EncodeException&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;InputStream&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;equals&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;bodyType&lt;/span&gt;&lt;span class="o"&gt;))&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;template&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;header&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"Content-type"&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="s"&gt;"application/octet-stream"&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="n"&gt;InputStream&lt;/span&gt; &lt;span class="n"&gt;inputStream&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;InputStream&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;cast&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;object&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="c1"&gt;// InputStream to byte[]&lt;/span&gt; &lt;span class="k"&gt;try&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;BufferedInputStream&lt;/span&gt; &lt;span class="n"&gt;bin&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;BufferedInputStream&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;inputStream&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="n"&gt;ByteArrayOutputStream&lt;/span&gt; &lt;span class="n"&gt;bos&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;ByteArrayOutputStream&lt;/span&gt;&lt;span class="o"&gt;())&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="kt"&gt;byte&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt; &lt;span class="n"&gt;buffer&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="kt"&gt;byte&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1024&lt;/span&gt;&lt;span class="o"&gt;];&lt;/span&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;bytesRead&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="o"&gt;((&lt;/span&gt;&lt;span class="n"&gt;bytesRead&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;bin&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;read&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;buffer&lt;/span&gt;&lt;span class="o"&gt;))&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;bos&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;write&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;buffer&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;bytesRead&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="n"&gt;bos&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;flush&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt; &lt;span class="n"&gt;template&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;body&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;bos&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;toByteArray&lt;/span&gt;&lt;span class="o"&gt;(),&lt;/span&gt; &lt;span class="n"&gt;StandardCharsets&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;UTF_8&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="k"&gt;catch&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;IOException&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;throw&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nf"&gt;EncodeException&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"Cannot upload file"&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;delegate&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;encode&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;object&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;bodyType&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;template&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;blockquote&gt; &lt;p&gt;It is obviously possible to simplify this code by using a library to handle to conversion of &lt;code class="highlighter-rouge"&gt;InputStream&lt;/code&gt; into &lt;code class="highlighter-rouge"&gt;byte[]&lt;/code&gt;, but it does not hurt to write &lt;code class="highlighter-rouge"&gt;try with resources&lt;/code&gt; from time to time.&lt;/p&gt; &lt;/blockquote&gt;&lt;blockquote&gt; &lt;p&gt;It would be fair to say that this code may cause issues when working with large files. But in this scenario, we also need to ask the question: is a &lt;abbr title="REpresentational State Transfer"&gt;REST&lt;/abbr&gt; &lt;abbr title="Application Programming Interface"&gt;API&lt;/abbr&gt; the right solution to &lt;em&gt;upload&lt;/em&gt; large files?&lt;/p&gt; &lt;/blockquote&gt;&lt;h3 id="download"&gt;Download&lt;/h3&gt;&lt;p&gt;We use &lt;code class="highlighter-rouge"&gt;feign.Decoder&lt;/code&gt; to &lt;em&gt;download&lt;/em&gt; files the same way we did for the &lt;em&gt;upload&lt;/em&gt;:&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;DownloadDecoder&lt;/span&gt; &lt;span class="kd"&gt;implements&lt;/span&gt; &lt;span class="n"&gt;Decoder&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="kd"&gt;private&lt;/span&gt; &lt;span class="kd"&gt;final&lt;/span&gt; &lt;span class="n"&gt;Decoder&lt;/span&gt; &lt;span class="n"&gt;delegate&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;&lt;span class="n"&gt;DownloadDecoder&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Decoder&lt;/span&gt; &lt;span class="n"&gt;decoder&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="kd"&gt;super&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt; &lt;span class="n"&gt;delegate&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;decoder&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt; &lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="n"&gt;Object&lt;/span&gt; &lt;span class="nf"&gt;decode&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Response&lt;/span&gt; &lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Type&lt;/span&gt; &lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="kd"&gt;throws&lt;/span&gt; &lt;span class="n"&gt;IOException&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;DecodeException&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;FeignException&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;InputStream&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;equals&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="o"&gt;))&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;body&lt;/span&gt;&lt;span class="o"&gt;().&lt;/span&gt;&lt;span class="na"&gt;asInputStream&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;delegate&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;decode&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;type&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;Once again, Feign makes this operation quite simple as soon as the encoders/decoders are correctly used.&lt;/p&gt;&lt;h3 id="summary"&gt;Summary&lt;/h3&gt;&lt;p&gt;Feign makes the handle of &lt;abbr title="HyperText Transfer Protocol"&gt;HTTP&lt;/abbr&gt; headers really simple, thus simplifying the authentication mechanisms using &lt;em&gt;cookies&lt;/em&gt; or &lt;em&gt;tokens&lt;/em&gt;.&lt;/p&gt;&lt;p&gt;Errors management with Feign is also trivial which is one of the key benefits over the usage of Retrofit.&lt;/p&gt;&lt;p&gt;Encoding mechanism provides an easy way to handle file &lt;em&gt;upload&lt;/em&gt; and more generally to manage all the scenarios of requests serialising. The decoding mechanism allows retrieving the content of a file that is &lt;em&gt;downloaded&lt;/em&gt; and more generally deserialising &lt;abbr title="HyperText Transfer Protocol"&gt;HTTP&lt;/abbr&gt; responses.&lt;/p&gt;&lt;p&gt;Feign comes with a lot of flexibility using the &lt;code class="highlighter-rouge"&gt;Encoder&lt;/code&gt;, &lt;code class="highlighter-rouge"&gt;Decoder&lt;/code&gt;, &lt;code class="highlighter-rouge"&gt;RequestInterceptor&lt;/code&gt;, â€¦ and we can easily solve common issues we face with &lt;abbr title="REpresentational State Transfer"&gt;REST&lt;/abbr&gt; APIs.&lt;/p&gt;&lt;h2 id="retrofit"&gt;Retrofit&lt;/h2&gt;&lt;h3 id="cookie-based-authentication-1"&gt;Cookie based Authentication&lt;/h3&gt;&lt;p&gt;The easiest way to manage authentication with Retrofit is to use the internal of the &lt;abbr title="HyperText Transfer Protocol"&gt;HTTP&lt;/abbr&gt; client (&lt;code class="highlighter-rouge"&gt;okHttp3&lt;/code&gt;). Similarly to Feign we send an initial request to fetch the &lt;em&gt;cookie&lt;/em&gt; and then reuse the same client for all subsequent requests. Another option consists in using different clients for each requests but reusing the same &lt;code class="highlighter-rouge"&gt;cookieJar&lt;/code&gt;.&lt;/p&gt;&lt;p&gt;Here is a first basic implementation to understand the principle of a &lt;code class="highlighter-rouge"&gt;cookieJar&lt;/code&gt;:&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="n"&gt;client&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;OkHttpClient&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Builder&lt;/span&gt;&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;cookieJar&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nf"&gt;CookieJar&lt;/span&gt;&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="kd"&gt;private&lt;/span&gt; &lt;span class="kd"&gt;final&lt;/span&gt; &lt;span class="n"&gt;HashMap&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Cookie&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;cookieStore&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;HashMap&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&amp;gt;();&lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt; &lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="nf"&gt;saveFromResponse&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;HttpUrl&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Cookie&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;cookies&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;cookieStore&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;uri&lt;/span&gt;&lt;span class="o"&gt;().&lt;/span&gt;&lt;span class="na"&gt;getAuthority&lt;/span&gt;&lt;span class="o"&gt;(),&lt;/span&gt; &lt;span class="n"&gt;cookies&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt; &lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Cookie&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="nf"&gt;loadForRequest&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;HttpUrl&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Cookie&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;cookies&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;cookieStore&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;uri&lt;/span&gt;&lt;span class="o"&gt;().&lt;/span&gt;&lt;span class="na"&gt;getAuthority&lt;/span&gt;&lt;span class="o"&gt;());&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;cookies&lt;/span&gt; &lt;span class="o"&gt;!=&lt;/span&gt; &lt;span class="kc"&gt;null&lt;/span&gt; &lt;span class="o"&gt;?&lt;/span&gt; &lt;span class="n"&gt;cookies&lt;/span&gt; &lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;ArrayList&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Cookie&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;();&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="o"&gt;});&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;A more elegant implementation consists in adding the dependency &lt;code class="highlighter-rouge"&gt;okhttp-urlconnection&lt;/code&gt; from &lt;code class="highlighter-rouge"&gt;OkHttp&lt;/code&gt;.&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="n"&gt;CookieHandler&lt;/span&gt; &lt;span class="n"&gt;cookieHandler&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;CookieManager&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nf"&gt;PersistentCookieStore&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ctx&lt;/span&gt;&lt;span class="o"&gt;),&lt;/span&gt; &lt;span class="n"&gt;CookiePolicy&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;ACCEPT_ALL&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;&lt;span class="n"&gt;OkHttpClient&lt;/span&gt; &lt;span class="n"&gt;httpClient&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;OkHttpClient&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Builder&lt;/span&gt;&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;cookieJar&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;JavaNetCookieJar&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cookieHandler&lt;/span&gt;&lt;span class="o"&gt;));&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;h3 id="errors-management-2"&gt;Errors management&lt;/h3&gt;&lt;p&gt;There is no, from my point of view, any ideal solution with Retrofit to manage errors the way it is done with Feign. In this example, we use the functionality of the &lt;code class="highlighter-rouge"&gt;OkHttp&lt;/code&gt; interceptor. There is still a limitation, the exceptions returned must be of type &lt;code class="highlighter-rouge"&gt;RuntimeException&lt;/code&gt;.&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="n"&gt;OkHttpClient&lt;/span&gt; &lt;span class="n"&gt;client&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;OkHttpClient&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Builder&lt;/span&gt;&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;addInterceptor&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="o"&gt;::&lt;/span&gt;&lt;span class="n"&gt;authInterceptor&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7 8 9 10 11 12&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;private&lt;/span&gt; &lt;span class="n"&gt;Response&lt;/span&gt; &lt;span class="nf"&gt;authInterceptor&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Interceptor&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Chain&lt;/span&gt; &lt;span class="n"&gt;chain&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="kd"&gt;throws&lt;/span&gt; &lt;span class="n"&gt;IOException&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;Request&lt;/span&gt; &lt;span class="n"&gt;request&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;chain&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;request&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt; &lt;span class="n"&gt;Response&lt;/span&gt; &lt;span class="n"&gt;response&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;chain&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;proceed&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;(!&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;isSuccessful&lt;/span&gt;&lt;span class="o"&gt;())&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;RuntimeException&lt;/span&gt; &lt;span class="n"&gt;ex&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;ApiFactory&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;decodeError&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;code&lt;/span&gt;&lt;span class="o"&gt;(),&lt;/span&gt; &lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;message&lt;/span&gt;&lt;span class="o"&gt;(),&lt;/span&gt; &lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ex&lt;/span&gt; &lt;span class="o"&gt;!=&lt;/span&gt; &lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;throw&lt;/span&gt; &lt;span class="n"&gt;ex&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;h3 id="upload-1"&gt;Upload&lt;/h3&gt;&lt;p&gt;To implement the &lt;em&gt;upload&lt;/em&gt;, we have decided to use the method &lt;a href="https://www.ietf.org/rfc/rfc2388.txt"&gt;multipart form&lt;/a&gt; with the header &lt;code class="highlighter-rouge"&gt;Content-type&lt;/code&gt; set to &lt;code class="highlighter-rouge"&gt;multipart/form-data&lt;/code&gt; Here is the implementation detail:&lt;/p&gt;&lt;p&gt;The method is added to the service&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;MonkeyService&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;&lt;span class="nd"&gt;@Multipart&lt;/span&gt; &lt;span class="nd"&gt;@POST&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"monkeys/{id}/photo"&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="n"&gt;Call&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Photo&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="nf"&gt;sendPhoto&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nd"&gt;@Path&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"id"&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nd"&gt;@Part&lt;/span&gt; &lt;span class="n"&gt;MultipartBody&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Part&lt;/span&gt; &lt;span class="n"&gt;file&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;We create a temporary file containing the picture content, then we call the method &lt;code class="highlighter-rouge"&gt;sendPhoto&lt;/code&gt; giving it a &lt;code class="highlighter-rouge"&gt;RequestBody&lt;/code&gt; containing the temporary file to then create the &lt;code class="highlighter-rouge"&gt;MultipartBody&lt;/code&gt; passed down to the service.&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt; &lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="n"&gt;Photo&lt;/span&gt; &lt;span class="nf"&gt;savePhoto&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;InputStream&lt;/span&gt; &lt;span class="n"&gt;stream&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="kd"&gt;throws&lt;/span&gt; &lt;span class="n"&gt;SecurityException&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;IllegalArgumentException&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nf"&gt;executeCall&lt;/span&gt;&lt;span class="o"&gt;(()&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;try&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;Path&lt;/span&gt; &lt;span class="n"&gt;tmp&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Files&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;createTempFile&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"exo2"&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="s"&gt;"upload"&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="n"&gt;Files&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;copy&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;stream&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;tmp&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;REPLACE_EXISTING&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;&lt;span class="n"&gt;RequestBody&lt;/span&gt; &lt;span class="n"&gt;requestFile&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;RequestBody&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;create&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MediaType&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;parse&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"multipart/form-data"&lt;/span&gt;&lt;span class="o"&gt;),&lt;/span&gt; &lt;span class="n"&gt;tmp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;toFile&lt;/span&gt;&lt;span class="o"&gt;());&lt;/span&gt; &lt;span class="n"&gt;MultipartBody&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Part&lt;/span&gt; &lt;span class="n"&gt;body&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;MultipartBody&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Part&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;createFormData&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"photo"&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;tmp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;toFile&lt;/span&gt;&lt;span class="o"&gt;().&lt;/span&gt;&lt;span class="na"&gt;getName&lt;/span&gt;&lt;span class="o"&gt;(),&lt;/span&gt; &lt;span class="n"&gt;requestFile&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;monkeyService&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;sendPhoto&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;body&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="k"&gt;catch&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;IOException&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;printStackTrace&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="o"&gt;});&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;h3 id="download-1"&gt;Download&lt;/h3&gt;&lt;p&gt;Regarding the &lt;em&gt;download&lt;/em&gt;, we only need to call our service by retrieving the reponse body. To do so, Retrofit proposes a &lt;em&gt;generic&lt;/em&gt; type &lt;code class="highlighter-rouge"&gt;ResponseBody&lt;/code&gt; to access the raw response.&lt;/p&gt;&lt;p&gt;We start by adding this method to our service:&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;MonkeyService&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="nd"&gt;@GET&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"monkeys/{id}/photo"&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="n"&gt;Call&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;ResponseBody&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="nf"&gt;downloadPhoto&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nd"&gt;@Path&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"id"&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="kd"&gt;throws&lt;/span&gt; &lt;span class="n"&gt;SecurityException&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;IllegalArgumentException&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;then here is the code to fetch the picture:&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7 8 9&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt; &lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="n"&gt;InputStream&lt;/span&gt; &lt;span class="nf"&gt;downloadPhoto&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="kd"&gt;throws&lt;/span&gt; &lt;span class="n"&gt;SecurityException&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;IllegalArgumentException&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;try&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;Response&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;ResponseBody&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;response&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;monkeyService&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;downloadPhoto&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;).&lt;/span&gt;&lt;span class="na"&gt;execute&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;body&lt;/span&gt;&lt;span class="o"&gt;().&lt;/span&gt;&lt;span class="na"&gt;byteStream&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="k"&gt;catch&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;IOException&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;h3 id="summary-1"&gt;Summary&lt;/h3&gt;&lt;p&gt;It is really simple with Retrofit to manage authentication via &lt;em&gt;cookies&lt;/em&gt; and &lt;em&gt;tokens&lt;/em&gt; as well as the files &lt;em&gt;upload&lt;/em&gt; and &lt;em&gt;download&lt;/em&gt;.&lt;/p&gt;&lt;p&gt;On the other side, errors management is far less intuitive. Maybe a better approach exists but we havenâ€™t found it yet.&lt;/p&gt;&lt;h2 id="overall-summary"&gt;Overall Summary&lt;/h2&gt;&lt;p&gt;Whether we used Feign or Retrofit, the management of &lt;em&gt;cookies&lt;/em&gt; and files &lt;em&gt;upload&lt;/em&gt;/&lt;em&gt;download&lt;/em&gt; is easily implemented.&lt;/p&gt;&lt;p&gt;We also found that synchronous errors management is better managed with Feign than Retrofit.&lt;/p&gt;&lt;p&gt;Implementations using &lt;a href="http://square.github.io/okhttp/"&gt;OkHttp&lt;/a&gt; are common to Retrofit and Feign when the client &lt;a href="https://github.com/OpenFeign/feign/tree/master/okhttp"&gt;okhttp-client&lt;/a&gt; is used in Feign.&lt;/p&gt;</content> <author> <name>Emmanuel Vinas</name> <email>emmanuel@monkeypatch.io</email> </author> <author> <name>Igor Laborie</name> <email>igor@monkeypatch.io</email> </author> <author> <name>Bruno Chauvet</name> <email>bruno@monkeypatch.io</email> </author> <category term="MKTD"/> <category term="Java"/> <category term="REST"/> <category term="Feign"/> <category term="Retrofit"/> <category term="Cookie"/> <summary>This article is the second of the serie REST clients in Java.Previous article: MKTD#1 : Getting startedChallenge #2: Going furtherâ€¦The second challenge aims at solving advanced problems such as:Authentication and session management Errors management via Java Exception Files upload and download</summary> <media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://www.monkeypatch.io/public/images/logos/logo-FeignVsRetrofit.png"/> </entry> <entry xml:lang="fr"><title>Mktd#1 Feign Vs Retrofit : 1 Prise En Main</title><link href="http://www.monkeypatch.io/2016/08/09/MKTD-1-feign-vs-retrofit-&-58;-1-prise-en-main.html" rel="alternate" type="text/html" title="Mktd#1 Feign Vs Retrofit &amp;#58; 1 Prise En Main"/> <published>2016-08-09T00:00:00+02:00</published> <updated>2016-08-09T00:00:00+02:00</updated><id>http://www.monkeypatch.io/2016/08/09/MKTD#1-feign-vs-retrofit-&amp;#58;-1-prise-en-main</id> <content type="html" xml:base="http://www.monkeypatch.io/2016/08/09/MKTD-1-feign-vs-retrofit-&amp;-58;-1-prise-en-main.html">&lt;h2 id="introduction"&gt;Introduction&lt;/h2&gt;&lt;p&gt;Nous avons organisÃ© Ã  Toulouse dÃ©but juillet, le premier &lt;a href="http://www.monkeytechdays.com/"&gt;MonkeyTechDays&lt;/a&gt; chez &lt;a href="http://www.harrycow.com/"&gt;HarryCow&lt;/a&gt; sur la thÃ©matique &lt;a href="http://www.monkeytechdays.com/events/mktd-1"&gt;Feign vs Retrofit&lt;/a&gt;. Un &lt;abbr title="MonkeyTechDays"&gt;MKTD&lt;/abbr&gt; consiste Ã  comparer, apprendre, sous forme de dÃ©fis, une ou plusieurs technologies sur une journÃ©e.&lt;/p&gt;&lt;p&gt;Ce premier Ã©vÃ©nement Ã©tait lâ€™occasion dâ€™approfondir les technologies de clients &lt;abbr title="REpresentational State Transfer"&gt;REST&lt;/abbr&gt; en Java. Nous avons donc Ã©tudiÃ© &lt;a href="https://github.com/OpenFeign/feign"&gt;Feign&lt;/a&gt;, une librairie initiÃ©e par &lt;a href="https://netflix.github.io/"&gt;Netflix&lt;/a&gt; et &lt;a href="http://square.github.io/retrofit/"&gt;Retrofit&lt;/a&gt; qui est Ã©crite par &lt;a href="https://github.com/square"&gt;Square&lt;/a&gt;. Ces deux &lt;abbr title="Application Programming Interface"&gt;API&lt;/abbr&gt; permettent dâ€™Ã©crire des clients &lt;abbr title="REpresentational State Transfer"&gt;REST&lt;/abbr&gt; en Java de faÃ§on plus Ã©lÃ©gante quâ€™avec les solutions plus classiques comme JAX-RS client, Spring Rest Template, â€¦ &lt;!--more--&gt;&lt;/p&gt;&lt;p&gt;Pour aider les Ã©quipes Ã  tester les technologies, nous avions au prÃ©alable dÃ©ployÃ© plusieurs services &lt;abbr title="REpresentational State Transfer"&gt;REST&lt;/abbr&gt; sur le thÃ¨me des singes. Le code source de cette journÃ©e est disponible Ã  lâ€™adresse : &lt;a href="https://github.com/monkeytechdays"&gt;https://github.com/monkeytechdays&lt;/a&gt;&lt;/p&gt;&lt;h2 id="dÃ©fi-0--constitution-des-Ã©quipes"&gt;DÃ©fi 0 : Constitution des Ã©quipes&lt;/h2&gt;&lt;p&gt;Ce dÃ©fi nâ€™avait rien de technique, mais nous permet de constituer des Ã©quipes Ã©quitables pour chaque technologie, en finissant nos cafÃ©s, croissants, â€¦ Lâ€™Ã©quipe Feign Ã©tant dirigÃ©e par &lt;a href="https://twitter.com/ilaborie"&gt;Igor&lt;/a&gt; et lâ€™Ã©quipe Retrofit par &lt;a href="https://twitter.com/EmmanuelVinas"&gt;Emmanuel&lt;/a&gt;.&lt;/p&gt;&lt;h2 id="dÃ©fi-1-prise-en-main"&gt;DÃ©fi 1: Prise en main&lt;/h2&gt;&lt;p&gt;Ce premier dÃ©fi consiste Ã  une mise en bouche pour dÃ©couvrir ces technologies.&lt;/p&gt;&lt;p&gt;Le principe dâ€™utilisation de &lt;a href="https://github.com/OpenFeign/feign"&gt;Feign&lt;/a&gt; et &lt;a href="http://square.github.io/retrofit/"&gt;Retrofit&lt;/a&gt; consiste Ã  crÃ©er une interface dÃ©crivant le service &lt;abbr title="REpresentational State Transfer"&gt;REST&lt;/abbr&gt;, puis lâ€™&lt;abbr title="Application Programming Interface"&gt;API&lt;/abbr&gt; se charge de crÃ©er une instance de cette interface. Dans ce premier dÃ©fi, il suffisait de complÃ©ter les interfaces correpondant aux services &lt;abbr title="REpresentational State Transfer"&gt;REST&lt;/abbr&gt; pour faire passer des tests unitaires.&lt;/p&gt;&lt;p&gt;Voici les deux interfaces retournant du &lt;abbr title="JavaScript Object Notation"&gt;JSON&lt;/abbr&gt; :&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;MonkeyApi&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;Page&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Monkey&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="nf"&gt;getMonkeys&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;page&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="n"&gt;Monkey&lt;/span&gt; &lt;span class="nf"&gt;getMonkeyByName&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="n"&gt;Monkey&lt;/span&gt; &lt;span class="nf"&gt;createMonkey&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Monkey&lt;/span&gt; &lt;span class="n"&gt;monkey&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="nf"&gt;deleteMonkey&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;MonkeyRaceApi&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;MonkeyRace&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="nf"&gt;getMonkeyRaces&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;et celle dont le service retourne du &lt;abbr title="eXtensible Markup Language"&gt;XML&lt;/abbr&gt; :&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;MonkeyStatsApi&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;MonkeyStatistics&lt;/span&gt; &lt;span class="nf"&gt;getMonkeyStats&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;Voir le code sous &lt;a href="https://github.com/monkeytechdays/mktd1-defi1"&gt;GitHub&lt;/a&gt;&lt;/p&gt;&lt;p&gt;Pour rÃ©ussir ce dÃ©fi, il faut donc faire:&lt;/p&gt;&lt;ul&gt; &lt;li&gt;un GET et dÃ©coder le &lt;abbr title="JavaScript Object Notation"&gt;JSON&lt;/abbr&gt; de la rÃ©ponse,&lt;/li&gt; &lt;li&gt;un GET avec un paramÃ¨tre de requÃªte,&lt;/li&gt; &lt;li&gt;un GET avec un paramÃ¨tre dans le &lt;em&gt;path&lt;/em&gt; de la requÃªte,&lt;/li&gt; &lt;li&gt;un POST avec un encodage en &lt;abbr title="JavaScript Object Notation"&gt;JSON&lt;/abbr&gt; du corps de la requÃªte,&lt;/li&gt; &lt;li&gt;un DELETE,&lt;/li&gt; &lt;li&gt;un GET et dÃ©coder le &lt;abbr title="eXtensible Markup Language"&gt;XML&lt;/abbr&gt; de la rÃ©ponse.&lt;/li&gt; &lt;/ul&gt;&lt;h2 id="feign"&gt;Feign&lt;/h2&gt;&lt;p&gt;La documentation de Feign se trouve dans le &lt;a href="https://github.com/OpenFeign/feign"&gt;README.md&lt;/a&gt; sous GitHub. La documentation des extensions se trouve aussi dans des fichiers README.md de ces extensions.&lt;/p&gt;&lt;blockquote&gt; &lt;p&gt;Bien que Feign supporte Java 6 par dÃ©faut, nous avons codÃ© avec Java 8.&lt;/p&gt; &lt;/blockquote&gt;&lt;h3 id="dÃ©pendances"&gt;DÃ©pendances&lt;/h3&gt;&lt;p&gt;Pour commencer Ã  utiliser Feign, il faut bien sÃ»r ajouter les dÃ©pendances nÃ©cessaires pour ce dÃ©fi:&lt;/p&gt;&lt;div class="language-xml highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="c"&gt;&amp;lt;!-- Feign --&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;com.netflix.feign&lt;span class="nt"&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;feign-core&lt;span class="nt"&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;version&amp;gt;&lt;/span&gt;8.17.0&lt;span class="nt"&gt;&amp;lt;/version&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt; &lt;span class="c"&gt;&amp;lt;!-- Feign: encode/decode JSON with GSON --&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;com.netflix.feign&lt;span class="nt"&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;feign-gson&lt;span class="nt"&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;version&amp;gt;&lt;/span&gt;8.17.0&lt;span class="nt"&gt;&amp;lt;/version&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt; &lt;span class="c"&gt;&amp;lt;!-- Feign: encode/decode XML with JAXB --&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;com.netflix.feign&lt;span class="nt"&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;feign-jaxb&lt;span class="nt"&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;version&amp;gt;&lt;/span&gt;8.17.0&lt;span class="nt"&gt;&amp;lt;/version&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;blockquote&gt; &lt;p&gt;Nous recommandons bien sÃ»r lâ€™utilisation dâ€™une propriÃ©tÃ© maven pour dÃ©finir la version de Feign utilisÃ©e.&lt;/p&gt; &lt;/blockquote&gt;&lt;h3 id="configuration-des-interfaces"&gt;Configuration des interfaces&lt;/h3&gt;&lt;p&gt;Ensuite il faut annoter les interfaces pour que Feign fasse les requÃªtes &lt;abbr title="HyperText Transfer Protocol"&gt;HTTP&lt;/abbr&gt; correspondantes aux mÃ©thodes de ces interfaces. Feign apporte ses propres annotations pour dÃ©crire les requÃªtes &lt;abbr title="HyperText Transfer Protocol"&gt;HTTP&lt;/abbr&gt;:&lt;/p&gt;&lt;ul&gt; &lt;li&gt;&lt;code class="highlighter-rouge"&gt;@RequestLine&lt;/code&gt;: permet de dÃ©finir la premiÃ¨re ligne de la requÃªte &lt;abbr title="HyperText Transfer Protocol"&gt;HTTP&lt;/abbr&gt;: le verbe &lt;abbr title="HyperText Transfer Protocol"&gt;HTTP&lt;/abbr&gt; (GET, POST, PUT, DELETE, â€¦) et le chemin, on y prÃ©cise aussi les paramÃ¨tres de la requÃªte. On peut utiliser la notation &lt;code class="highlighter-rouge"&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="err"&gt;name&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;/code&gt; pour dÃ©finir une partie variable de la requÃªte (paramÃ¨tre ou chemin)&lt;/li&gt; &lt;li&gt;&lt;code class="highlighter-rouge"&gt;@Param&lt;/code&gt;: cette annotation permet de faire le lien entre une variable dÃ©finie dans les autres annotations (&lt;code class="highlighter-rouge"&gt;@RequestLine&lt;/code&gt;, &lt;code class="highlighter-rouge"&gt;@Headers&lt;/code&gt;, â€¦) et le paramÃ¨tre de la mÃ©thode. Il faut prÃ©ciser le nom de la variable dans lâ€™annotation.&lt;/li&gt; &lt;li&gt;&lt;code class="highlighter-rouge"&gt;@Headers&lt;/code&gt;: permet dâ€™ajouter une en-tÃªte &lt;abbr title="HyperText Transfer Protocol"&gt;HTTP&lt;/abbr&gt;, comme pour &lt;code class="highlighter-rouge"&gt;@RequestLine&lt;/code&gt; on peut utiliser la notation &lt;code class="highlighter-rouge"&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="err"&gt;name&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;/code&gt; pour dÃ©finir une valeur variable dans lâ€™en-tÃªte &lt;abbr title="HyperText Transfer Protocol"&gt;HTTP&lt;/abbr&gt;. Cette annotation, peut Ãªtre mise sur lâ€™interface, ou sur une mÃ©thode de cette interface. Pas dâ€™annotation pour le corps dâ€™une requÃªte POST ou PUT, le paramÃ¨tre sans annotation sera converti dans le corps de la requÃªte.&lt;/li&gt; &lt;/ul&gt;&lt;p&gt;Ce qui nous donne ceci :&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;MonkeyRaceApi&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="nd"&gt;@RequestLine&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"GET /races"&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;MonkeyRace&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="nf"&gt;getMonkeyRaces&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7 8 9 10 11 12 13 14&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="nd"&gt;@Headers&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"Content-Type: application/json"&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;MonkeyApi&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="nd"&gt;@RequestLine&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"GET ?page={page}"&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="n"&gt;Page&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Monkey&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="nf"&gt;getMonkeys&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nd"&gt;@Param&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"page"&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;page&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;&lt;span class="nd"&gt;@RequestLine&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"GET /{name}"&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="n"&gt;Monkey&lt;/span&gt; &lt;span class="nf"&gt;getMonkeyByName&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nd"&gt;@Param&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"name"&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;&lt;span class="nd"&gt;@RequestLine&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"POST "&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="n"&gt;Monkey&lt;/span&gt; &lt;span class="nf"&gt;createMonkey&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Monkey&lt;/span&gt; &lt;span class="n"&gt;monkey&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;&lt;span class="nd"&gt;@RequestLine&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"DELETE /{id}"&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="nf"&gt;deleteMonkey&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nd"&gt;@Param&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"id"&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;MonkeyStatsApi&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="nd"&gt;@RequestLine&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"GET /stats"&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="n"&gt;MonkeyStatistics&lt;/span&gt; &lt;span class="nf"&gt;getMonkeyStats&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;h3 id="construction-des-instances"&gt;Construction des instances&lt;/h3&gt;&lt;p&gt;Pour la derniÃ¨re Ã©tape, on utilise lâ€™&lt;abbr title="Application Programming Interface"&gt;API&lt;/abbr&gt; &lt;em&gt;fluent builder&lt;/em&gt; de Feign pour crÃ©er lâ€™instance de ces interfaces. Câ€™est ici que lâ€™on va faire intervenir les encodeurs/dÃ©codeurs ajoutÃ©s dans nos dÃ©pendances Maven plus tÃ´t :&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;static&lt;/span&gt; &lt;span class="n"&gt;MonkeyRaceApi&lt;/span&gt; &lt;span class="nf"&gt;buildRaceApi&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;Feign&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;builder&lt;/span&gt;&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="c1"&gt;// Decode JSON from respone body&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;decoder&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;GsonDecoder&lt;/span&gt;&lt;span class="o"&gt;())&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;target&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MonkeyRaceApi&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7 8&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;static&lt;/span&gt; &lt;span class="n"&gt;MonkeyApi&lt;/span&gt; &lt;span class="nf"&gt;buildMonkeyApi&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;Feign&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;builder&lt;/span&gt;&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="c1"&gt;// Decode JSON from respone body&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;decoder&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;GsonDecoder&lt;/span&gt;&lt;span class="o"&gt;())&lt;/span&gt; &lt;span class="c1"&gt;// Encode JSON for request body&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;encoder&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;GsonEncoder&lt;/span&gt;&lt;span class="o"&gt;())&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;target&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MonkeyApi&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s"&gt;"/monkeys"&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7 8 9 10 11&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;static&lt;/span&gt; &lt;span class="n"&gt;MonkeyStatsApi&lt;/span&gt; &lt;span class="nf"&gt;buildStatsApi&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="c1"&gt;// Create JAXB context factory&lt;/span&gt; &lt;span class="n"&gt;JAXBContextFactory&lt;/span&gt; &lt;span class="n"&gt;jaxbFactory&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;JAXBContextFactory&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Builder&lt;/span&gt;&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;withMarshallerJAXBEncoding&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"UTF-8"&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;build&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;Feign&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;builder&lt;/span&gt;&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="c1"&gt;// Decode XML from response body&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;decoder&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;JAXBDecoder&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;jaxbFactory&lt;/span&gt;&lt;span class="o"&gt;))&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;target&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MonkeyStatsApi&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;blockquote&gt; &lt;p&gt;Feign va concatÃ©ner lâ€™&lt;abbr title="Uniform Resource Locator"&gt;URL&lt;/abbr&gt; avec le chemin dÃ©fini, dans le chemin de lâ€™annotation &lt;code class="highlighter-rouge"&gt;@RequestLine&lt;/code&gt;, ceci permet facilement de rajouter un prÃ©fixe pour les services si on le souhaite.&lt;/p&gt; &lt;/blockquote&gt;&lt;h3 id="bilan"&gt;Bilan&lt;/h3&gt;&lt;p&gt;Peu de points nÃ©gatifs pour Feign dans cet exercice:&lt;/p&gt;&lt;ul&gt; &lt;li&gt;pour faire fonctionner le dÃ©codage &lt;abbr title="eXtensible Markup Language"&gt;XML&lt;/abbr&gt; il a fallu triturer un peu lâ€™objet pour que &lt;a href="https://docs.oracle.com/javase/tutorial/jaxb/intro/"&gt;JAXB&lt;/a&gt; &lt;em&gt;deserialize&lt;/em&gt; correctement le &lt;abbr title="eXtensible Markup Language"&gt;XML&lt;/abbr&gt;. Mais câ€™est plus un problÃ¨me liÃ© Ã  JAXB et au &lt;abbr title="eXtensible Markup Language"&gt;XML&lt;/abbr&gt; de faÃ§on plus gÃ©nÃ©rale,&lt;/li&gt; &lt;li&gt;les messages dâ€™erreurs ne sont parfois pas simples Ã  dÃ©crypter, mais avec un peu de pratique et une connaissance basique du protocole &lt;abbr title="HyperText Transfer Protocol"&gt;HTTP&lt;/abbr&gt;, Ã§a nâ€™est pas vraiment un problÃ¨me. Un problÃ¨me classique est le fait dâ€™oublier le verbe &lt;abbr title="HyperText Transfer Protocol"&gt;HTTP&lt;/abbr&gt; dans lâ€™annotation &lt;code class="highlighter-rouge"&gt;@RequestLine&lt;/code&gt;.&lt;/li&gt; &lt;/ul&gt;&lt;p&gt;Beaucoup de cÃ´tÃ©s positifs ici:&lt;/p&gt;&lt;ul&gt; &lt;li&gt;simple et proche du &lt;abbr title="HyperText Transfer Protocol"&gt;HTTP&lt;/abbr&gt;,&lt;/li&gt; &lt;li&gt;trÃ¨s lÃ©ger, il nâ€™y a pas de dÃ©pendances transitives pour le &lt;code class="highlighter-rouge"&gt;feign-core&lt;/code&gt;,&lt;/li&gt; &lt;li&gt;facilement extensible: par exemple, il est facile de changer dâ€™encodeur/dÃ©codeur &lt;a href="https://github.com/OpenFeign/feign/tree/master/gson"&gt;GSON&lt;/a&gt;, &lt;a href="https://github.com/OpenFeign/feign/tree/master/jackson"&gt;Jackson&lt;/a&gt;, &lt;a href="https://github.com/OpenFeign/feign/tree/master/jaxb"&gt;JAXB&lt;/a&gt;, â€¦,&lt;/li&gt; &lt;li&gt;il y a un bon support de Java 8, par exemple, les mÃ©thodes &lt;code class="highlighter-rouge"&gt;static&lt;/code&gt; et &lt;code class="highlighter-rouge"&gt;default&lt;/code&gt; des interfaces de Java 8 sont supportÃ©es.&lt;/li&gt; &lt;/ul&gt;&lt;p&gt;Quelques remarques:&lt;/p&gt;&lt;ul&gt; &lt;li&gt;il y a dâ€™autres annotations &lt;code class="highlighter-rouge"&gt;@Body&lt;/code&gt;, &lt;code class="highlighter-rouge"&gt;@HeaderMap&lt;/code&gt;, &lt;code class="highlighter-rouge"&gt;@QueryMap&lt;/code&gt; qui existent,&lt;/li&gt; &lt;li&gt;on peut configurer la faÃ§on dont les variables (&lt;code class="highlighter-rouge"&gt;@Param&lt;/code&gt;) sont converties en String via les &lt;code class="highlighter-rouge"&gt;Expander&lt;/code&gt;.&lt;/li&gt; &lt;li&gt;pour dÃ©finir un chemin racine Ã  toutes nos mÃ©thodes dans lâ€™interface, on peut lâ€™ajouter dans lâ€™&lt;abbr title="Uniform Resource Locator"&gt;URL&lt;/abbr&gt; utilisÃ©e par le &lt;em&gt;builder&lt;/em&gt;.&lt;/li&gt; &lt;/ul&gt;&lt;blockquote&gt; &lt;p&gt;Il nâ€™y a pas de magie dans Feign : il nâ€™utilise que ce qui existe dÃ©jÃ  dans le &lt;abbr title="Java Developement Kit"&gt;JDK&lt;/abbr&gt; : &lt;code class="highlighter-rouge"&gt;java.net.HttpURLConnection&lt;/code&gt;, &lt;code class="highlighter-rouge"&gt;java.lang.reflect.Proxy&lt;/code&gt;, &lt;code class="highlighter-rouge"&gt;java.lang.reflect.InvocationHandler&lt;/code&gt;, â€¦&lt;/p&gt; &lt;/blockquote&gt;&lt;h2 id="retrofit"&gt;Retrofit&lt;/h2&gt;&lt;p&gt;La premiÃ¨re Ã©tape consiste Ã  rajouter les dÃ©pendances de RÃ©trofit&lt;/p&gt;&lt;div class="language-xml highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="cp"&gt;&amp;lt;! -- DÃ©pendance de rÃ©trofit --&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;com.squareup.retrofit2&lt;span class="nt"&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;retrofit&lt;span class="nt"&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;version&amp;gt;&lt;/span&gt;${retrofit.version}&lt;span class="nt"&gt;&amp;lt;/version&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt; &lt;span class="cp"&gt;&amp;lt;! -- Converter Jackson pour gÃ©rer le Json --&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;com.squareup.retrofit2&lt;span class="nt"&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;converter-jackson&lt;span class="nt"&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;version&amp;gt;&lt;/span&gt;${retrofit.version}&lt;span class="nt"&gt;&amp;lt;/version&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt; &lt;span class="c"&gt;&amp;lt;!-- Converter Simple Xml pour gÃ©rer le xml --&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;com.squareup.retrofit2&lt;span class="nt"&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;converter-simplexml&lt;span class="nt"&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;version&amp;gt;&lt;/span&gt;${retrofit.version}&lt;span class="nt"&gt;&amp;lt;/version&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;Ensuite, il nous faut rajouter les annotations spÃ©cifiques Ã  Retrofit sur lâ€™interface. Les rÃ¨gles du jeu Ã©tant de ne pas changer la signature de lâ€™interface, nous avons dÃ» ajouter une autre interface utilisÃ©e par la &lt;code class="highlighter-rouge"&gt;CallFactory&lt;/code&gt; par dÃ©faut de Retrofit.&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;MonkeyRaceService&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="nd"&gt;@GET&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"races"&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="n"&gt;Call&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;MonkeyRace&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="nf"&gt;getMonkeyRaces&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7 8 9 10 11 12 13&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;MonkeyService&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="nd"&gt;@GET&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"monkeys"&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="n"&gt;Call&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Page&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Monkey&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="nf"&gt;getMonkeys&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt;&lt;span class="nd"&gt;@GET&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"monkeys/{name}"&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="n"&gt;Call&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Monkey&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="nf"&gt;getMonkeyByName&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nd"&gt;@Path&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"name"&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;&lt;span class="nd"&gt;@POST&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"monkeys"&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="n"&gt;Call&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Monkey&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="nf"&gt;create&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nd"&gt;@Body&lt;/span&gt; &lt;span class="n"&gt;Monkey&lt;/span&gt; &lt;span class="n"&gt;monkey&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;&lt;span class="nd"&gt;@DELETE&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"monkeys/{id}"&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="n"&gt;Call&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;ResponseBody&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="nf"&gt;delete&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nd"&gt;@Path&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"id"&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;monkeyId&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;MonkeyStatsService&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="nd"&gt;@GET&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"/stats"&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="n"&gt;Call&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;MonkeyStatistics&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="nf"&gt;getMonkeyStats&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;Ensuite, nous implÃ©mentons les interfaces &lt;code class="highlighter-rouge"&gt;MonkeyApi&lt;/code&gt;, &lt;code class="highlighter-rouge"&gt;MonkeyRaceApi&lt;/code&gt;, &lt;code class="highlighter-rouge"&gt;MonkeyStatsApi&lt;/code&gt; en utilisant les interfaces spÃ©cifiques pour Retrofit.&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;RetrofitMonkeyApi&lt;/span&gt; &lt;span class="kd"&gt;implements&lt;/span&gt; &lt;span class="n"&gt;MonkeyApi&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;RetrofitApi&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="kd"&gt;private&lt;/span&gt; &lt;span class="n"&gt;MonkeyService&lt;/span&gt; &lt;span class="n"&gt;monkeyService&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="nf"&gt;setBaseUrl&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;baseUrl&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;monkeyService&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;createRetrofit&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;baseUrl&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;create&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MonkeyService&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt; &lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="n"&gt;Page&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Monkey&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="nf"&gt;getMonkeys&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;page&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nf"&gt;executeCall&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nl"&gt;monkeyService:&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;getMonkeys&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt; &lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="n"&gt;Monkey&lt;/span&gt; &lt;span class="nf"&gt;getMonkeyByName&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nf"&gt;executeCall&lt;/span&gt;&lt;span class="o"&gt;(()&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;monkeyService&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getMonkeyByName&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;));&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt; &lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="n"&gt;Monkey&lt;/span&gt; &lt;span class="nf"&gt;createMonkey&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Monkey&lt;/span&gt; &lt;span class="n"&gt;monkey&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nf"&gt;executeCall&lt;/span&gt;&lt;span class="o"&gt;(()&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;monkeyService&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;create&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;monkey&lt;/span&gt;&lt;span class="o"&gt;));&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt; &lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="nf"&gt;deleteMonkey&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;executeCall&lt;/span&gt;&lt;span class="o"&gt;(()&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;monkeyService&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;delete&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;));&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;RetrofitApi&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;&lt;span class="k"&gt;default&lt;/span&gt; &lt;span class="n"&gt;Retrofit&lt;/span&gt; &lt;span class="nf"&gt;createRetrofit&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;baseUrl&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;boolean&lt;/span&gt; &lt;span class="n"&gt;useXml&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;Retrofit&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Builder&lt;/span&gt; &lt;span class="n"&gt;builder&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;Retrofit&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Builder&lt;/span&gt;&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;baseUrl&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;baseUrl&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;useXml&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;builder&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;addConverterFactory&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;SimpleXmlConverterFactory&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;create&lt;/span&gt;&lt;span class="o"&gt;());&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="n"&gt;builder&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;addConverterFactory&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;JacksonConverterFactory&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;create&lt;/span&gt;&lt;span class="o"&gt;());&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;builder&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;build&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt;&lt;span class="k"&gt;default&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;T&lt;/span&gt; &lt;span class="nf"&gt;executeCall&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Supplier&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Call&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;supplier&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;try&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;Call&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;call&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;supplier&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;call&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;execute&lt;/span&gt;&lt;span class="o"&gt;().&lt;/span&gt;&lt;span class="na"&gt;body&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="k"&gt;catch&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;IOException&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;h3 id="bilan-1"&gt;Bilan&lt;/h3&gt;&lt;h4 id="points-nÃ©gatifs"&gt;Points nÃ©gatifs&lt;/h4&gt;&lt;p&gt;Nous trouvons dommage quâ€™il nâ€™y ait pas nativement une &lt;code class="highlighter-rouge"&gt;CallFactory&lt;/code&gt; permettant de faire de faÃ§on synchrone un appel retournant notre objet mÃ©tier sans avoir besoin de passer par lâ€™objet &lt;code class="highlighter-rouge"&gt;Call&lt;/code&gt; Ã  la maniÃ¨re dont cela est gÃ©rÃ© avec Feign.&lt;/p&gt;&lt;p&gt;Il est aussi possible de faire notre propre &lt;code class="highlighter-rouge"&gt;CallAdapterFactory&lt;/code&gt;. Voici un exemple tirÃ© du code source des tests de Retrofit :&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;static&lt;/span&gt; &lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;DirectCallIOException&lt;/span&gt; &lt;span class="kd"&gt;extends&lt;/span&gt; &lt;span class="n"&gt;RuntimeException&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;DirectCallIOException&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;message&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;IOException&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="kd"&gt;super&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;message&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt; &lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;DirectCallAdapterFactory&lt;/span&gt; &lt;span class="kd"&gt;extends&lt;/span&gt; &lt;span class="n"&gt;CallAdapter&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Factory&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="nd"&gt;@Override&lt;/span&gt; &lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="n"&gt;CallAdapter&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;?&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;final&lt;/span&gt; &lt;span class="n"&gt;Type&lt;/span&gt; &lt;span class="n"&gt;returnType&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Annotation&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt; &lt;span class="n"&gt;annotations&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Retrofit&lt;/span&gt; &lt;span class="n"&gt;retrofit&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;CallAdapter&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="nd"&gt;@Override&lt;/span&gt; &lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="n"&gt;Type&lt;/span&gt; &lt;span class="nf"&gt;responseType&lt;/span&gt;&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;returnType&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt; &lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="n"&gt;Object&lt;/span&gt; &lt;span class="nf"&gt;adapt&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Call&lt;/span&gt; &lt;span class="n"&gt;call&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;try&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;call&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;execute&lt;/span&gt;&lt;span class="o"&gt;().&lt;/span&gt;&lt;span class="na"&gt;body&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="k"&gt;catch&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;IOException&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;throw&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nf"&gt;DirectCallIOException&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getMessage&lt;/span&gt;&lt;span class="o"&gt;(),&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="o"&gt;};&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;Cela nous obligerait quand mÃªme Ã  traiter les exceptions de type &lt;code class="highlighter-rouge"&gt;DirectCallIOException&lt;/code&gt;.&lt;/p&gt;&lt;p&gt;Autre point que nous trouvons dommage lors de cet exercice est le fait que nous devons catcher les &lt;code class="highlighter-rouge"&gt;IOException&lt;/code&gt; qui peuvent se produire lors de lâ€™appel. Peut Ãªtre manque-t-il a Retrofit une gestion des exceptions comme Feign peut lâ€™avoir. Nous verrons cela plus en dÃ©tail dans lâ€™exercice suivant.&lt;/p&gt;&lt;p&gt;Dernier point â€˜nÃ©gatifâ€™, Retrofit ayant besoin de plusieurs dÃ©pendances pour fonctionner : &lt;a href="http://square.github.io/okhttp/"&gt;OkHttp&lt;/a&gt; et dâ€™au moins 1 &lt;em&gt;converter&lt;/em&gt;, la taille de lâ€™exÃ©cutable gÃ©nÃ©rÃ© est sensiblement plus grosse que celle de lâ€™exÃ©cutable de Feign (1.5Mo contre 0.5Mo).&lt;/p&gt;&lt;h4 id="points-positifs"&gt;Points Positifs&lt;/h4&gt;&lt;p&gt;Retrofit reste simple Ã  utiliser. Le fait que les principaux &lt;em&gt;converters&lt;/em&gt; soient disponibles est une trÃ¨s bonne chose.&lt;/p&gt;&lt;p&gt;Retrofit a ses propres annotations, Ã©vitant ainsi les erreurs de &lt;em&gt;typo&lt;/em&gt;, ce qui est une trÃ¨s bonne chose. Bien que Feign se soit amÃ©liorÃ©e sur les messages dâ€™erreurs, nous trouvons prÃ©fÃ©rable le choix fait par lâ€™Ã©quipe de Retrofit sur cette partie.&lt;/p&gt;</content> <author> <name>Emmanuel Vinas</name> <email>emmanuel@monkeypatch.io</email> </author> <author> <name>Igor Laborie</name> <email>igor@monkeypatch.io</email> </author> <category term="MKTD"/> <category term="Java"/> <category term="REST"/> <category term="Feign"/> <category term="Retrofit"/> <summary>IntroductionNous avons organisÃ© Ã  Toulouse dÃ©but juillet, le premier MonkeyTechDays chez HarryCow sur la thÃ©matique Feign vs Retrofit. Un MKTD consiste Ã  comparer, apprendre, sous forme de dÃ©fis, une ou plusieurs technologies sur une journÃ©e.Ce premier Ã©vÃ©nement Ã©tait lâ€™occasion dâ€™approfondir les technologies de clients REST en Java. Nous avons donc Ã©tudiÃ© Feign, une librairie initiÃ©e par Netflix et Retrofit qui est Ã©crite par Square. Ces deux API permettent dâ€™Ã©crire des clients REST en Java de faÃ§on plus Ã©lÃ©gante quâ€™avec les solutions plus classiques comme JAX-RS client, Spring Rest Template, â€¦</summary> <media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://www.monkeypatch.io/public/images/logos/logo-FeignVsRetrofit.png"/> </entry> <entry xml:lang="en"><title>Mktd#1 Feign Vs Retrofit : 1 Getting Started</title><link href="http://www.monkeypatch.io/2016/08/09/MKTD-1-feign-vs-retrofit-&-58;-1-getting-started.html" rel="alternate" type="text/html" title="Mktd#1 Feign Vs Retrofit &amp;#58; 1 Getting Started"/> <published>2016-08-09T00:00:00+02:00</published> <updated>2016-08-09T00:00:00+02:00</updated><id>http://www.monkeypatch.io/2016/08/09/MKTD#1-feign-vs-retrofit-&amp;#58;-1-getting-started</id> <content type="html" xml:base="http://www.monkeypatch.io/2016/08/09/MKTD-1-feign-vs-retrofit-&amp;-58;-1-getting-started.html">&lt;h2 id="introduction"&gt;Introduction&lt;/h2&gt;&lt;p&gt;Early July we organised in Toulouse our first &lt;a href="http://www.monkeytechdays.com/"&gt;MonkeyTechDays&lt;/a&gt; hosted by &lt;a href="http://www.harrycow.com/"&gt;HarryCow&lt;/a&gt; comparing the technologies: &lt;a href="http://www.monkeytechdays.com/events/mktd-1"&gt;Feign vs Retrofit&lt;/a&gt;. The goal of a &lt;abbr title="MonkeyTechDays"&gt;MKTD&lt;/abbr&gt; is to compare and learn new technologies running challenges throughout the day.&lt;/p&gt;&lt;p&gt;We decided to improve our knowledge of &lt;abbr title="REpresentational State Transfer"&gt;REST&lt;/abbr&gt; clients in Java during this first event. We started with &lt;a href="https://github.com/OpenFeign/feign"&gt;Feign&lt;/a&gt; which is designed by &lt;a href="https://netflix.github.io/"&gt;Netflix&lt;/a&gt; and &lt;a href="http://square.github.io/retrofit/"&gt;Retrofit&lt;/a&gt; written by &lt;a href="https://github.com/square"&gt;Square&lt;/a&gt;. These two libraries provide an elegant way to speed up the development of &lt;abbr title="REpresentational State Transfer"&gt;REST&lt;/abbr&gt; clients in Java compare to traditional solutions such as JAX-RS clients, Spring Rest Template, etcâ€¦ &lt;!--more--&gt;&lt;/p&gt;&lt;p&gt;To bootstrap the teams playing around with these technologies, we had made available several &lt;abbr title="REpresentational State Transfer"&gt;REST&lt;/abbr&gt; services around the Monkeys theme. Source code writtent this day is available at: &lt;a href="https://github.com/monkeytechdays"&gt;https://github.com/monkeytechdays&lt;/a&gt;&lt;/p&gt;&lt;h2 id="challenge-0-forming-teams"&gt;Challenge #0: Forming teams&lt;/h2&gt;&lt;p&gt;This non-technical challenge allows us forming balanced teams on each technology while finishing our breakfast: coffee and croissants. The Feign team was lead by &lt;a href="https://twitter.com/ilaborie"&gt;Igor&lt;/a&gt; and the Retrofit team by &lt;a href="https://twitter.com/EmmanuelVinas"&gt;Emmanuel&lt;/a&gt;.&lt;/p&gt;&lt;h2 id="challenge-1-getting-started"&gt;Challenge #1: Getting started&lt;/h2&gt;&lt;p&gt;The goal of this first challenge is to get familiar with the technologies. The principle of &lt;a href="https://github.com/OpenFeign/feign"&gt;Feign&lt;/a&gt; and &lt;a href="http://square.github.io/retrofit/"&gt;Retrofit&lt;/a&gt; is to write an interface describing the &lt;abbr title="REpresentational State Transfer"&gt;REST&lt;/abbr&gt; service and the &lt;abbr title="Application Programming Interface"&gt;API&lt;/abbr&gt; will take care of implementing an instance of this interface. At the end of this first challenge, completing the interfaces for the &lt;abbr title="REpresentational State Transfer"&gt;REST&lt;/abbr&gt; services was sufficient to get the unit tests green.&lt;/p&gt;&lt;p&gt;Here are the two interfaces returning &lt;abbr title="JavaScript Object Notation"&gt;JSON&lt;/abbr&gt; format:&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;MonkeyApi&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;Page&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Monkey&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="nf"&gt;getMonkeys&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;page&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="n"&gt;Monkey&lt;/span&gt; &lt;span class="nf"&gt;getMonkeyByName&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="n"&gt;Monkey&lt;/span&gt; &lt;span class="nf"&gt;createMonkey&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Monkey&lt;/span&gt; &lt;span class="n"&gt;monkey&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="nf"&gt;deleteMonkey&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;MonkeyRaceApi&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;MonkeyRace&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="nf"&gt;getMonkeyRaces&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;and the service returning &lt;abbr title="eXtensible Markup Language"&gt;XML&lt;/abbr&gt; data:&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;MonkeyStatsApi&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;MonkeyStatistics&lt;/span&gt; &lt;span class="nf"&gt;getMonkeyStats&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;The code is available here: &lt;a href="https://github.com/monkeytechdays/mktd1-defi1"&gt;GitHub&lt;/a&gt;&lt;/p&gt;&lt;p&gt;To pass this challenge, the following is required:&lt;/p&gt;&lt;ul&gt; &lt;li&gt;GET request and parse the &lt;abbr title="JavaScript Object Notation"&gt;JSON&lt;/abbr&gt; response&lt;/li&gt; &lt;li&gt;GET request with a &lt;abbr title="Uniform Resource Locator"&gt;URL&lt;/abbr&gt; parameter&lt;/li&gt; &lt;li&gt;GET request with a path parameter&lt;/li&gt; &lt;li&gt;POST request with encoded &lt;abbr title="JavaScript Object Notation"&gt;JSON&lt;/abbr&gt; body&lt;/li&gt; &lt;li&gt;DELETE request&lt;/li&gt; &lt;li&gt;GET request and parse the &lt;abbr title="eXtensible Markup Language"&gt;XML&lt;/abbr&gt; response&lt;/li&gt; &lt;/ul&gt;&lt;h2 id="feign"&gt;Feign&lt;/h2&gt;&lt;p&gt;The Feign documentation is hosted on Github inside the &lt;a href="https://github.com/OpenFeign/feign"&gt;README.md&lt;/a&gt; Extensions documentation is also available in the README.md files of these extensions&lt;/p&gt;&lt;blockquote&gt; &lt;p&gt;Even if Feign supports Java 6 by default, we have been using Java 8&lt;/p&gt; &lt;/blockquote&gt;&lt;h3 id="dependencies"&gt;Dependencies&lt;/h3&gt;&lt;p&gt;To start using Feign inside a project, the following dependencies need to be added to the POM file:&lt;/p&gt;&lt;div class="language-xml highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="c"&gt;&amp;lt;!-- Feign --&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;com.netflix.feign&lt;span class="nt"&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;feign-core&lt;span class="nt"&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;version&amp;gt;&lt;/span&gt;8.17.0&lt;span class="nt"&gt;&amp;lt;/version&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt; &lt;span class="c"&gt;&amp;lt;!-- Feign: encode/decode JSON with GSON --&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;com.netflix.feign&lt;span class="nt"&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;feign-gson&lt;span class="nt"&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;version&amp;gt;&lt;/span&gt;8.17.0&lt;span class="nt"&gt;&amp;lt;/version&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt; &lt;span class="c"&gt;&amp;lt;!-- Feign: encode/decode XML with JAXB --&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;com.netflix.feign&lt;span class="nt"&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;feign-jaxb&lt;span class="nt"&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;version&amp;gt;&lt;/span&gt;8.17.0&lt;span class="nt"&gt;&amp;lt;/version&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;blockquote&gt; &lt;p&gt;We highly recommend setting a maven property to define the version of Feign to be used&lt;/p&gt; &lt;/blockquote&gt;&lt;h3 id="interfaces-configuration"&gt;Interfaces Configuration&lt;/h3&gt;&lt;p&gt;The next step is to annotate the interfaces so Feign can implement the &lt;abbr title="HyperText Transfer Protocol"&gt;HTTP&lt;/abbr&gt; requests of each method. Feign comes with its own annotations describing the &lt;abbr title="HyperText Transfer Protocol"&gt;HTTP&lt;/abbr&gt; requests:&lt;/p&gt;&lt;ul&gt; &lt;li&gt;&lt;code class="highlighter-rouge"&gt;@RequestLine&lt;/code&gt;: describes the first &lt;abbr title="HyperText Transfer Protocol"&gt;HTTP&lt;/abbr&gt; line: &lt;abbr title="HyperText Transfer Protocol"&gt;HTTP&lt;/abbr&gt; verb (GET, POST, PUT, DELETE, â€¦) and path, defining as well the request parameters. Path parameters can be defined using the &lt;code class="highlighter-rouge"&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="err"&gt;name&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;/code&gt; convention.&lt;/li&gt; &lt;li&gt;&lt;code class="highlighter-rouge"&gt;@Param&lt;/code&gt;: binds a variable defined in other annotations (&lt;code class="highlighter-rouge"&gt;@RequestLine&lt;/code&gt;, &lt;code class="highlighter-rouge"&gt;@Headers&lt;/code&gt;, â€¦) and the method parameter. The variable name must be defined by the annotation.&lt;/li&gt; &lt;li&gt;&lt;code class="highlighter-rouge"&gt;@Headers&lt;/code&gt;: adds a custom &lt;abbr title="HyperText Transfer Protocol"&gt;HTTP&lt;/abbr&gt; header, similarly to &lt;code class="highlighter-rouge"&gt;@RequestLine&lt;/code&gt;, the &lt;code class="highlighter-rouge"&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="err"&gt;name&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;/code&gt; convention can be used to define a variable inside the &lt;abbr title="HyperText Transfer Protocol"&gt;HTTP&lt;/abbr&gt; header. This annotation is applicable at the interface or method level. If there is no annotation for the body of a POST or PUT request, the parameters without annotation will be converted inside the request body.&lt;/li&gt; &lt;/ul&gt;&lt;p&gt;So we end up with the following:&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;MonkeyRaceApi&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="nd"&gt;@RequestLine&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"GET /races"&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;MonkeyRace&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="nf"&gt;getMonkeyRaces&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7 8 9 10 11 12 13 14&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="nd"&gt;@Headers&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"Content-Type: application/json"&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;MonkeyApi&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="nd"&gt;@RequestLine&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"GET ?page={page}"&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="n"&gt;Page&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Monkey&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="nf"&gt;getMonkeys&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nd"&gt;@Param&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"page"&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;page&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;&lt;span class="nd"&gt;@RequestLine&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"GET /{name}"&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="n"&gt;Monkey&lt;/span&gt; &lt;span class="nf"&gt;getMonkeyByName&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nd"&gt;@Param&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"name"&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;&lt;span class="nd"&gt;@RequestLine&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"POST "&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="n"&gt;Monkey&lt;/span&gt; &lt;span class="nf"&gt;createMonkey&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Monkey&lt;/span&gt; &lt;span class="n"&gt;monkey&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;&lt;span class="nd"&gt;@RequestLine&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"DELETE /{id}"&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="nf"&gt;deleteMonkey&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nd"&gt;@Param&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"id"&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;MonkeyStatsApi&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="nd"&gt;@RequestLine&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"GET /stats"&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="n"&gt;MonkeyStatistics&lt;/span&gt; &lt;span class="nf"&gt;getMonkeyStats&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;h3 id="instances-construction"&gt;Instances construction&lt;/h3&gt;&lt;p&gt;For the last step, we leverage the &lt;abbr title="Application Programming Interface"&gt;API&lt;/abbr&gt; &lt;em&gt;fluent builder&lt;/em&gt; provided by Feign to instanciate the interfaces. This is where the encoders/decoders dependencies added by maven earlier on will kick-in:&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;static&lt;/span&gt; &lt;span class="n"&gt;MonkeyRaceApi&lt;/span&gt; &lt;span class="nf"&gt;buildRaceApi&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;Feign&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;builder&lt;/span&gt;&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="c1"&gt;// Decode JSON from respone body&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;decoder&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;GsonDecoder&lt;/span&gt;&lt;span class="o"&gt;())&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;target&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MonkeyRaceApi&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7 8&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;static&lt;/span&gt; &lt;span class="n"&gt;MonkeyApi&lt;/span&gt; &lt;span class="nf"&gt;buildMonkeyApi&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;Feign&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;builder&lt;/span&gt;&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="c1"&gt;// Decode JSON from respone body&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;decoder&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;GsonDecoder&lt;/span&gt;&lt;span class="o"&gt;())&lt;/span&gt; &lt;span class="c1"&gt;// Encode JSON for request body&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;encoder&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;GsonEncoder&lt;/span&gt;&lt;span class="o"&gt;())&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;target&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MonkeyApi&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s"&gt;"/monkeys"&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7 8 9 10 11&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;static&lt;/span&gt; &lt;span class="n"&gt;MonkeyStatsApi&lt;/span&gt; &lt;span class="nf"&gt;buildStatsApi&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="c1"&gt;// Create JAXB context factory&lt;/span&gt; &lt;span class="n"&gt;JAXBContextFactory&lt;/span&gt; &lt;span class="n"&gt;jaxbFactory&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;JAXBContextFactory&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Builder&lt;/span&gt;&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;withMarshallerJAXBEncoding&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"UTF-8"&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;build&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;Feign&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;builder&lt;/span&gt;&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="c1"&gt;// Decode XML from response body&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;decoder&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;JAXBDecoder&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;jaxbFactory&lt;/span&gt;&lt;span class="o"&gt;))&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;target&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MonkeyStatsApi&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;blockquote&gt; &lt;p&gt;Feign concatenates the &lt;abbr title="Uniform Resource Locator"&gt;URL&lt;/abbr&gt; with the path defined by the &lt;code class="highlighter-rouge"&gt;@RequestLine&lt;/code&gt; annotation. This provides an easy way to add a prefix to our services if required.&lt;/p&gt; &lt;/blockquote&gt;&lt;h3 id="conclusion"&gt;Conclusion&lt;/h3&gt;&lt;p&gt;Very few drawbacks using Feign during this experiment:&lt;/p&gt;&lt;ul&gt; &lt;li&gt;To get the &lt;abbr title="eXtensible Markup Language"&gt;XML&lt;/abbr&gt; decoding to work, we had to tweak the object so &lt;a href="https://docs.oracle.com/javase/tutorial/jaxb/intro/"&gt;JAXB&lt;/a&gt; can correctly &lt;em&gt;deserialise&lt;/em&gt; the &lt;abbr title="eXtensible Markup Language"&gt;XML&lt;/abbr&gt; response. But this is a more general issue with JAXB and &lt;abbr title="eXtensible Markup Language"&gt;XML&lt;/abbr&gt; parsing.&lt;/li&gt; &lt;li&gt;Error messages are not always easy to decrypt, but with a bit more experience and basic knowledge of the &lt;abbr title="HyperText Transfer Protocol"&gt;HTTP&lt;/abbr&gt; protocol, this is not really an issue. A typical mistake is to forget the &lt;abbr title="HyperText Transfer Protocol"&gt;HTTP&lt;/abbr&gt; verb inside the &lt;code class="highlighter-rouge"&gt;@RequestLine&lt;/code&gt; annotation.&lt;/li&gt; &lt;/ul&gt;&lt;p&gt;A lot of benefits:&lt;/p&gt;&lt;ul&gt; &lt;li&gt;Ease of use and close to &lt;abbr title="HyperText Transfer Protocol"&gt;HTTP&lt;/abbr&gt; protocol&lt;/li&gt; &lt;li&gt;Very lightweight without any transitive dependencies for &lt;code class="highlighter-rouge"&gt;feign-core&lt;/code&gt;&lt;/li&gt; &lt;li&gt;Easy to extend, eg: swapping encoders/decoders &lt;a href="https://github.com/OpenFeign/feign/tree/master/gson"&gt;GSON&lt;/a&gt;, &lt;a href="https://github.com/OpenFeign/feign/tree/master/jackson"&gt;Jackson&lt;/a&gt;, &lt;a href="https://github.com/OpenFeign/feign/tree/master/jaxb"&gt;JAXB&lt;/a&gt;&lt;/li&gt; &lt;li&gt;Good support of Java 8, the instances methods &lt;code class="highlighter-rouge"&gt;static&lt;/code&gt; and &lt;code class="highlighter-rouge"&gt;default&lt;/code&gt; are supported&lt;/li&gt; &lt;/ul&gt;&lt;p&gt;General comments&lt;/p&gt;&lt;ul&gt; &lt;li&gt;There are a few more annotations &lt;code class="highlighter-rouge"&gt;@Body&lt;/code&gt;, &lt;code class="highlighter-rouge"&gt;@HeaderMap&lt;/code&gt;, &lt;code class="highlighter-rouge"&gt;@QueryMap&lt;/code&gt;&lt;/li&gt; &lt;li&gt;it is possible to configure how variables (&lt;code class="highlighter-rouge"&gt;@Param&lt;/code&gt;) are converted into String via &lt;code class="highlighter-rouge"&gt;Expanders&lt;/code&gt;&lt;/li&gt; &lt;li&gt;The root path of all the interface methods can be added to the &lt;abbr title="Uniform Resource Locator"&gt;URL&lt;/abbr&gt; used by the &lt;em&gt;builder&lt;/em&gt;&lt;/li&gt; &lt;/ul&gt;&lt;blockquote&gt; &lt;p&gt;There is no dark magic inside Feign: it relies on the &lt;abbr title="Java Developement Kit"&gt;JDK&lt;/abbr&gt;: &lt;code class="highlighter-rouge"&gt;java.net.HttpURLConnection&lt;/code&gt;, &lt;code class="highlighter-rouge"&gt;java.lang.reflect.Proxy&lt;/code&gt;, &lt;code class="highlighter-rouge"&gt;java.lang.reflect.InvocationHandler&lt;/code&gt;, â€¦&lt;/p&gt; &lt;/blockquote&gt;&lt;h2 id="retrofit"&gt;Retrofit&lt;/h2&gt;&lt;p&gt;The first step is to add the Retrofit dependencies:&lt;/p&gt;&lt;div class="language-xml highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="cp"&gt;&amp;lt;! -- Retrofit dependency --&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;com.squareup.retrofit2&lt;span class="nt"&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;retrofit&lt;span class="nt"&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;version&amp;gt;&lt;/span&gt;${retrofit.version}&lt;span class="nt"&gt;&amp;lt;/version&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt; &lt;span class="cp"&gt;&amp;lt;! -- Jackson converter for JSON --&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;com.squareup.retrofit2&lt;span class="nt"&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;converter-jackson&lt;span class="nt"&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;version&amp;gt;&lt;/span&gt;${retrofit.version}&lt;span class="nt"&gt;&amp;lt;/version&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt; &lt;span class="c"&gt;&amp;lt;!-- Simple converter for XML --&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;com.squareup.retrofit2&lt;span class="nt"&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;converter-simplexml&lt;span class="nt"&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;version&amp;gt;&lt;/span&gt;${retrofit.version}&lt;span class="nt"&gt;&amp;lt;/version&amp;gt;&lt;/span&gt; &lt;span class="nt"&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;Next step is to add the Retrofit specific annotations to the interface The rules of the game being to not modify the interface signature, we had to add a new interface to &lt;code class="highlighter-rouge"&gt;CallFactory&lt;/code&gt; used by Retrofit by default.&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;MonkeyRaceService&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="nd"&gt;@GET&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"races"&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="n"&gt;Call&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;MonkeyRace&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="nf"&gt;getMonkeyRaces&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7 8 9 10 11 12 13&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;MonkeyService&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="nd"&gt;@GET&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"monkeys"&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="n"&gt;Call&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Page&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Monkey&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="nf"&gt;getMonkeys&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt;&lt;span class="nd"&gt;@GET&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"monkeys/{name}"&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="n"&gt;Call&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Monkey&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="nf"&gt;getMonkeyByName&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nd"&gt;@Path&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"name"&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;&lt;span class="nd"&gt;@POST&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"monkeys"&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="n"&gt;Call&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Monkey&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="nf"&gt;create&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nd"&gt;@Body&lt;/span&gt; &lt;span class="n"&gt;Monkey&lt;/span&gt; &lt;span class="n"&gt;monkey&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;&lt;span class="nd"&gt;@DELETE&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"monkeys/{id}"&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="n"&gt;Call&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;ResponseBody&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="nf"&gt;delete&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nd"&gt;@Path&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"id"&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;monkeyId&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;MonkeyStatsService&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="nd"&gt;@GET&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"/stats"&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="n"&gt;Call&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;MonkeyStatistics&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="nf"&gt;getMonkeyStats&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;Then we implement the interfaces &lt;code class="highlighter-rouge"&gt;MonkeyApi&lt;/code&gt;, &lt;code class="highlighter-rouge"&gt;MonkeyRaceApi&lt;/code&gt;, &lt;code class="highlighter-rouge"&gt;MonkeyStatsApi&lt;/code&gt; using the Retrofit specific interfaces&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;RetrofitMonkeyApi&lt;/span&gt; &lt;span class="kd"&gt;implements&lt;/span&gt; &lt;span class="n"&gt;MonkeyApi&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;RetrofitApi&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="kd"&gt;private&lt;/span&gt; &lt;span class="n"&gt;MonkeyService&lt;/span&gt; &lt;span class="n"&gt;monkeyService&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;&lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="nf"&gt;setBaseUrl&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;baseUrl&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;monkeyService&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;createRetrofit&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;baseUrl&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;create&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MonkeyService&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt; &lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="n"&gt;Page&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Monkey&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="nf"&gt;getMonkeys&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;page&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nf"&gt;executeCall&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nl"&gt;monkeyService:&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="n"&gt;getMonkeys&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt; &lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="n"&gt;Monkey&lt;/span&gt; &lt;span class="nf"&gt;getMonkeyByName&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nf"&gt;executeCall&lt;/span&gt;&lt;span class="o"&gt;(()&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;monkeyService&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getMonkeyByName&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;));&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt; &lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="n"&gt;Monkey&lt;/span&gt; &lt;span class="nf"&gt;createMonkey&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Monkey&lt;/span&gt; &lt;span class="n"&gt;monkey&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nf"&gt;executeCall&lt;/span&gt;&lt;span class="o"&gt;(()&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;monkeyService&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;create&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;monkey&lt;/span&gt;&lt;span class="o"&gt;));&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt; &lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="nf"&gt;deleteMonkey&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;executeCall&lt;/span&gt;&lt;span class="o"&gt;(()&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;monkeyService&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;delete&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;));&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kd"&gt;interface&lt;/span&gt; &lt;span class="nc"&gt;RetrofitApi&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;&lt;span class="k"&gt;default&lt;/span&gt; &lt;span class="n"&gt;Retrofit&lt;/span&gt; &lt;span class="nf"&gt;createRetrofit&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;baseUrl&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;boolean&lt;/span&gt; &lt;span class="n"&gt;useXml&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;Retrofit&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Builder&lt;/span&gt; &lt;span class="n"&gt;builder&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;Retrofit&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Builder&lt;/span&gt;&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;baseUrl&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;baseUrl&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;useXml&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;builder&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;addConverterFactory&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;SimpleXmlConverterFactory&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;create&lt;/span&gt;&lt;span class="o"&gt;());&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="n"&gt;builder&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;addConverterFactory&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;JacksonConverterFactory&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;create&lt;/span&gt;&lt;span class="o"&gt;());&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;builder&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;build&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt;&lt;span class="k"&gt;default&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;T&lt;/span&gt; &lt;span class="nf"&gt;executeCall&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Supplier&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Call&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;supplier&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;try&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;Call&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;call&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;supplier&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;get&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;call&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;execute&lt;/span&gt;&lt;span class="o"&gt;().&lt;/span&gt;&lt;span class="na"&gt;body&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="k"&gt;catch&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;IOException&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;h3 id="conclusion-1"&gt;Conclusion&lt;/h3&gt;&lt;h4 id="drawbacks"&gt;Drawbacks&lt;/h4&gt;&lt;p&gt;We found quite annoying that there is no way with &lt;code class="highlighter-rouge"&gt;CallFactory&lt;/code&gt; to issue a synchronous call returning an object without having to use the &lt;code class="highlighter-rouge"&gt;Call&lt;/code&gt; object - as this can be done with Feign&lt;/p&gt;&lt;p&gt;It is also possible to create our own &lt;code class="highlighter-rouge"&gt;CallAdapterFactory&lt;/code&gt;. Here is an example from Retrofit test source code:&lt;/p&gt;&lt;div class="language-java highlighter-rouge"&gt;&lt;div class="highlight"&gt;&lt;table style="border-spacing: 0"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="gutter gl" style="text-align: right"&gt;&lt;pre class="lineno"&gt;1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24&lt;/pre&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;pre&gt;&lt;span class="kd"&gt;static&lt;/span&gt; &lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;DirectCallIOException&lt;/span&gt; &lt;span class="kd"&gt;extends&lt;/span&gt; &lt;span class="n"&gt;RuntimeException&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="n"&gt;DirectCallIOException&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt; &lt;span class="n"&gt;message&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;IOException&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="kd"&gt;super&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;message&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt;&lt;span class="kd"&gt;static&lt;/span&gt; &lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;DirectCallAdapterFactory&lt;/span&gt; &lt;span class="kd"&gt;extends&lt;/span&gt; &lt;span class="n"&gt;CallAdapter&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;Factory&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="nd"&gt;@Override&lt;/span&gt; &lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="n"&gt;CallAdapter&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;?&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;final&lt;/span&gt; &lt;span class="n"&gt;Type&lt;/span&gt; &lt;span class="n"&gt;returnType&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Annotation&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt; &lt;span class="n"&gt;annotations&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Retrofit&lt;/span&gt; &lt;span class="n"&gt;retrofit&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;CallAdapter&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="nd"&gt;@Override&lt;/span&gt; &lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="n"&gt;Type&lt;/span&gt; &lt;span class="nf"&gt;responseType&lt;/span&gt;&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;returnType&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt; &lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="n"&gt;Object&lt;/span&gt; &lt;span class="nf"&gt;adapt&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Call&lt;/span&gt; &lt;span class="n"&gt;call&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;try&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;call&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;execute&lt;/span&gt;&lt;span class="o"&gt;().&lt;/span&gt;&lt;span class="na"&gt;body&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="k"&gt;catch&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;IOException&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="k"&gt;throw&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nf"&gt;DirectCallIOException&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;getMessage&lt;/span&gt;&lt;span class="o"&gt;(),&lt;/span&gt; &lt;span class="n"&gt;e&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="o"&gt;};&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt; &lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt; &lt;/div&gt; &lt;/div&gt;&lt;p&gt;This enforces the handling of exceptions of type &lt;code class="highlighter-rouge"&gt;DirectCallIOException&lt;/code&gt;.&lt;/p&gt;&lt;p&gt;Another pain point encountered with Retrofit is to have to explicitly catch the &lt;code class="highlighter-rouge"&gt;IOException&lt;/code&gt; that can raise from method calls. Maybe Retrofit could provide exception management in a Feign fashion? We will find this out during the next part.&lt;/p&gt;&lt;p&gt;The last drawback we found, Retrofit requires several dependencies to run: &lt;a href="http://square.github.io/okhttp/"&gt;OkHttp&lt;/a&gt; and at least 1 &lt;em&gt;converter&lt;/em&gt; which makes the size of the executable much larger that the one generated with Feign (1.5Mo vs 0.5Mo).&lt;/p&gt;&lt;h4 id="benefits"&gt;Benefits&lt;/h4&gt;&lt;p&gt;Retrofit is developer friendly. Having the main converters available out of the box is very handy.&lt;/p&gt;&lt;p&gt;Retrofit has its own annotations avoiding typical &lt;em&gt;typo&lt;/em&gt;, which is a good thing. Even if Feign has improved a lot on error messages management, we still prefer the way it has been designed by the Retrofit team.&lt;/p&gt;</content> <author> <name>Emmanuel Vinas</name> <email>emmanuel@monkeypatch.io</email> </author> <author> <name>Igor Laborie</name> <email>igor@monkeypatch.io</email> </author> <author> <name>Bruno Chauvet</name> <email>bruno@monkeypatch.io</email> </author> <category term="MKTD"/> <category term="Java"/> <category term="REST"/> <category term="Feign"/> <category term="Retrofit"/> <summary>IntroductionEarly July we organised in Toulouse our first MonkeyTechDays hosted by HarryCow comparing the technologies: Feign vs Retrofit. The goal of a MKTD is to compare and learn new technologies running challenges throughout the day.We decided to improve our knowledge of REST clients in Java during this first event. We started with Feign which is designed by Netflix and Retrofit written by Square. These two libraries provide an elegant way to speed up the development of REST clients in Java compare to traditional solutions such as JAX-RS clients, Spring Rest Template, etcâ€¦</summary> <media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://www.monkeypatch.io/public/images/logos/logo-FeignVsRetrofit.png"/> </entry> </feed>